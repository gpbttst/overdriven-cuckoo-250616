<html>
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="pragma" content="no-cache"/>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover" />
  <meta name="robots" content="noindex, nofollow" />
  <meta charset="utf-8"/>
  <style>
  :root {
    color-scheme: only light;
  }
  html {
    height: 100%;
	--col-bg1: #8684cc;
	--col-bg2: #ffffff;
	--col-but1: #2e2d66;
	--col-but2: #c2c0e5;
	--col-counter-bg: #ffffff;
	--col-text1: #ffffff;
	--col-text2: #ffffff;
	--col-text-reward: #000000;
	--col-quiz-right: #2d6631;
	--col-quiz-wrong: #662d2d;
	--col-cta1: #01db4c;
	--col-cta2: #0fa0de;
	--col-cta3: #ffffff;
	-webkit-tap-highlight-color: rgba(255, 255, 255, 0);
	--safe-top: 0px;
  }
  body {
    background: var(--col-bg1);
    color: var(--col-text1);
    font-family: sans-serif;
    user-select: none;
    overflow: hidden;
    margin: 0;
	padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    background-repeat: no-repeat;
    background-attachment: fixed;
	scrollbar-color: var(--col-but1) #00000000;
	scrollbar-width: thin;
	padding-top: var(--safe-top);
  }
.progressCont {
	font-weight: 700;
	font-size: 16px;
	text-align: center;
	height: 16px;
	max-height: 32px;
	display: block;
	width: 50%;
	max-width: 280px;
	background: var(--col-counter-bg);
	margin-bottom: 8px;
	margin-top: 20px;
	border-radius: 16px;
	padding: 2px;
	top: calc(20px+env(safe-area-inset-top));
	old-padding-top: calc(20px+env(safe-area-inset-top));
	old-margin-top: env(safe-area-inset-top);
}
#progressBar {
  height: 100%;
  width: 0;
  border-radius: 16px;
  background: var(--col-but1);
  transition: width 0.4s ease;
}
  .questionDiv {
    height: 50%;
    font-weight:700;
    font-size:16px;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
  }
 .questionContent {
	display: flex;
	justify-content: center;
	align-items: center;
	width: 100%;
	flex-direction: column;
	flex-grow: 1;
	color: var(--col-text2);
}
  .questionText
  {
    font-weight:700;
    font-size:16px;
    text-align:center;
	width: 90%;
	max-width: 480px;
  }
.questionNote {
	font-style: italic;
	font-size: 14px;
}
  .questionPicDiv {
	position: relative;
    margin-bottom: 10px;
    display: flex;
    justify-content: center;
    align-items: center;
	flex: auto;
	max-height: 30vh;
  }
  .questionPicDiv:first-child {
	display: flex;
	align-items: flex-start;
  }
  .questionPic {
    height: 100%;
	width: auto;
    margin: 10px;
	align-self: center;
	max-width: 90%;
  }
  #scratchCard {
	  position: fixed;
    height: 100%;
	width: auto;
    margin: 10px;
	align-self: center;
	max-width: 90%;
	margin: 0;
  }
  .answersDiv {
    height: 50%;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: flex-start;
  }
  .answersDiv>* {
    /*flex: 1 1 160px;*/
    flex-grow: 1;
    min-width: 128px;
  }
.multiSelectArea {
	width: 100%;
	height: calc(100% - 64px);
	display: flex;
	flex-wrap: wrap;
	justify-content: center;
	align-items: flex-start;
	overflow-y: scroll;
}
  .answersBut {
    display:flex;
    justify-content:center;
    align-items:center;
    position:relative;
    overflow:hidden;
    background:var(--col-but1);
    margin:auto;
    padding:10px;
    border-radius:32px;
    width:50%;
    text-align:center;
    vertical-align:middle;
    max-width:280px;
    /*height:50%;*/
    min-height:24px;
    max-height:52px;
    font-weight:700;
    font-size:16px;
    text-align:center;
    transition: all .2s ease-in-out;
	overflow: visible;
	cursor: pointer
  }

.answersBut[data-clickable=false] {
	opacity: 0.5;
	cursor: not-allowed;
}
.answersBut[data-quizselected=true] {
	opacity: 1;
}
.answersBut:hover, .answersBut:active {
	transform: scale(1.1);
}
.answersBut[data-clickable=false]:hover {
	transform: scale(1);
}
  .answerButImgCont {
	display: flex;
  }
  .answerButImgCont > img {
	width: auto;
	max-width: 25vw;
	max-height: 25vh;
	align-self: flex-start;
	padding-bottom: 8px;
  }
.matrixHead {
	width: 80%;
	font-weight: 700;
	color: var(--col-text2);
	margin-left: auto;
	margin-right: auto;
	cursor: pointer;
}
.matrixHead > span.matrixArrow {
	float: right;
	transform: rotate(180deg);
}
.matrixHead[data-hidden=true] > span.matrixArrow {
	float: right;
	transform: rotate(90deg);
}
.matrixHead > span:last-of-type {
	color: var(--col-but1);
}
.matrixDivider {
	height: 12px;
	border-bottom: 1px solid var(--col-but1);
	width: 80%;
	margin: auto;
}
  .sliderCont {
    display: flex;
    justify-content: space-between;;
    align-items: center;
	flex-direction: column;
	width: 100%;
	padding-top: 20px;
  }
#sliderVars {
	width: 80%;
	max-width: 480px;
	flex-direction: row;
}
  #sliderVars > :first-child {
	  text-align: left;
	  padding-right: 4px;
  }
  #sliderVars > :last-child {
	  text-align: right;
	  padding-left: 4px;
  }
  #sliderVars > :not(:first-child):not(:last-child) {
	  text-align: center;
	  padding-left: 12px;
	  padding-right: 12px;
  }
  .slider {
	width: 80%;
	max-width: 480px;
  }
.sliderCont > p {
	margin-top: 0;
	font-weight: 700;
	font-size: 32px;
}
  .break {
	flex-basis: 100%;
	height: 0;
  }
  .break.multi {
	height: 16px;
	display: none;
  }
.multi > .answersBut {
	border-radius: 4px;
	justify-content: flex-start;
	max-width: 85%;
	width: 80%;
	max-height: 500px;
}
.svgIcon {
	fill: var(--col-but2);
	width: 32px;
}
.multi > .answersBut:hover {
	width: 85%;
}
.multi > .answersBut > span {
	text-align: left;
}
.multi {
	padding-bottom: 16px;
	flex-basis: 100%;
}
.multiSelectCheckbox {
	display: block;
	width: 44px;
	height: 100%;
	left: 0;
	position: fixed;
	border-radius: 4px 0px 0px 4px;
	//border-right: 2px solid;
	background: var(--col-but2);
	border-color: #fff;
}
.multiSelectCheckmark {
	display: block;
	opacity: 0;
	-webkit-mask-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%23fff' d='M6.564.75l-3.59 3.612-1.538-1.55L0 4.26 2.974 7.25 8 2.193z'/%3e%3c/svg%3e");
	-webkit-mask-position: center;
	-webkit-mask-repeat: no-repeat;
	mask-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%23fff' d='M6.564.75l-3.59 3.612-1.538-1.55L0 4.26 2.974 7.25 8 2.193z'/%3e%3c/svg%3e");
	mask-position: center;
	mask-repeat: no-repeat;
	background: var(--col-but1);
	height: 100%;
	width: 50%;
	left: 25%;
	position: relative;
	transition: all .1s ease-in-out;
}
.multiSelectCheckmarkWrong {
	display: block;
	opacity: 0;
	-webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='26.959' height='26.959' viewBox='0 0 7.133 7.133'%3E%3Cpath style='fill:%232e2d66;fill-opacity:1;stroke:none;stroke-width:1.5105;paint-order:fill markers stroke;stop-color:%23000' d='m143.022 159.324-1.629 1.628 1.938 1.938-1.938 1.938 1.63 1.629 1.937-1.938 1.937 1.937 1.63-1.628-1.938-1.938 1.937-1.938-1.629-1.628-1.937 1.937z' transform='translate(-141.393 -159.324)'/%3E%3C/svg%3E%0A");
	-webkit-mask-position: center;
	-webkit-mask-repeat: no-repeat;
	mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='26.959' height='26.959' viewBox='0 0 7.133 7.133'%3E%3Cpath style='fill:%232e2d66;fill-opacity:1;stroke:none;stroke-width:1.5105;paint-order:fill markers stroke;stop-color:%23000' d='m143.022 159.324-1.629 1.628 1.938 1.938-1.938 1.938 1.63 1.629 1.937-1.938 1.937 1.937 1.63-1.628-1.938-1.938 1.937-1.938-1.629-1.628-1.937 1.937z' transform='translate(-141.393 -159.324)'/%3E%3C/svg%3E%0A");
	mask-position: center;
	mask-repeat: no-repeat;
	background: var(--col-but1);
	height: 100%;
	width: 60%;
	left: 20%;
	position: relative;
	transition: all .1s ease-in-out;
}
.scratchPointer {
	display: block;
	opacity: 0;
	pointer-events: none;
	position: fixed;
	width: 20%;
	height: auto;
	animation: scratchPointer 1s ease 0s infinite normal forwards;
}
  
  .fineprint {
	text-align: center;
	font-size:12;
	position: absolute;
	bottom: 0;
	color: var(--col-text2);
  }
  
  #numberInput {
	max-width: 280px;
	height: 64px;
	font-size: 32px;
	text-align: center;
  }
  
  #textArea {
	resize: none;
	max-width: 80%;
	height: 50%;
  }
  
  .imgBut {
	display: flex;
	flex-direction: column;
	max-width: 25vmin;
	background: transparent;
	height: 50%;
	max-height: 50%
  }
  
	#npsCont {
		display: flex;
		max-width: 95%;
		height: 32px;
	}
	
	.npsBut {
		width: 10%;
		height: 100%;
		background: var(--col-counter-bg);
		margin: 1vw;
		text-align: center;
		color: var(--col-but1);
		font-weight: bold;
		border: none;
		box-shadow: black;
		cursor: pointer;
		font-size: 3vmin;
	}
	
	.npsBut:first-child {
		border-radius: 16px 0px 0px 16px;
	}
	.npsBut:last-child {
		border-radius: 0px 16px 16px 0px;
	}
	
	.npsSelected {
		background:var(--col-but1);
		color: var(--col-text1);
	}

  .scale-up-center {
  	-webkit-animation: scale-up-center 0.4s cubic-bezier(0.390, 0.575, 0.565, 1.000) both;
  	        animation: scale-up-center 0.4s cubic-bezier(0.390, 0.575, 0.565, 1.000) both;
  }

  @-webkit-keyframes scale-up-center {
    0% {
      -webkit-transform: scale(0.5);
              transform: scale(0.5);
    }
    100% {
      -webkit-transform: scale(1);
              transform: scale(1);
    }
  }
  @keyframes scale-up-center {
    0% {
      -webkit-transform: scale(0.5);
              transform: scale(0.5);
    }
    100% {
      -webkit-transform: scale(1);
              transform: scale(1);
    }
  }
  
  .scale-up-center-opacity {
  	-webkit-animation: scale-up-center-opacity 0.2s cubic-bezier(0.390, 0.575, 0.565, 1.000) both;
  	        animation: scale-up-center-opacity 0.2s cubic-bezier(0.390, 0.575, 0.565, 1.000) both;
  }

  @-webkit-keyframes scale-up-center-opacity {
    0% {
      -webkit-transform: scale(0.25);
              transform: scale(0.25);
			  opacity: 0;
    }
    100% {
      -webkit-transform: scale(1);
              transform: scale(1);
			  opacity: 1;
    }
  }
  @keyframes scale-up-center-opacity {
    0% {
      -webkit-transform: scale(0.25);
              transform: scale(0.25);
			  opacity: 0;
    }
    100% {
      -webkit-transform: scale(1);
              transform: scale(1);
			  opacity: 1;
    }
  }


  .loaderCont
  {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
  }

  .loader,
  .loader:after {
    border-radius: 50%;
    width: 10em;
    height: 10em;
  }
  .loader {
    margin: 60px auto;
    font-size: 10px;
    text-indent: -9999em;
    border-top: 1.1em solid rgba(255, 255, 255, 0.2);
    border-right: 1.1em solid rgba(255, 255, 255, 0.2);
    border-bottom: 1.1em solid rgba(255, 255, 255, 0.2);
    border-left: 1.1em solid #ffffff;
    -webkit-transform: translateZ(0);
    -ms-transform: translateZ(0);
    transform: translateZ(0);
    -webkit-animation: load8 1.1s infinite linear;
    animation: load8 1.1s infinite linear;
  }
	.loaderSmall {
		width: 32px;
		height: 32px;
		border-radius: 50%;
		border-top: 4px solid var(--col-but1);
		border-left: 4px solid transparent;
		border-right: 4px solid var(--col-but1);
		border-bottom: 4px solid var(--col-but1);
		min-width: 32px;
		position: absolute;
		animation: load8 1.1s infinite linear;
	}
  @-webkit-keyframes load8 {
    0% {
      -webkit-transform: rotate(0deg);
      transform: rotate(0deg);
    }
    100% {
      -webkit-transform: rotate(360deg);
      transform: rotate(360deg);
    }
  }
  @keyframes load8 {
    0% {
      -webkit-transform: rotate(0deg);
      transform: rotate(0deg);
    }
    100% {
      -webkit-transform: rotate(360deg);
      transform: rotate(360deg);
    }
  }
  
@keyframes scratchPointer {
	0%,
	100% {
		-webkit-transform: translateX(-50%);
		transform: translateX(-50%);
	}
	50%{
		-webkit-transform: translateX(50%);
		transform: translateX(50%);
	}
}

  .area{
    position: absolute;
    background: var(--col-bg1);
    width: 100%;
    height:100%;
    z-index: -10000;
}

.circles{
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
	margin: 0;
	padding: 0;
}

.circles li{
    position: absolute;
    display: block;
    list-style: none;
    width: 20px;
    height: 20px;
    background: var(--col-bg2);
	opacity: 0.2;
    animation: animate 25s linear infinite;
    bottom: -150px;

}

.circles li:nth-child(1){
    left: 25%;
    width: 80px;
    height: 80px;
    animation-delay: 0s;
}


.circles li:nth-child(2){
    left: 10%;
    width: 20px;
    height: 20px;
    animation-delay: 2s;
    animation-duration: 12s;
}

.circles li:nth-child(3){
    left: 70%;
    width: 20px;
    height: 20px;
    animation-delay: 4s;
}

.circles li:nth-child(4){
    left: 40%;
    width: 60px;
    height: 60px;
    animation-delay: 0s;
    animation-duration: 18s;
}

.circles li:nth-child(5){
    left: 65%;
    width: 20px;
    height: 20px;
    animation-delay: 0s;
}

.circles li:nth-child(6){
    left: 75%;
    width: 110px;
    height: 110px;
    animation-delay: 3s;
}

.circles li:nth-child(7){
    left: 35%;
    width: 150px;
    height: 150px;
    animation-delay: 7s;
}

.circles li:nth-child(8){
    left: 50%;
    width: 25px;
    height: 25px;
    animation-delay: 15s;
    animation-duration: 45s;
}

.circles li:nth-child(9){
    left: 20%;
    width: 15px;
    height: 15px;
    animation-delay: 2s;
    animation-duration: 35s;
}

.circles li:nth-child(10){
    left: 85%;
    width: 150px;
    height: 150px;
    animation-delay: 0s;
    animation-duration: 11s;
}



@keyframes animate {

    0%{
        transform: translateY(0) rotate(0deg);
        opacity: 0.2;
        border-radius: 0;
    }

    100%{
        transform: translateY(-1000px) rotate(720deg);
        opacity: 0;
        border-radius: 50%;
    }

}

.area.grid {
	background: linear-gradient(var(--col-bg1) 25%, var(--col-bg2) 50%, var(--col-bg2) 50%, var(--col-bg1) 100%);
	perspective: 360px;
	perspective-origin: 50% 50%;
}

.area.grid > div{
	width: 200%;
	height: 130%;
	position: absolute;
	bottom: -30%;
	left: -50%;
	background-image: -webkit-linear-gradient(var(--col-bg2) 2px, transparent 2px), -webkit-linear-gradient(left, var(--col-bg2) 2px, transparent 2px);
	background-size: 100px 100px,100px 100px;
	background-position: -1px -1px,-1px -1px;
	transform: rotateX(85deg);
	animation: planeMoveTop 2s infinite linear;
}

.area.grid > div:nth-child(2){
	transform: rotateX(-85deg);
	top: -30%;
	animation: planeMoveBot 2s infinite linear;
}


@keyframes planeMoveTop {
  from {
    background-position: 0px -100px,0px 0px;
  }
  to {
    background-position: 0px 0px, 0px 0px;
  }
}
@keyframes planeMoveBot {
  from {
    background-position: 0px 0px,0px 0px;
  }
  to {
    background-position: 0px -100px, 0px 0px;
  }
}

.area.gradient {
	background: linear-gradient(-45deg, var(--col-bg1), var(--col-bg2));
	background-size: 400% 400%;
	animation: gradient 15s ease infinite;
}

@keyframes gradient {
	0% {
		background-position: 0% 50%;
	}
	50% {
		background-position: 100% 50%;
	}
	100% {
		background-position: 0% 50%;
	}
}

[data-quantity] {
  position: relative;
  width: 100%;
  max-width: 280px;
  padding: 0;
  margin: 0;
  border: 0;
}

[data-quantity] legend {
  display: none;
}

[data-quantity] input {
  font-size: 18px;
  height: 4rem;
  padding: 0 4rem;
  border-radius: 2rem;
  border: 0;
  background: #fff;
  color: #222;
  box-shadow: 0 10px 65px -10px rgba(0, 0, 0, 0.25);
  text-align: center;
  width: 100%;
  box-sizing: border-box;
  font-weight: lighter;
}

[data-quantity] input:focus {
  outline: none;
  box-shadow: 0 5px 55px -10px rgba(0, 0, 0, 0.2), 0 0 4px #3fb0ff; /* Allows border radius on focus */
}

[data-quantity] input[type=number]::-webkit-inner-spin-button,
[data-quantity] input[type=number]::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

[data-quantity] input[type=number] {
  -moz-appearance: textfield;
}

[data-quantity] button {
  position: absolute;
  width: 2.8rem;
  height: 2.8rem;
  top: 0.6rem;
  display: block;
  padding: 0;
  margin: 0;
  border: 0;
  background: #fff
    url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="50"><path d="M17 25h16M67 25h16M75 17v16" fill="none" stroke="rgb(59,69,66)" stroke-width="1.5px" stroke-linecap="round" stroke-linejoin="round" /></svg>')
    no-repeat 0 0;
  background-size: 5.6rem 2.8rem;
  overflow: hidden;
  white-space: nowrap;
  text-indent: 100%;
  border-radius: 1.4rem;
  cursor: pointer;
  transition: opacity 0.15s;
  opacity: 0.5;
}

[data-quantity] button:active {
  background-position-y: 1px;
  box-shadow: inset 0 2px 12px -4px #c5d1d9;
}

[data-quantity] button:focus {
  outline: none;
}

[data-quantity] button:hover {
  opacity: 1;
}

[data-quantity] button.sub {
  left: 0.6rem;
}

[data-quantity] button.add {
  right: 0.6rem;
  background-position-x: -2.8rem;
}

.ss-wrapper {
  overflow: hidden;
  width: 100%;
  height: 100%;
  position: relative;
  z-index: 1;
  float: left;
}

.ss-content {
  height: 100%;
  width: calc(100% + 18px);
  padding: 0 0 0 0;
  position: relative;
  overflow-x: auto;
  overflow-y: scroll;
  box-sizing: border-box;
}

.ss-content.rtl {
  width: calc(100% + 18px);
  right: auto;
}

.ss-scroll {
  position: relative;
  background: rgba(0, 0, 0, 0.1);
  width: 9px;
  border-radius: 4px;
  top: 0;
  z-index: 2;
  cursor: pointer;
  opacity: 0;
  transition: opacity 0.25s linear;
}

.ss-hidden {
  display: none;
}

.ss-container:hover .ss-scroll,
.ss-container:active .ss-scroll {
  opacity: 1;
}

.ss-grabbed {
  -o-user-select: none;
  -ms-user-select: none;
  -moz-user-select: none;
  -webkit-user-select: none;
  user-select: none;
}
.popupCont {
	display: flex;
	position: fixed;
	width: 100%;
	height: 100%;
	justify-content: center;
	align-items: center;
	top: 0;
}
.popup {
	width: 80%;
	height: 60%;
	background: white;
	border-radius: 16px;
	overflow: hidden;
	color: black;
}
#otherPopupInput {
	height: calc(100% - 48px);
	top: 16px;
	position: relative;
	padding-left: 16px;
	padding-right: 16px;
}
#otherPopupInput > textarea {
	width: 100%;
	height: 60%;
	resize: none;
}
#otherPopupInput > p {
	margin-top: 0;
}
#popupIframe {
	border: none;
	width: 100%;
	height: calc(100% - 32px);
	overflow-x: hidden;
}
#popupClose {
	width: 100%;
	height: 32px;
	color: black;
	text-align: center;
	text-decoration: underline;
	line-height: 32px;
	cursor: pointer;
}
#otherPopupClose {
	width: 100%;
	height: 48px;
	color: black;
	text-align: center;
	line-height: 48px;
	cursor: pointer;
	display: flex;
	justify-content: flex-start;
	align-items: flex-start;
}
.surveyClose {
	display: block;
	margin: 20px;
	background: var(--col-counter-bg);
	float: left;
	border-radius: 50%;
	width: 20px; 
	right: 0;
	position: fixed;
	top: env(safe-area-inset-top);
	z-index: 10000;
	cursor: pointer;
	margin-top: calc(20px + var(--safe-top));
}
.surveyClose > svg {
	stroke: var(--col-but1);
}
#confirmOverlay {
	width: 100%;
	height: 100%;
	position: fixed;
	top: 0;
	background: #00000045;
	color: black;
	display: none;
	justify-content: center;
	align-items: center;
	user-select: none;
	z-index: 10000;
}
#confirmPopup {
	width: 80%;
	max-width: 480px;
	height: 30%;
	max-height: 120px;
	background: white;
	border-radius: 8px;
	display: flex;
	justify-content: flex-start;
	align-items: flex-start;
	flex-direction: column;
	overflow: hidden;
	font-family: sans-serif;
}
#confirmPopupMain {
	height: 60%;
	width: 100%;
	display: flex;
	justify-content: center;
	text-align: center;
}
#confirmPopupMain > p {
	font-family: sans-serif;
}
#confirmPopupButDiv {
	width: 100%;
	height: 40%;
	display: flex;
	justify-content: flex-start;
	align-items: flex-start;
	cursor: pointer;
}
.confirmNo {
	width: 50%;
	height: 100%;
	background: #0000ff0f;
	display: flex;
	justify-content: center;
	align-items: center;
	cursor: pointer;
}
.confirmYes {
	width: 50%;
	height: 100%;
	background: #ff000017;
	display: flex;
	justify-content: center;
	align-items: center;
	cursor: pointer;
}
#answerSearchField {
	width: 50%;
	margin-top: 32px;
}
.multiButCont {
	display: flex;
	justify-content: center;
	align-items: flex-start;
	flex-direction: column;
	padding-left: 44px;
}
.multiButCont > span {
	text-align: left;
}
.matrixCont {
	display: block;
	height: auto;
	overflow-y: hidden;
	transition: max-height 0.5s;
}
.quizCont > span {
	display: block;
	width: 0;
}
.quizPerc {
	display: block;
	position: fixed;
	right: 8px;
}
.multiButCont > img {
	display: block;
	max-width: 100%;
	height: auto;
}
.sortableImg {
	margin-left: 16px;
}
.multiButCont > .quizBg {
	width: 0px;
	height: 100%;
	background: var(--col-but1);
	position: fixed;
	left: 44px;
	top: 0;
	z-index: -10;
	border-radius: 0px 4px 4px 0px;
	transition-duration: 500ms;
	transition-property: width;
}
.sortableNum {
	margin-right: 10px;
	background: var(--col-but2);
	padding: 4px;
	border-radius: 2px;
	color: var(--col-but1);
	display: inline-block;
	margin-left: -16px;
}
.answerPicDiv {
	display: flex;
	justify-content: center;
	align-items: center;
	flex: auto;
}
.answerPicDiv > img {
	display: flex;
	align-items: flex-start;
	height: 100%;
	max-height: 500px;
	width: auto;
	align-self: center;
	max-width: 100%;
}
.rating {
  display: flex;
  width: 100%;
  justify-content: center;
  overflow: hidden;
  flex-direction: row-reverse;
  height: 50%;
  position: relative;
}
.rating-0 {
  filter: grayscale(100%);
}
.rating > input {
  display: none;
  user-select: none;
}
.rating > input:focus {
  outline: none !important;
  box-shadow: none !important;
}
.rating > label {
  cursor: pointer;
  user-select: none;
  width: 40px;
  height: 40px;
  -webkit-mask-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' width='126.729' height='126.73'%3e%3cpath fill='%23e3e3e3' d='M121.215 44.212l-34.899-3.3c-2.2-.2-4.101-1.6-5-3.7l-12.5-30.3c-2-5-9.101-5-11.101 0l-12.4 30.3c-.8 2.1-2.8 3.5-5 3.7l-34.9 3.3c-5.2.5-7.3 7-3.4 10.5l26.3 23.1c1.7 1.5 2.4 3.7 1.9 5.9l-7.9 32.399c-1.2 5.101 4.3 9.3 8.9 6.601l29.1-17.101c1.9-1.1 4.2-1.1 6.1 0l29.101 17.101c4.6 2.699 10.1-1.4 8.899-6.601l-7.8-32.399c-.5-2.2.2-4.4 1.9-5.9l26.3-23.1c3.8-3.5 1.6-10-3.6-10.5z'/%3e%3c/svg%3e");
  -webkit-mask-repeat: no-repeat;
  -webkit-mask-position: center;
  -webkit-mask-size: 76%;
  mask-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' width='126.729' height='126.73'%3e%3cpath fill='%23e3e3e3' d='M121.215 44.212l-34.899-3.3c-2.2-.2-4.101-1.6-5-3.7l-12.5-30.3c-2-5-9.101-5-11.101 0l-12.4 30.3c-.8 2.1-2.8 3.5-5 3.7l-34.9 3.3c-5.2.5-7.3 7-3.4 10.5l26.3 23.1c1.7 1.5 2.4 3.7 1.9 5.9l-7.9 32.399c-1.2 5.101 4.3 9.3 8.9 6.601l29.1-17.101c1.9-1.1 4.2-1.1 6.1 0l29.101 17.101c4.6 2.699 10.1-1.4 8.899-6.601l-7.8-32.399c-.5-2.2.2-4.4 1.9-5.9l26.3-23.1c3.8-3.5 1.6-10-3.6-10.5z'/%3e%3c/svg%3e");
  mask-repeat: no-repeat;
  mask-position: center;
  background: var(--col-counter-bg);
  mask-size: 76%;
  transition: .3s;
}
.rating > input:checked ~ label,
.rating > input:checked ~ label ~ label {
  background: var(--col-but1);
}
.rating > input:not(:checked) ~ label:hover,
.rating > input:not(:checked) ~ label:hover ~ label {
  background:  var(--col-but1);
}
.clickMapPointer {
	position: fixed;
	width: 8px;
	height: 8px;
	border-radius: 6px;
	border: 2px solid black;
	background: white;
}
#dropdown {
	position: fixed;
	overflow: hidden scroll;
}
.dropdownCity {
	border-bottom: 1px solid var(--col-but2);
	background: var(--col-but1);
	color: var(--col-text1);
	font-weight: bold;
	display: flex;
	height: auto;
	min-height: 64px;
	cursor: pointer;
}
.dropdownCity > p {
	margin-left: 8px;
	margin-right: 8px;
}
.dropdownCity > p > span {
	font-size: 12px;
}
.videoPlayBut {
	position: absolute;
	opacity: 1;
	transition: all .1s ease-in-out;
}
.videoPlayBut:hover {
	opacity: 0.75;
}
#wheelOfFortune {
	display: block;
	position: relative;
	overflow: hidden;
	cursor: pointer;
	left: 50%;
	transform: translate(-50%, -50%);
	width: 600px;
	height: 600px;
	top: 50%;
	//translate: -0.5 -0.5;
}
#wheel {
	display: block;
}
#spin {
	font: 3em/0 sans-serif;
	user-select: none;
	display: flex;
	justify-content: center;
	align-items: center;
	position: absolute;
	top: 50%;
	left: 50%;
	width: 30%;
	height: 30%;
	margin: -15%;
	background: var(--col-but1);
	color: var(--col-text1);
	box-shadow: 0 0 0 8px currentColor, 0 0px 15px 5px rgba(0, 0, 0, 0.6) !important;
	border-radius: 50% !important;
	transition: 0.8s;
	animation: wofSpin 0.1s linear;
}
#spin::after {
	content: '';
	position: absolute;
	top: -33px;
	border: 30px solid transparent;
	border-bottom-color: var(--col-text1);
	border-top: none;
}
.spinInit {
	animation: spin_pulse 0.4s ease infinite alternate !important;
}
#wheelTxt {
	font-size: 90px;
}
#wofResultCont {
	display: flex;
	position: absolute;
	width: 100%;
	height: 100%;
	transform: translateY(-100%);
	border-radius: 100%;
	justify-content: center;
	align-items: center;
	animation: 
}
#wofResultBg {
	display: block;
	position: absolute;
	width: 100%;
	height: 100%;
	background: var(--col-but1);
	border-radius: 100%;
	opacity: 0.75;
}
#wofResultText {
	font-size: 36px;
	text-align: center;
	font-weight: bold;
	color: var(--col-text1);
	z-index: 2;
}
#prizeImg > img
{
	padding: 8px;
}

::-webkit-scrollbar {
    width: 8px;
}
::-webkit-scrollbar-track {
    background-color: #00000000;
    border-radius: 100px;
}
::-webkit-scrollbar-thumb {
    background-color: var(--col-but1);
    border-radius: 100px;
}
#logoImg {
	display: block;
	position: absolute;
	width: 20%;
	max-width: 128px;
	top: env(safe-area-inset-top);
	padding-top: calc(20px + var(--safe-top));
	padding-left: 1vw;
}
input {
	accent-color: var(--col-but1);
}
input[type="checkbox"]:focus {
	outline: none;
}
input[type="checkbox"]:checked + label::after {
   content: '';
   position: absolute;
   width: 1.2ex;
   height: 0.4ex;
   background: rgba(0, 0, 0, 0);
   top: 0.7ex;
   left: 0.4ex;
   border: 3px solid var(--col-text1);
   border-top: none;
   border-right: none;
   -webkit-transform: rotate(-45deg);
   -moz-transform: rotate(-45deg);
   -o-transform: rotate(-45deg);
   -ms-transform: rotate(-45deg);
   transform: rotate(-45deg);
}

input[type="checkbox"] {
   line-height: 2.1ex;
}

input[type="radio"],
input[type="checkbox"] {
    position: absolute;
    left: -999em;
}

input[type="checkbox"] + label {
    position: relative;
    overflow: hidden;
    cursor: pointer;
}

input[type="checkbox"] + label::before {
   content: "";
   display: inline-block;
   vertical-align: -25%;
   height: 2ex;
   width: 2ex;
   background-color: var(--col-but1);
   border: 1px solid var(--col-but1);
   border-radius: 4px;
   margin-right: 0.5em;
}


input[type="range"] {
  -webkit-appearance: none;
  background: var(--col-counter-bg);
  border-radius: 16px;
  background-image: linear-gradient(var(--col-but1), var(--col-but1));
  background-size: 50% 100%;
  background-repeat: no-repeat;
  height: 16px;
}

input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  height: 32px;
  width: 32px;
  border-radius: 50%;
  border-color: var(--col-counter-bg);
  border-width: 2px;
  background: var(--col-but1);
  cursor: ew-resize;
  transition: background .3s ease-in-out;
}

input[type="range"]::-moz-range-thumb {
  -webkit-appearance: none;
  height: 32px;
  width: 32px;
  border-radius: 50%;
  border-color: var(--col-counter-bg);
  border-width: 2px;
  background: var(--col-but1);
  cursor: ew-resize;
  transition: background .3s ease-in-out;
}

input[type="range"]::-ms-thumb {
  -webkit-appearance: none;
  height: 32px;
  width: 32px;
  border-radius: 50%;
  border-color: var(--col-counter-bg);
  border-width: 2px;
  background: var(--col-but1);
  cursor: ew-resize;
  transition: background .3s ease-in-out;
}

input[type="range"]::-webkit-slider-thumb:hover {
  background: var(--col-but1);
}

input[type="range"]::-moz-range-thumb:hover {
  background: var(--col-but1);
}

input[type="range"]::-ms-thumb:hover {
  background: var(--col-but1);
}

input[type=range]::-webkit-slider-runnable-track  {
  -webkit-appearance: none;
  box-shadow: none;
  border: none;
  background: transparent;
}

input[type=range]::-moz-range-track {
  -webkit-appearance: none;
  box-shadow: none;
  border: none;
  background: transparent;
}

input[type="range"]::-ms-track {
  -webkit-appearance: none;
  box-shadow: none;
  border: none;
  background: transparent;
}
#backBut {
	position: fixed;
	left: 10px;
	bottom: 10px;
	width: 44px;
	min-height: 44px;
	max-height: 52px;
	padding: auto;
	display: flex;
	justify-content: center;
	align-items: center;
	border-radius: 32px;
	font-size: 16px;
	background: var(--col-but1);
	text-align: center;
	cursor: pointer;
}
#backBut > div {
	border: solid var(--col-text1);
	border-width: 0 3px 3px 0;
	display: inline-block;
	padding: 3px;
	transform: rotate(135deg);
	-webkit-transform: rotate(135deg);
}
#ctaLink {
	text-decoration: none;
	color: var(--col-cta3);
	border-radius: 64px;
	font-size: 24px;
	padding: 20px;
	background: linear-gradient(90deg, var(--col-cta1), var(--col-cta2));
	border: 6px solid var(--col-text2);
	animation: cta_float 6s ease-in-out infinite;
	max-width: 250px;
	overflow: hidden;
}
#ctaLink > svg {
	fill: var(--col-cta3);
	width: 1em;
	min-width: 1em;
}

.ctaGlint {
	width: 100%;
	height: 120%;
	position: absolute;
	background: linear-gradient(130deg, #0000 30%,#fff 40%,#0000 50%);
	animation: cta_glint 2s linear infinite;
	opacity: 0.5;
}

.contCta {
	background: var(--col-cta1);
	color: var(--col-text1);
}

@keyframes wofSpin {
  0% {
    transform: rotate(5deg);
  }
  100% {
    transform: rotate(0deg);
  }
}

@keyframes cta_float {
	0% {
		box-shadow: 0 5px 15px 0px rgba(0,0,0,0.6), inset 2px 4px 4px rgba(0,0,0,0.2);
		transform: translatey(0px);
	}
	50% {
		box-shadow: 0 25px 15px 0px rgba(0,0,0,0.2), inset 2px 4px 4px rgba(0,0,0,0.2);
		transform: translatey(-20px);
	}
	100% {
		box-shadow: 0 5px 15px 0px rgba(0,0,0,0.6), inset 2px 4px 4px rgba(0,0,0,0.2);
		transform: translatey(0px);
	}
}

@keyframes cta_jump {
  0% {
    transform: scale(1);
    box-shadow: 0 1px 2px rgba(0,0,0,.15), inset 2px 4px 4px rgba(0,0,0,0.2);
  }
  100% {
    transform: scale(1.05);
    box-shadow: 0 4px 20px rgba(0,0,0,.1), inset 2px 4px 4px rgba(0,0,0,0.2);
  }
}

@keyframes cta_pulse {
  0% {
    transform: scale(1);
    box-shadow: 0 2px 2px rgba(0,0,0,.2), inset 2px 4px 4px rgba(0,0,0,0.2);
    border-radius: 64px;
  }
  100% {
    transform: scale(1.05);
    box-shadow: 0 2px 2px rgba(0,0,0,.2), inset 2px 4px 4px rgba(0,0,0,0.2);
    border-radius: 32px;
  }
}

@keyframes spin_pulse {
  0% {
    transform: scale(1);
  }
  100% {
    transform: scale(1.05);
  }
}

@keyframes cta_wiggle {
  0% {
    transform: rotate(-3deg);
    box-shadow: 0 1px 2px rgba(0,0,0,.15), inset 2px 4px 4px rgba(0,0,0,0.2);
  }
  20% {
    transform: rotate(10deg);
  }
  40% {
    transform: rotate(-7deg);
  }
  60% {
    transform: rotate(3deg);
  }
  90% {
    transform: rotate(-1deg);
  }
  100% {
    transform: rotate(0);
    box-shadow: 0 1px 2px rgba(0,0,0,.15), inset 2px 4px 4px rgba(0,0,0,0.2);
  }
}

@keyframes cta_perspective {
  0% {
    transform: rotateX(10deg) rotateY(0deg);
    box-shadow: 0 1px 2px rgba(0,0,0,.15), inset 2px 4px 4px rgba(0,0,0,0.2);
  }
  12.5% {
    transform: rotateX(5deg) rotateY(5deg);
    box-shadow: 0 1px 2px rgba(0,0,0,.15), inset 2px 4px 4px rgba(0,0,0,0.2);
  }
  25% {
    transform: rotateX(0deg) rotateY(10deg);
    box-shadow: 0 1px 2px rgba(0,0,0,.15), inset 2px 4px 4px rgba(0,0,0,0.2);
  }
  37.5% {
    transform: rotateX(-5deg) rotateY(5deg);
    box-shadow: 0 1px 2px rgba(0,0,0,.15), inset 2px 4px 4px rgba(0,0,0,0.2);
  }
  50% {
    transform: rotateX(-10deg) rotateY(0deg);
    box-shadow: 0 1px 2px rgba(0,0,0,.15), inset 2px 4px 4px rgba(0,0,0,0.2);
  }
  62.5% {
    transform: rotateX(-5deg) rotateY(-5deg);
    box-shadow: 0 1px 2px rgba(0,0,0,.15), inset 2px 4px 4px rgba(0,0,0,0.2);
  }
  75% {
    transform: rotateX(0deg) rotateY(-10deg);
    box-shadow: 0 1px 2px rgba(0,0,0,.15), inset 2px 4px 4px rgba(0,0,0,0.2);
  }
  87.5% {
    transform: rotateX(5deg) rotateY(-5deg);
    box-shadow: 0 1px 2px rgba(0,0,0,.15), inset 2px 4px 4px rgba(0,0,0,0.2);
  }
  100% {
    transform: rotateX(10deg) rotateY(0deg);
    box-shadow: 0 1px 2px rgba(0,0,0,.15), inset 2px 4px 4px rgba(0,0,0,0.2);
  }
}

@keyframes cta_perspective2 {
	0%,
	100% {
		transform: rotateX(0deg);
		box-shadow: 0 1px 2px rgba(0,0,0,.15), inset 2px 4px 4px rgba(0,0,0,0.2);
		transform-origin: 50% 0%;
	}

	15% {
		transform: rotateX(-24deg);
	}

	30% {
		transform: rotateX(24deg);
	}

	45% {
		transform: rotateX(-14.4deg);
	}

	60% {
		transform: rotateX(7.2deg);
	}

	75% {
		transform: rotateX(-4.8deg);
	}
	
	90% {
		transform: rotateX(2.4deg);
	}
}

@keyframes cta_glint {
  0% {
    transform: translateX(-50%);
  }
  20% {
    transform: translateX(150%);
  }
  100% {
    transform: translateX(150%);
  }
}

@keyframes fadeIn {
0% {
	opacity: 0;
}
100% {
	opacity: 1;
}
}
.fadeIn {
	-webkit-animation: fadeIn 1s;
	animation: fadeIn 1s;
}
.fadeInFast {
	-webkit-animation: fadeIn 0.5s;
	animation: fadeIn 0.5s;
}
@media (orientation: portrait)
{
	#surveyClose.vkControl{
		top: calc(48px + 64px);
		//top: calc(env(safe-area-inset-top) + 64px);
		margin-right: 10px;
	}
}
@media (orientation: landscape)
{
	#textArea[type="number"] {
		max-width: 50%;
		height: 48px !important;
		font-size: 20px;
	}
}

.range {
	width: 80%;
	max-width: 480px;
}
.range-slider {
	height: 16px;
	position: relative;
	background-color: var(--col-counter-bg);
	border-radius: 16px;
	top: 4px;
}
.range-selected {
  height: 100%;
  left: 30%;
  right: 30%;
  position: absolute;
  border-radius: 5px;
  background-color: var(--col-but1);
}

.range-input {
  position: relative;
}
.range-input input {
  position: absolute;
  width: 100%;
  height: 5px;
  top: -7px;
  background: none;
  pointer-events: none;
  -webkit-appearance: none;
  -moz-appearance: none;
}
.range-input input::-webkit-slider-thumb {
  pointer-events: auto;
  -webkit-appearance: none;
}
.range-input input::-moz-range-thumb {
  pointer-events: auto;
  -moz-appearance: none;
}

.range-price {
    margin: 30px 0;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
	margin-top: 0px;
	font-weight: bold;
  }
  .range-price label {
    margin-right: 5px;
  }
  .range-price input {
    width: 100px;
    padding: 5px;
  }
  .range-price input:first-of-type {
    margin-right: 15px;
  }
  #range-name {
	text-align: center;
  }
#zoomedCont {
	background: #00000096;
	width: 100%;
	height: 100%;
	position: absolute;
	left: 0;
	top: 0;
	display: block;
	z-index: 9000;
}
#zoomedCont > div {
	display: flex;
	justify-content: center;
	align-items: center;
	width: 100%;
	height: 100%;
}
#zoomedCont > div > img {
	display: flex;
	flex-flow: row nowrap;
	align-items: center;
	max-width: 100%;
	max-height: 100%;
}
#zoomIcon {
	position: absolute;
	right: 0;
	bottom: 0;
	width: 32px;
	height: 32px;
	background: #0000007d;
	display: block;
	border-radius: 8px 0 0 0;
	cursor: pointer;
}
#zoomIcon > svg {
	fill: #ffffff;
	transform: scale(0.75);
}
#tapToCopy {
	font-style: italic;
	display: inline-block;
	height: 0;
}
#rewardCode {
	font-size: 9vmin;
	color: var(--col-text-reward);
	background: var(--col-text1);
	padding-left: 4px;
	padding-right: 4px;
	border-radius: 16px;
}
.zoomCross {
	display: block !important;
}
#quizTimer {
	display: none;
	position: absolute;
	top: env(safe-area-inset-top);
	padding-top: calc(20px + var(--safe-top));
	right: 0;
	padding-right: 1vw;
	font-weight: 700;
	text-align: right;
	font-size: max(2vw,16px);
}
#quizTimer.paused {
	opacity: 0.75;
}
@keyframes timerFlash {
0% {
	opacity: 1;
}
50% {
	opacity: 0.5;
}
100% {
	opacity: 1;
}
}
.timerFlash {
	-webkit-animation: timerFlash 1s infinite both;
	animation: timerFlash 1s infinite both;
}
#crossTimerBut {
	width: 20px;
	height: 20px;
	display: flex;
	justify-content: center;
	align-items: center;
	overflow: visible;
	color: var(--col-but1);
}

  </style>
<title>Mockup</title>
</head>
<body>
<div class="area" id="area"><ul class="circles"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul></div>
<img src="media/survey_logo.svg" id="logoImg"></img>
<div id="quizTimer"></div>
<div class="loaderCont" id="initLoader"><div class="loader">Loading...</div></div>
<div id="surveyClose" class="surveyClose">
	<svg viewbox="0 0 40 40" style="display: block;">
		<path style="fill: transparent; stroke-linecap: round; stroke-width: 5;" d="M 10,10 L 30,30 M 30,10 L 10,30"/>
	</svg>
</div>
<div id="confirmOverlay">
	<div id="confirmPopup">
		<div id="confirmPopupMain">
			<p><b>Закрыть опрос?</b><br>Вы потеряете награду</p>
		</div>
		<div id="confirmPopupButDiv">
			<div id="confirmNo" class="confirmNo"><b>Нет</b></div>
			<div id="confirmYes" class="confirmYes"><b>Да</b></div>
		</div>
	</div>
</div>
<script type="text/javascript">
var quizData={qid:1};
var apiData={
	endpoint: "https://api.kykyshka.ru/v1/service/",
	uid: "",
	gid: "",
	pictureEndpoint: "https://account.kykyshka.ru/",
	cityEndpoint: "https://account.kukushka.io/api/v1/service/cities",
	redirectEndpoint: "https://surveys.black-snowflake.org/redirect.php",
	externalContinue: "https://ext.kukushka.io/",
	rewEndpoint: "https://black-snowflake.org/quiz_mockup/rewCallback.php",
	rewDef: "https://www.pepper.ru/coupons"
};
var quizIndex=0;
var answers=[];
var images={};
var imagesLoaded=0;
var imagesTotal=0;
var canClick=true;
var ansParams={};
var secondsToClose=3;
var nextInd=-1;
var isWebView=0;
var multiSelectAnswer=[[]];
var otherString="";
var otherIndex=-1;
var otherChecker=false;
var touchArr=[];
var callbackData={};
var bgId="squares";
var filterColor="";
var previewMode=false;
var nextFinalId="";
var urlParams="";
var completedAnswers=[];
var quizScore=0;
var shuffledOrder=[];
var recalledMatrix=[];
var intervals={};
var goingBack=false;
var hideCrossByDefault=false;
var dontSendAnswers=false;
var externalData={};
var hasExternalData=false;
var hasReward=false;
var idData={};
var grabTheme=false;
var grabbedTheme=false;
var grabTexts=false;
var grabbedTexts=false;
var grabReward=false;
var grabbedReward=false;
var tempTheme={};
var tempReward={};
var forceContCtaColors=false;
var innerSurvey=false;
var timer={
	seconds: 0,
	target: null,
	callback: null,
	interval: null,
	svgPlayBut: ' <svg    xmlns:dc="http://purl.org/dc/elements/1.1/"    xmlns:cc="http://creativecommons.org/ns#"    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"    xmlns:svg="http://www.w3.org/2000/svg"    xmlns="http://www.w3.org/2000/svg"    width="17.664328mm"    height="17.664326mm"    viewBox="0 0 17.664328 17.664326"    version="1.1"    id="svg8">   <defs      id="defs2" />   <metadata      id="metadata5">     <rdf:RDF>       <cc:Work          rdf:about="">         <dc:format>image/svg+xml</dc:format>         <dc:type            rdf:resource="http://purl.org/dc/dcmitype/StillImage" />         <dc:title></dc:title>       </cc:Work>     </rdf:RDF>   </metadata>   <g      id="layer1"      transform="translate(-88.685849,-111.36444)">     <ellipse        style="fill:none;stroke:#000000;stroke-width:1.05833333;stroke-miterlimit:4;stroke-dasharray:none;paint-order:markers fill stroke;stop-color:#000000;fill-opacity:0.30240551"        id="path833"        cx="97.518013"        cy="120.1966"        rx="8.3029976"        ry="8.3029966" />     <path        style="fill:#ffffff;stroke:#000000;stroke-width:1.05833;stroke-miterlimit:4;stroke-dasharray:none;paint-order:markers fill stroke;stop-color:#000000;font-variation-settings:normal;opacity:1;vector-effect:none;fill-opacity:0.302406;stroke-linecap:butt;stroke-linejoin:miter;stroke-dashoffset:0;stroke-opacity:1;stop-opacity:1"        id="path835"        d="m 101.30515,120.1966 -2.840353,1.63988 -2.840353,1.63988 v -3.27976 -3.27976 l 2.840353,1.63988 z" />   </g> </svg>'
};
var quizTimer={
	seconds: 0,
	target: null,
	interval: null,
	paused: false
};
var crossTimer={
	seconds: 0,
	target: null,
	interval: null
};
var isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
var texts={
	ru: {
		success: "Спасибо за прохождение опроса!",
		unqualified: "Спасибо за прохождение опроса!",//"Извините, в этот раз вы не входите в целевую аудиторию опроса 😔",
		timeLeft: "Это окно закроется через *...",
		next: "Продолжить",
		test: "ТЕСТОВЫЙ РЕЖИМ",
		innerMode: "ВНУТРЕННИЕ ОПРОСЫ",
		noteSelect: "Выберите от %x% до %y% *",
		noteSelectMulti: "Можно выбрать несколько ответов",
		noteSelectMin: "Выберите от %x% *",
		noteSelectMax: "Выберите до %y% *",
		noteSelectEqual: "Выберите %x% *",
		noteSelectAll: "Выберите все подходящие ответы",
		placeholderText: "Введите свой ответ...",
		placeholderTextNumeric: "Введите число от %x% до %y%",
		other: "Введите свой ответ",
		cancel: "Отмена",
		ok: "ОК",
		closeLine0: "Закрыть опрос?",
		closeLine1: "Вы потеряете награду",
		yes: "Да",
		no: "Нет",
		answers: {
			nominative: ["ответ","ответа","ответов"],
			genitive: ["ответа","ответов","ответов"]
		},
		matrix: "в каждом утверждении",
		constantSum: "Сумма должна равняться",
		nocities: "Подходящих городов не найдено",
		spin: "ЖМИ",
		yourgift: "Ваш подарок:",
		cityQuestion: "Укажите ваш город",
		from: "От",
		to: "До",
		tapToCopy: "Нажмите на промокод, чтобы скопировать",
		copied: "Скопировано",
		continuous: "Подождите...",
		cta:
		{
			text:"Перейти",
			skip:"Неинтересно"
		},
		closeExt: "Спасибо!<br><br>Можете закрыть эту страницу",
		rewCode: "Спасибо за прохождение опроса!<br><br>Вот ваш промокод на ${value} ${decl}!",
		rewCodeUnqualified: "Спасибо за прохождение опроса!<br><br>Вот ваш промокод на ${value} ${decl}!",
		rewDecl: ["рубль","рубля","рублей"],
		rewLink: "Спасибо за прохождение опроса!<br><br>Перейдите по ссылке и заберите вашу награду!",
		rewLinkUnqualified: "Спасибо за прохождение опроса!<br><br>Перейдите по ссылке и заберите вашу награду!",
		rewBut: "Спасибо",
		codeSerial: "Серийный номер",
		codeActive: "Действует",
		codeActiveFrom: "с",
		codeActiveTo: "по"
	},
	en: {
		success: "Thank you for completing the survey!",
		unqualified: "Thank you for completing the survey!",//"Looks like the survey is aimed at people with different experience 😔",
		timeLeft: "This popup will close in *...",
		next: "Continue",
		test: "TEST MODE",
		innerMode: "INNER SURVEYS",
		noteSelect: "Select %x% to %y% *",
		noteSelectMulti: "You can choose multiple answers",
		noteSelectMin: "Select at least %x% *",
		noteSelectMax: "Select up to %y% *",
		noteSelectEqual: "Select %x% *",
		noteSelectAll: "Select all matching answers",
		placeholderText: "Enter your answer...",
		placeholderTextNumeric: "Enter a number from %x% to %y%",
		other: "Enter your answer",
		cancel: "Cancel",
		ok: "OK",
		closeLine0: "Close the survey?",
		closeLine1: "You will lose your reward",
		yes: "Yes",
		no: "No",
		answers: {
			plural:["answer","answers"]
		},
		matrix: "for each statement",
		constantSum: "Total must be",
		nocities: "No matching cities",
		spin: "SPIN",
		yourgift: "Your prize:",
		cityQuestion: "Enter your city",
		from: "From",
		to: "To",
		tapToCopy: "Tap the promocode to copy",
		copied: "Copied",
		continuous: "Please wait...",
		cta:
		{
			text:"Proceed",
			skip:"Not interested"
		},
		closeExt: "Thanks!<br><br>You can close this page",
		rewCode: "Thank you for completing the survey<br><br>Here is your ${value} ${decl} coupon!",
		rewCodeUnqualified: "Thank you for completing the survey<br><br>Here is your ${value} ${decl} coupon!",
		rewDecl: ["ruble","rubles","rubles"],
		rewLink: "Thank you for completing this survey!<br><br>Tap the button below to claim your reward!",
		rewLinkUnqualified: "Thank you for completing this survey!<br><br>Tap the button below to claim your reward!",
		rewBut: "Claim my reward",
		codeSerial: "Serial no",
		codeActive: "Active",
		codeActiveFrom: "from",
		codeActiveTo: "to"
	}
}
var REWARD_OVERRIDE="";
var lang="ru";
var savedCities={};
var icons={
	download: '<path d="M288 32c0-17.7-14.3-32-32-32s-32 14.3-32 32V274.7l-73.4-73.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0l128-128c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L288 274.7V32zM64 352c-35.3 0-64 28.7-64 64v32c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V416c0-35.3-28.7-64-64-64H346.5l-45.3 45.3c-25 25-65.5 25-90.5 0L165.5 352H64zm368 56a24 24 0 1 1 0 48 24 24 0 1 1 0-48z"/>'
	,shop: '<path d="M0 24C0 10.7 10.7 0 24 0H69.5c22 0 41.5 12.8 50.6 32h411c26.3 0 45.5 25 38.6 50.4l-41 152.3c-8.5 31.4-37 53.3-69.5 53.3H170.7l5.4 28.5c2.2 11.3 12.1 19.5 23.6 19.5H488c13.3 0 24 10.7 24 24s-10.7 24-24 24H199.7c-34.6 0-64.3-24.6-70.7-58.5L77.4 54.5c-.7-3.8-4-6.5-7.9-6.5H24C10.7 48 0 37.3 0 24zM128 464a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zm336-48a48 48 0 1 1 0 96 48 48 0 1 1 0-96z"/>'
	,arrow: '<path d="M310.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L242.7 256 73.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z"/>'
	,info: '<path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336h24V272H216c-13.3 0-24-10.7-24-24s10.7-24 24-24h48c13.3 0 24 10.7 24 24v88h8c13.3 0 24 10.7 24 24s-10.7 24-24 24H216c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"/>'
	,heart: '<path d="M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/>'
	,phone: '<path d="M164.9 24.6c-7.7-18.6-28-28.5-47.4-23.2l-88 24C12.1 30.2 0 46 0 64C0 311.4 200.6 512 448 512c18 0 33.8-12.1 38.6-29.5l24-88c5.3-19.4-4.6-39.7-23.2-47.4l-96-40c-16.3-6.8-35.2-2.1-46.3 11.6L304.7 368C234.3 334.7 177.3 277.7 144 207.3L193.3 167c13.7-11.2 18.4-30 11.6-46.3l-40-96z"/>'
	,bolt: '<path d="M349.4 44.6c5.9-13.7 1.5-29.7-10.6-38.5s-28.6-8-39.9 1.8l-256 224c-10 8.8-13.6 22.9-8.9 35.3S50.7 288 64 288H175.5L98.6 467.4c-5.9 13.7-1.5 29.7 10.6 38.5s28.6 8 39.9-1.8l256-224c10-8.8 13.6-22.9 8.9-35.3s-16.6-20.7-30-20.7H272.5L349.4 44.6z"/>'
	,pizza: '<path d="M169.7 .9c-22.8-1.6-41.9 14-47.5 34.7L110.4 80c.5 0 1.1 0 1.6 0c176.7 0 320 143.3 320 320c0 .5 0 1.1 0 1.6l44.4-11.8c20.8-5.5 36.3-24.7 34.7-47.5C498.5 159.5 352.5 13.5 169.7 .9zM399.8 410.2c.1-3.4 .2-6.8 .2-10.2c0-159.1-128.9-288-288-288c-3.4 0-6.8 .1-10.2 .2L.5 491.9c-1.5 5.5 .1 11.4 4.1 15.4s9.9 5.6 15.4 4.1L399.8 410.2zM176 208a32 32 0 1 1 0 64 32 32 0 1 1 0-64zm64 128a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zM96 384a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"/>'
	,vk: '<path d="M31.4907 63.4907C0 94.9813 0 145.671 0 247.04V264.96C0 366.329 0 417.019 31.4907 448.509C62.9813 480 113.671 480 215.04 480H232.96C334.329 480 385.019 480 416.509 448.509C448 417.019 448 366.329 448 264.96V247.04C448 145.671 448 94.9813 416.509 63.4907C385.019 32 334.329 32 232.96 32H215.04C113.671 32 62.9813 32 31.4907 63.4907ZM75.6 168.267H126.747C128.427 253.76 166.133 289.973 196 297.44V168.267H244.16V242C273.653 238.827 304.64 205.227 315.093 168.267H363.253C359.313 187.435 351.46 205.583 340.186 221.579C328.913 237.574 314.461 251.071 297.733 261.227C316.41 270.499 332.907 283.63 346.132 299.751C359.357 315.873 369.01 334.618 374.453 354.747H321.44C316.555 337.262 306.614 321.61 292.865 309.754C279.117 297.899 262.173 290.368 244.16 288.107V354.747H238.373C136.267 354.747 78.0267 284.747 75.6 168.267Z"/>'
	,user: '<path d="M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512H418.3c16.4 0 29.7-13.3 29.7-29.7C448 383.8 368.2 304 269.7 304H178.3z"/>'
	,star: '<path d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"/>'
	,search: '<path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"/>'
	,search_plus: '<path d="M 208 0 C 93.1 0 5.8355488e-017 93.1 0 208 C 0 322.9 93.1 416 208 416 C 253.9 416 296.29922 401.2 330.69922 376 L 457.30078 502.69922 C 469.80078 515.19922 490.09961 515.19922 502.59961 502.69922 C 515.09961 490.19922 515.09961 469.90039 502.59961 457.40039 L 376 330.69922 C 401.1 296.29922 416 253.9 416 208 C 416 93.1 322.9 5.8355488e-017 208 0 z M 208 64 A 144 144 0 1 1 208 352 A 144 144 0 1 1 208 64 z M 185.90234 114.50195 L 185.90234 185.90234 L 114.50195 185.90234 L 114.50195 230.09766 L 185.90234 230.09766 L 185.90234 301.49805 L 230.09766 301.49805 L 230.09766 230.09766 L 301.49805 230.09766 L 301.49805 185.90234 L 230.09766 185.90234 L 230.09766 114.50195 L 185.90234 114.50195 z " />'
	,envelope: '<path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4L236.8 313.6c11.4 8.5 27 8.5 38.4 0L492.8 150.4c12.1-9.1 19.2-23.3 19.2-38.4c0-26.5-21.5-48-48-48H48zM0 176V384c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V176L294.4 339.2c-22.8 17.1-54 17.1-76.8 0L0 176z"/>'
	,check: '<path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"/>'
	,music: '<path d="M499.1 6.3c8.1 6 12.9 15.6 12.9 25.7v72V368c0 44.2-43 80-96 80s-96-35.8-96-80s43-80 96-80c11.2 0 22 1.6 32 4.6V147L192 223.8V432c0 44.2-43 80-96 80s-96-35.8-96-80s43-80 96-80c11.2 0 22 1.6 32 4.6V200 128c0-14.1 9.3-26.6 22.8-30.7l320-96c9.7-2.9 20.2-1.1 28.3 5z"/>'
	,gamepad: '<path d="M192 64C86 64 0 150 0 256S86 448 192 448H448c106 0 192-86 192-192s-86-192-192-192H192zM496 168a40 40 0 1 1 0 80 40 40 0 1 1 0-80zM392 304a40 40 0 1 1 80 0 40 40 0 1 1 -80 0zM168 200c0-13.3 10.7-24 24-24s24 10.7 24 24v32h32c13.3 0 24 10.7 24 24s-10.7 24-24 24H216v32c0 13.3-10.7 24-24 24s-24-10.7-24-24V280H136c-13.3 0-24-10.7-24-24s10.7-24 24-24h32V200z"/>'
}
var sendAnswersFromPage=false;
var enableContinuous=true;
var isContinuous=false;
var currentBlock=0;
var nextBlockTimeout=3;
var startTimestamp=0;
var customVars={};
var onFailWhenUnqualified=true;
var forceReward=false;
var version={
	current: "1.0.0",
	_cmpr: function(a) {
		var x=a.split('.').map(e=> parseInt(e));
		var y=this.current.split('.').map(e=> parseInt(e));
		var z = "";

		for(i=0;i<x.length;i++) {
			if(x[i] === y[i]) {
				z+="e";
			} else
			if(x[i] > y[i]) {
				z+="m";
			} else {
				z+="l";
			}
		}
		if (!z.match(/[l|m]/g)) {
		  return 0;
		} else if (z.split('e').join('')[0] == "m") {
		  return 1;
		} else {
		  return -1;
		}
	},
	compare: function(op,a) {
		switch(op){
			case "=":
				return this._cmpr(a)==0;
			break;
			case ">":
				return this._cmpr(a)==-1;
			break;
			case "<":
				return this._cmpr(a)==1;
			break;
			case ">=":
				return this._cmpr(a)<=0;
			break;
			case "<=":
				return this._cmpr(a)>=0;
			break;
			default:
				return false;
			break;
		}
	}
};

const shrt={
	id: function(s){return document.getElementById(s);},
	q: function(s){return document.querySelector(s);},
	qAll: function(s){return document.querySelectorAll(s);},
	cr: function(s,p={}){var st=p.style;if(st){delete p.style;}var l=Object.assign(document.createElement(s),p);if(st){Object.assign(l.style,style);}return l;},
	wrap: function(s,p){s.innerHTML=p.outerHTML;p.parentNode.insertBefore(s,p);p.remove();}
}

function callSDK(data)
{
	/*if (isWebView)
	{
		switch(platform)
		{
			case 0: window.parent.postMessage(data,"*"); break;
			case 1: window.parent.postMessage(data,"*"); break;
			default: console.log("error: unsupported platform id "+platform); break;
		}
	}
	else*/
	var _isUnity=false;
	if (window.Unity)
		if (typeof window.Unity.call!="undefined")
			_isUnity=true;
	if (_isUnity && is_iOS() && version.compare(">=","1.0.2"))
		Unity.call(data,"*");
	else
		window.parent.postMessage(data,"*");
}

function startSurvey() {
	startTimestamp=new Date();
	quizIndex=0;
	dontSendAnswers=false;
	for (var i=0; i<quizData.questions.length; i++)
	{
		//answers[i]={question_id:quizData.questions[i].id};
		try {
			var _q_customParams=JSON.parse(HtmlSanitizer.SanitizeHtml((quizData.questions[i].customParams || "{}").replaceAll('"','\"')));
			var _q_params=JSON.parse(HtmlSanitizer.SanitizeHtml((quizData.questions[i].params || "{}").replaceAll('"','\"')));
			Object.assign(_q_params,_q_customParams);
			if (typeof _q_params.additionalData=="undefined") _q_params.additionalData=[];
			quizData.questions[i].customParams=_q_params;
		}catch(e){}
	}
	quizData.settings={};//JSON.parse(quizData.settings);
	if (quizData.hasOwnProperty("customParams"))
	{
		try {
			if (quizData.customParams=="") quizData.customParams="{}";
			quizData.customParams=JSON.parse(HtmlSanitizer.SanitizeHtml(quizData.customParams));
			Object.assign(quizData.settings,quizData.customParams);
		}catch(e){}
	}
	if (typeof quizData.customParams=="object" && quizData.customParams.hasOwnProperty("rewardData")===false)
		if (forceReward)
			quizData.customParams.rewardData={enabled:true};
	if (typeof quizData.customParams=="object" && quizData.customParams.rewardData)
		if (quizData.customParams.rewardData.enabled)
			hasReward=true;
	try{shrt.id("initLoader").remove();}catch(e){}
	try{shrt.id("questionDiv").remove();shrt.id("answersDiv").remove();shrt.id("backBut").remove();shrt.id("popupCont").remove();shrt.id("otherPopupCont").remove();}catch(e){}
	document.body.insertAdjacentHTML("beforeend",'<div id="questionDiv" class="questionDiv"><div id="progressCont" class="progressCont"><div id="progressBar"></div></div><div class="questionContent" id="questionContent"></div></div><div id="answersDiv" class="answersDiv"></div><div id="backBut"><div></div></div><div id="popupCont" class="popupCont" style="display: none;" onclick="closePopup()"><div id="popup" class="popup"><iframe id="popupIframe" src="">...</iframe><div id="popupClose" onclick="closePopup()">Закрыть</div></div></div><div id="otherPopupCont" class="popupCont" style="display: none; background: #00000045"><div id="otherPopup" class="popup" style="max-height: 192px;"><div id="otherPopupInput"><p>'+texts[lang].other+'</p><textarea id="otherInput" autocomplete="off" maxlength=500 placeholder="'+texts[lang].placeholderText+'"></textarea></div><div id="otherPopupClose"><div id="otherYes" class="confirmNo" onclick="handleOther(true)">'+texts[lang].ok+'</div><div id="otherNo" class="confirmYes" onclick="handleOther(false)">'+texts[lang].cancel+'</div></div></div></div>');
	shrt.id("popupIframe").onload=function(){this.style.opacity=1;}
	showBackBut(false);
	completedAnswers=[];
	shrt.id("backBut").onclick=function(){
		if (completedAnswers.length>0)
		{
			nextInd=completedAnswers[completedAnswers.length-1];
			completedAnswers.pop();
			var _k=Object.keys(customVars);
			for (var i=0; i<_k.length; i++)
				customVars[_k[i]].pop();
			setAnswer([],(answers[quizIndex].hasOwnProperty("array_of_strings")));
			if (answers[quizIndex].hasOwnProperty("array_of_untis"))
				if (answers[quizIndex].array_of_uints.hasOwnProperty("own_answer"))
					delete answers[quizIndex].array_of_uints.own_answer;
			clearInterval(timer.interval);
			goingBack=true;
			nextQuestion();
			completedAnswers.pop();
			for (i=0; i<_k.length; i++)
				customVars[_k[i]].pop();
		}
	}
	if (grabbedTheme)
		quizData.settings.theme=tempTheme;
	if (grabbedReward)
		quizData.settings.reward=tempReward;
	console.log(quizData.settings.theme);
	themeSetup();
	quizDataSetup();
	answers=[];
	for (i=0; i<quizData.questions.length; i++)
		answers[i]={question_id:quizData.questions[i].id};
	imagesSetup(function(){if(currentBlock==0){callSDK('{"surveyMaster":{"event":"onPageReady","data":{}}}');}});
	if (hasExternalData)
	{
		answers=externalData.a;
		quizIndex=externalData.i+1;
		quizData.questions[quizIndex].customParams.cantGoBack=true;
	}
	if (quizData.customParams.skipFirst && quizData.questions.length>1)
	{
		quizIndex=1;
		quizData.questions[1].customParams.cantGoBack=true;
		if (!(quizData.customParams.idData))
			quizData.customParams.idData=[{question_id:0,name:"utm_source"}];
	}
	if (quizData.customParams.quizTimer && quizData.customParams.quizTimer.enabled)
	{
		var _qt=shrt.id("quizTimer");
		_qt.style.display="block";
		startQuizTimer(_qt);
	}
	if (quizData.customParams.crossTimer && quizData.customParams.crossTimer.enabled)
	{
		shrt.id("surveyClose").insertAdjacentHTML("afterend",'<div id="crossTimer" class="surveyClose"><div id="crossTimerBut"><span>-</span></div></div>');
		startCrossTimer(quizData.customParams.crossTimer.seconds || 30,shrt.q("#crossTimerBut > span"),function(){completeCrossTimer(false);});
	}
	if (quizData.customParams.postbacks && quizData.customParams.postbacks.enabled)
		if (!Array.isArray(quizData.customParams.postbacks.list))
			quizData.customParams.postbacks.list=["completed","closed","timeout"];
	populateQuiz();
	console.log("startsurvey");
}

function setAnswer(arr,type,qnum)
{
	if (typeof qnum=="undefined")
		qnum=quizIndex;
	if (type)
	{
		answers[qnum].array_of_strings={};
		answers[qnum].array_of_strings.array=arr;
	}
	else
	{
		answers[qnum].array_of_uints={};
		answers[qnum].array_of_uints.array=arr;
		var _closedCats=[0,1,2,3];
		if (!(quizData.questions[qnum].customParams.hasOwnProperty("promoScratch") && quizData.questions[qnum].customParams.promoScratch.enabled) &&_closedCats.indexOf(quizData.questions[qnum].category)>-1 && typeof quizData.questions[qnum].customParams=="object" && Array.isArray(quizData.questions[qnum].customParams.additionalData))
		{
			if (typeof quizData.questions[qnum].additionalDataInit=="undefined")
			{	
				quizData.questions[qnum].additionalDataInit=[];
				var i;
				for (i=0; i<quizData.questions[qnum].customParams.additionalData.length; i++)
					quizData.questions[qnum].additionalDataInit.push(quizData.questions[qnum].customParams.additionalData[i]);
			}
			quizData.questions[qnum].customParams.additionalData=[];
			var i;
			for (i=0; i<arr.length; i++)
				quizData.questions[qnum].customParams.additionalData.push(quizData.questions[qnum].additionalDataInit[arr[i]] || "");
		}
	}
	answers[qnum].targetId=quizData.questions[qnum].targetId;
}
var clickCallback = function() { try {
  if (canClick && this.dataset.clickable!=="false")
	  {
	  var _type=quizData.questions[quizIndex].type || 0;
	  /*if (this.id=="slider")
		setAnswer([parseInt(this.value)]);
	  else*/
	  {
		switch (_type)
		{
			case 10:
				var _val=shrt.id("ageSelect").value; //shrt.id("numberInput").value;
				if (_val=="")
					return;
				setAnswer([parseInt(_val)]);
			break;
			case 1:
				setAnswer([parseInt(shrt.id("slider").value)]);
			break;
			case 2:
				if (typeof answers[quizIndex].array_of_uints!="undefined" && typeof answers[quizIndex].array_of_uints.array!="undefined" && answers[quizIndex].array_of_uints.array.length>0)
					nextQuestion();
				return;
			break;
			case 4:
				if (this.id=="answersBut"+otherIndex)
				{
					if (multiSelectAnswer[0].length<quizData.questions[quizIndex].maxAnswersNumber || quizData.questions[quizIndex].maxAnswersNumber==1 || (this.dataset.selected=="true" && multiSelectAnswer[0].length==quizData.questions[quizIndex].maxAnswersNumber))
					{
						if (shrt.id("otherPopupCont").style.display=="none")
						{
							shrt.id("otherPopupCont").style.display="flex";
							shrt.id("otherInput").focus();
						}
						if (otherChecker==true)
						{
							this.dataset.selected=!(otherString=="");
							shrt.id("checkbox"+otherIndex).style.opacity=(otherString=="") ? 0 : 1;
							var i, _mnn, _msa;
							_mnn=quizData.questions[quizIndex].maxAnswersNumber;
							_msa=multiSelectAnswer[0].length;
							if (otherString!="")
							{
								if (_msa>0)
								{
									for (i=0; i<_msa; i++)
									{
										if (_mnn==1 || shrt.id("answer"+multiSelectAnswer[0][i]).dataset.answergroup!=shrt.id("answer"+otherIndex).dataset.answergroup)
										{
											var _oldselect=shrt.id("answersBut"+multiSelectAnswer[0][i]);
											_oldselect.dataset.selected="false";
											shrt.id("checkbox"+multiSelectAnswer[0][i]).style.opacity=0;
										}
									}
								}
								this.dataset.selected="true"
								shrt.id("checkbox"+this.dataset.number).style.opacity=1;
							}
						}
						otherChecker=false;
					}
						
					multiSelectAnswer=[[]];
					for (i=0; i<quizData.questions[quizIndex].answers.length; i++)
						if (shrt.id("checkbox"+i).style.opacity==1)
							multiSelectAnswer[0].push(i);
					shrt.id("contBut").style.filter=(multiSelectAnswer[0].length<quizData.questions[quizIndex].minAnswersNumber) ? "grayscale(1)" : "none";
					shrt.id("contBut").dataset.clickable=!(multiSelectAnswer[0].length<quizData.questions[quizIndex].minAnswersNumber);
					return;
				}
				if (quizData.questions[quizIndex].customParams.hasOwnProperty("quiz"))
				{try{
					var _quizObj=quizData.questions[quizIndex].customParams.quiz;
					if (_quizObj.enabled==true)
					{
						var i;
						for (i=0; i<quizData.questions[quizIndex].answers.length; i++)
						{
							shrt.id("answersBut"+i).dataset.clickable="false";
							shrt.id("answersBut"+i).dataset.quizselected="true";
							shrt.q("#answersBut"+i+" > .multiButCont > .quizBg").style.width="calc("+(_quizObj.answerData[i].percentage || 0)+"% - 44px)";
							shrt.q("#answersBut"+i+" > .multiButCont > .quizBg").style.minWidth="22px";
							shrt.q("#answersBut"+i+" > .multiButCont > .quizBg").style.background=_quizObj.answerData[i].correct==true ? "var(--col-quiz-right)" : "var(--col-quiz-wrong)";
							var _percCnt=document.createElement("span");
							_percCnt.classList.add("quizPerc");
							_percCnt.innerHTML=HtmlSanitizer.SanitizeHtml((_quizObj.answerData[i].percentage || 0)+"%");
							shrt.q("#answersBut"+i+" > .multiButCont").appendChild(_percCnt);
						}
						var _ansData=_quizObj.answerData[parseInt(this.dataset.number)] || {};
						if (_ansData.hasOwnProperty("text"))
							shrt.id("qText").innerHTML=HtmlSanitizer.SanitizeHtml(_ansData.text.replaceAll("${quizTimer}",shrt.id("quizTimer").innerHTML));
						if (this.id!="contBut")
						{
							if (_ansData.correct==true)
								quizScore++;
							else
								shrt.id("checkbox"+this.dataset.number).classList.add("multiSelectCheckmarkWrong");
						}
					}
				}catch(e){console.log(e)}}
				var _isMtr=this.dataset.hasOwnProperty("matrixnum");
				var _mtrNum=_isMtr ? parseInt(this.dataset.matrixnum) : 0;
				var _contStatement;
				if (quizData.questions[quizIndex].matrix.isMatrix)
				{
					var _comp=[];
					for (var i=0; i<multiSelectAnswer.length; i++)
						if (recalledMatrix.indexOf(i)>-1)
							_comp.push(multiSelectAnswer[i]);
					_contStatement=_comp.every(function(e){return e.length>=quizData.questions[quizIndex].minAnswersNumber;});
				}
				else
					_contStatement=(multiSelectAnswer[_mtrNum].length>=quizData.questions[quizIndex].minAnswersNumber);
				if (this.dataset.hasOwnProperty("selected"))
				{
					if (quizData.questions[quizIndex].maxAnswersNumber==1)
					{
						if (multiSelectAnswer[_mtrNum].length>0)
						{
							var _oldselect=shrt.id("answersBut"+multiSelectAnswer[_mtrNum][0]+(_isMtr ? "_"+_mtrNum : ""));
							_oldselect.dataset.selected="false";
							shrt.id("checkbox"+multiSelectAnswer[_mtrNum][0]+(_isMtr ? "_"+_mtrNum : "")).style.opacity=0;
						}
						this.dataset.selected="true"
						shrt.id("checkbox"+this.dataset.number+(_isMtr ? "_"+_mtrNum : "")).style.opacity=1;
					}
					else
					{
						var i, _ansCmp;
						var _toremove=[];
						for (i=0; i<multiSelectAnswer[_mtrNum].length; i++)
						{
							_ansCmp=shrt.id("answersBut"+multiSelectAnswer[_mtrNum][i]+(_isMtr ? "_"+_mtrNum : ""));
							if (_ansCmp.dataset.selected=="true" && _ansCmp.dataset.answergroup!=this.dataset.answergroup)
							{
								_ansCmp.dataset.selected=false;
								shrt.id("checkbox"+multiSelectAnswer[_mtrNum][i]+(_isMtr ? "_"+_mtrNum : "")).style.opacity=0;
								_toremove.push(i);
							}
						}
						for (i=0; i<_toremove.length; i++)
							multiSelectAnswer[_mtrNum].splice(_toremove[i],1);
						if (!(this.dataset.selected=="false" && multiSelectAnswer[_mtrNum].length>=quizData.questions[quizIndex].maxAnswersNumber))
						{
							this.dataset.selected=(this.dataset.selected=="true" ? "false" : "true");
							shrt.id("checkbox"+this.dataset.number+(_isMtr ? "_"+_mtrNum : "")).style.opacity=this.dataset.selected=="true" ? 1 : 0;
						}
					}
					multiSelectAnswer[_mtrNum]=[];
					for (i=0; i<quizData.questions[quizIndex].answers.length; i++)
						if (shrt.id("checkbox"+i+(_isMtr ? "_"+_mtrNum : "")).style.opacity==1)
							multiSelectAnswer[_mtrNum].push(i);
					try{if (quizData.questions[quizIndex].maxAnswersNumber==1){shrt.id("matrixHead"+_mtrNum).click();}else{shrt.q("#matrixHead"+_mtrNum+" > span:last-of-type").innerHTML="✓".repeat(Math.max(multiSelectAnswer[_mtrNum].length,1)); shrt.q("#matrixHead"+_mtrNum+" > span:last-of-type").style.opacity=multiSelectAnswer[_mtrNum].length>0 ? 1 : 0;}}catch(e){}
					var _mfafin=[];
					for (i=0; i<multiSelectAnswer.length; i++)
						if (!(shrt.id("matrixHead"+i)) || (shrt.id("matrixHead"+i).dataset.hasOwnProperty("omit")==false))
							_mfafin.push(multiSelectAnswer[i]);
					var _cond=_mfafin.every(function(e){return e.length>=quizData.questions[quizIndex].minAnswersNumber;});
					shrt.id("contBut").style.filter=!(_cond) ? "grayscale(1)" : "none"; //(multiSelectAnswer[0].length<quizData.questions[quizIndex].minAnswersNumber)
					shrt.id("contBut").dataset.clickable=_cond;
					return;
				}
				else
				if (_contStatement)
				{
					for (i=0; i<multiSelectAnswer.length; i++)
						setAnswer(multiSelectAnswer[i],false,quizIndex+i);
					if (quizData.questions[quizIndex].hasOwnProperty("next"))
						nextInd=quizData.questions[quizIndex].next;
					if (quizData.questions[quizIndex].maxAnswersNumber==1 && !isNaN(parseInt(multiSelectAnswer[_mtrNum][0])))
					{
						var _nxt=parseInt(multiSelectAnswer[_mtrNum][0]);
						try {
						if (typeof quizData.questions[quizIndex].answers=="object")
							if (quizData.questions[quizIndex].answers[_nxt].hasOwnProperty("next"))
								nextInd=quizData.questions[quizIndex].answers[_nxt].next;
						} catch(e){console.log(e);}
					}
					if (quizData.questions[quizIndex].answers.length>0 && multiSelectAnswer[_mtrNum].length>0)
					{
						if (quizData.questions[quizIndex].category==3)
						{
							var i;
							if (typeof quizData.questions[quizIndex].answers[0].screening=="boolean")
							{
								for (i=0; i<multiSelectAnswer[_mtrNum].length; i++)
									if (quizData.questions[quizIndex].answers[multiSelectAnswer[_mtrNum][i]].screening==false)
									ansParams.nq=1;
							}
							else
							{
								var _avAns=0;
								for (i=0; i<multiSelectAnswer[_mtrNum].length; i++)
								{
									if (quizData.questions[quizIndex].answers[multiSelectAnswer[_mtrNum][i]].screening==1)
									{	
										_avAns=0;
										break;
									}
									if (quizData.questions[quizIndex].answers[multiSelectAnswer[_mtrNum][i]].screening==0)
										_avAns++;
								}
								if (_avAns==0)
									ansParams.nq=1;
							}
						}
					}
				}
				else
					return;
			break;
			case 5:
				var _textarea=shrt.id("textArea")
				if (_textarea.value.length>=_textarea.minLength)
				{
					if (quizData.questions[quizIndex].hasOwnProperty("next"))
						nextInd=quizData.questions[quizIndex].next;
					if (quizData.questions[quizIndex].hasOwnProperty("customParams") && typeof quizData.questions[quizIndex].customParams=="object" && quizData.questions[quizIndex].customParams.parentTextField==true)
						setAnswer([0]);
					else
						setAnswer([(quizData.questions[quizIndex].customParams.md5Answer ? md5(_textarea.value) : _textarea.value)],true);
				}
			break;
			case 6:
				if (quizData.questions[quizIndex].hasOwnProperty("matrix") && quizData.questions[quizIndex].matrix.isMatrix)
				{
					if (quizData.questions[quizIndex].hasOwnProperty("next"))
						nextInd=quizData.questions[quizIndex].next;
					var _textarea=shrt.qAll("input[id^='textArea']");
					var i;
					for (i=0; i<_textarea.length; i++)
						setAnswer([parseInt(_textarea[i].value)],false,quizIndex+(parseInt(_textarea[i].id.replaceAll("textArea","")) || 0));
				}
				else
				{
					var _textarea=shrt.id("textArea")
					if (parseInt(_textarea.value)>=parseInt(_textarea.min) && parseInt(_textarea.value)<=parseInt(_textarea.max) && !quizData.questions[quizIndex].customParams.cityQuestion)
					{
						if (quizData.questions[quizIndex].hasOwnProperty("next"))
							nextInd=quizData.questions[quizIndex].next;
						setAnswer([parseInt(_textarea.value)]);
					}
				}
			break;
			case 8:
				var _textarea=shrt.id("starsHidden")
				if (!isNaN(parseInt(_textarea.value)))
				{
					if (quizData.questions[quizIndex].hasOwnProperty("next"))
						nextInd=quizData.questions[quizIndex].next;
					setAnswer([parseInt(_textarea.value)]);
				}
			break;
			default:
				setAnswer([parseInt(this.dataset.number)]);
				if (quizData.questions[quizIndex].hasOwnProperty("next"))
					nextInd=quizData.questions[quizIndex].next;
				try {
				if (typeof quizData.questions[quizIndex].answers=="object")
					if (quizData.questions[quizIndex].answers[answers[quizIndex].array_of_uints.array[0]].hasOwnProperty("next"))
						nextInd=quizData.questions[quizIndex].answers[answers[quizIndex].array_of_uints.array[0]].next;
				} catch(e){console.log(e);}
			break;
		}
		if (answers[quizIndex].hasOwnProperty("array_of_uints") && answers[quizIndex].array_of_uints.array.indexOf(otherIndex)>-1)
			answers[quizIndex].array_of_uints.own_answer=otherString;
		if (this.dataset.hasOwnProperty("nq"))
			ansParams.nq=1;
	  }
	  if (this.dataset.hasOwnProperty("quiz"))
	  {
		shrt.id("questionText").innerHTML=quizData.questions[quizIndex].explain[this.dataset.quiz].text;
		canClick=false;
		for (i=0; i<quizData.questions[quizIndex].answers.length; i++)
		{
			if (quizData.questions[quizIndex].correct!=i)
				shrt.id("answer"+i).style.opacity=0.5;
			if (i==this.dataset.number)
				shrt.id("answer"+i).style.transform="scale(75%)";
		}
		setTimeout(nextQuestion,2000);
	  }
	  else
		nextQuestion();
  }
  } catch(e){console.log(e);}
};

function nextQuestion(params)
{
  canClick=true;
  nextFinalId="";
  completedAnswers.push(quizIndex);
  if (!goingBack && quizData.questions[quizIndex].category!=4 && ansParams.nq!=1)
  {
	  var _redirect=checkRules();
	  if (_redirect.redirect.question_id>=-2)
		  nextInd=_redirect.redirect.question_id;
	  if (_redirect.redirect.block_id!="")
		  nextInd=-2;
	  handleCustomVars(_redirect.customVars);
  }
  goingBack=false;
  try {document.querySelector("video").pause();}catch(e){}
  if (typeof nextInd=="object")
  {
	nextFinalId=nextInd.itemId;
    nextInd=nextInd.next;
  }
  var _pts=shrt.qAll(".clickMapPointer");
  for (var i=0; i<_pts.length; i++)
	_pts[i].remove();
  if (ansParams.hasOwnProperty("nq") || nextInd==-2)
	quizIndex=quizData.questions.length-1;
	var _quizAdd=1;
	if (nextInd>-1)
		_quizAdd=nextInd-quizIndex;
	quizIndex=Math.max(0,Math.min(quizIndex+_quizAdd,quizData.questions.length));
	nextInd=-1;
	var _cantGoBack=quizData.settings.cantGoBack || false;
	if (quizIndex<quizData.questions.length && quizData.questions[quizIndex].customParams.hasOwnProperty("cantGoBack"))
		_cantGoBack=quizData.questions[quizIndex].customParams.cantGoBack;
		showBackBut((quizIndex>0 && _cantGoBack==false));
  if (quizIndex<quizData.questions.length)
    populateQuiz();
  else {
    progressBar(100);
	showBackBut(false);
	stopQuizTimer();
	if (shuffledOrder.length>0)
	{
		var _origAnswers=[];
		for (i=0; i<shuffledOrder.length; i++)
			_origAnswers[shuffledOrder[i]]=answers[i];//.push(answers[shuffledOrder[i]])
		answers=_origAnswers;
	}
	if (typeof quizData.customParams=="object")
	{
		if (Array.isArray(quizData.customParams.idData))
		{
			var _dtobj;
			for (i=0; i<quizData.customParams.idData.length; i++)
			{
				_dtobj=quizData.customParams.idData[i];
				if (typeof _dtobj=="object")
					if (_dtobj.hasOwnProperty("question_id") && _dtobj.hasOwnProperty("name"))
						if (_dtobj.question_id>=0 && _dtobj.question_id<quizData.questions.length)
							if (idData.hasOwnProperty(_dtobj.name))
								setAnswer([idData[_dtobj.name]],true,_dtobj.question_id);
			}
		}
	}
	backdata={
		start_time: quizData.timerData.startTime,
		token: quizData.timerData.token,
		answers: {answers:answers},
		survey_key: quizData.surveyKey,
		clickmap: touchArr
	}
	if (ansParams.hasOwnProperty("nq"))
	{
		backdata.nq=1;
		//hasReward=false;
	}
	isContinuous=false;
	var _contBlocks=["28384a6f-24af-46dc-8057-1a25c3d92bb9"];
	var _contGames=["5Ap1cgb6CYzioxqYkqIyqlsrsKyrI105qA0vu2uLprlEO4NJxN6BLzchxfbfm0bw"]; //
	if (enableContinuous && (sendAnswersFromPage || isWebView) && (_contGames.indexOf(apiData.gid)>=0 || _contGames.length==0) && ((typeof quizData.customParams=="object" && quizData.customParams.continuous) || _contBlocks.indexOf(quizData.id)>=0))
		isContinuous=true;
	if (apiData.gid!="")
	{
		console.log({body:backdata});
		if (sendAnswersFromPage || isWebView)
		{
			var pageBackdata={}; Object.assign(pageBackdata,backdata);
			pageBackdata.user_id=apiData.uid;
			pageBackdata.app_key=apiData.gid;
			pageBackdata.time_spent=Math.round((new Date()-startTimestamp)/1000);
			if (pageBackdata.hasOwnProperty("nq")){delete pageBackdata.nq;}
			if (!dontSendAnswers)
			{
				request(apiData.endpoint+"survey/answer","POST",{body:pageBackdata}).then(res=>{
					console.log("Survey answers successfuly sent: "+JSON.stringify(res));
					if (!hasExternalData)
					{
						if (hasReward)
						{
							rewHandle();
						}
						else
						if (isContinuous)
							setTimeout(loadNextBlock,nextBlockTimeout*1000);
				}})
				.catch(e=>{
					console.log("Survey answers sending failed: "+JSON.stringify(e));
					if (!hasExternalData)
					{
						if (hasReward)
						{
							rewHandle();
						}
						else
						if (isContinuous)
						{
							secondsToClose++;
							closeTimer();
						}
				}});
				if (hasExternalData)
				{
					secondsToClose++;
					closeTimer();
				}
			}
			else
			{
				if (hasReward)
				{
					rewHandle();
				}
				else
				if (isContinuous)
					setTimeout(loadNextBlock,nextBlockTimeout*1000);
				else
				{
					secondsToClose++;
					closeTimer();
				}
			}
		}
		else
			callSDK(JSON.stringify({"surveyMaster":{"event":"onAnswersReady","data":{body:backdata}}}));
	}
	shrt.id("questionDiv").style.height="100%";
	shrt.id("answersDiv").style.display="none";
	shrt.id("progressCont").style.position="absolute";
	shrt.id("progressCont").style.top="env(safe-area-inset-top)";
	shrt.id("progressCont").style.left="50%";
	shrt.id("progressCont").style.transform="translateX(-50%)";
	if (shrt.id("questionPicDiv"))
		shrt.id("questionPicDiv").style.display="none";
	shrt.id("surveyClose").style.display="none";
	if (shrt.id("crossTimer"))
		completeCrossTimer(true);
	sendPostback("completed");
	try {
		shrt.id("answerSearchField").remove();
	}catch(e){};
	if (isContinuous || hasReward)
		shrt.id("questionText").innerHTML=texts[lang].continuous;
	else
	{
		secondsToClose++;
		closeTimer();
	}
  }
}

function loadNextBlock(){
	currentBlock++;
	var _getBody={user_id:apiData.uid.toString(),app_key:apiData.gid.toString()};
	if (innerSurvey)
		_getBody.inner_survey=1;
	request(apiData.endpoint+"survey/get","POST",{body:_getBody}).then(res=>{
		console.log(res);
		var _result=false;
		if (res.hasOwnProperty("block"))
			if (res.block.id!=quizData.id)
				_result=true;
		if (_result)
			handleQuizObj(res);
		else
			closeTimer();
	})
	.catch(e=>{
		console.log(e);
		closeTimer();
	});
}

function rewHandle(){
	if (quizData.customParams.rewardData.text_code)
		texts[lang].rewCode=quizData.customParams.rewardData.text_code;
	if (quizData.customParams.rewardData.text_link)
		texts[lang].rewLink=quizData.customParams.rewardData.text_link;
	if (quizData.customParams.rewardData.text_link_unqualified)
		texts[lang].rewLinkUnqualified=quizData.customParams.rewardData.text_link_unqualified;
	if (quizData.customParams.rewardData.decl)
		texts[lang].rewDecl=quizData.customParams.rewardData.decl;
	if (quizData.customParams.rewardData.text_button)
		texts[lang].rewBut=quizData.customParams.rewardData.text_button;
	var rewObjDef={type:"link",value:texts[lang].rewLink,intValue:0};
	{
		request(apiData.rewEndpoint+"?f=c&u="+apiData.uid+"&t="+quizData.timerData.token+"&s="+quizData.id,"GET",{}).then(res=>{
			if (quizData.settings.reward)
				rewPlace(quizData.settings.reward);
			else
			if (res.hasOwnProperty("type"))
				rewPlace(res);
			else
				rewPlace(rewObjDef);
		}).catch(e=>
		{console.log(e);
			if (quizData.settings.reward)
				rewPlace(quizData.settings.reward);
			else
				rewPlace(rewObjDef);
		}
		);
	}
}

function rewPlace(obj)
{
	switch(obj.type)
	{
		case "code":
			shrt.id("questionText").innerHTML=HtmlSanitizer.SanitizeHtml((backdata.nq ? texts[lang].rewCodeUnqualified : texts[lang].rewCode).replaceAll("${value}",obj.intValue).replaceAll("${decl}",declOfNum(obj.intValue,texts[lang].rewDecl)))
			+'<br><br><span id="rewardCode">'+HtmlSanitizer.SanitizeHtml(obj.value)+'</span>'
			+'<br><br><span id="copyText">'+texts[lang].tapToCopy+'</span>';
			shrt.id("rewardCode").dataset.clipboardText=obj.value;
			var _copyObj=new ClipboardJS('#rewardCode');
			shrt.id("rewardCode").style.cursor="pointer";
			shrt.id("rewardCode").addEventListener("click",function(){
				try{shrt.id("copyText").innerHTML=texts[lang].copied;}catch(e){}
			});
			var _fp=[];
			if (obj.hasOwnProperty("serial"))
				if (obj.serial!="");
					_fp.push(texts[lang].codeSerial+" "+obj.serial);
			if (obj.hasOwnProperty("active_from") || obj.hasOwnProperty("active_to"))
				_fp.push(texts[lang].codeActive+(obj.hasOwnProperty("active_from") ? " "+texts[lang].codeActiveFrom+" "+obj.active_from : "")+(obj.hasOwnProperty("active_to") ? " "+texts[lang].codeActiveTo+" "+obj.active_to : ""));
			var _fineprint=shrt.cr("fineprint");
			_fineprint.id="fineprint";
			_fineprint.className="fineprint";
			_fineprint.innerHTML=_fp.join("<br>");
			shrt.id("questionDiv").appendChild(_fineprint);
		break;
		case "link":
			console.log(backdata);
			shrt.id("questionText").innerHTML=HtmlSanitizer.SanitizeHtml(backdata.nq ? texts[lang].rewLinkUnqualified : texts[lang].rewLink);
			var _link=createCtaLink({link:obj.value,text:texts[lang].rewBut,animation:"none",track:false});
			_link.style.margin="32px";
			shrt.id("questionContent").appendChild(_link);
		break;
		default: break;
	}
}

function questionNumById(id)
{
	for (var i=0; i<quizData.questions.length; i++)
	{
		if (quizData.questions[i].id==id)
			return i;
	}
	return -1;
}

function closeTimer()
{
	secondsToClose--;
	if (secondsToClose>0)
	{
		shrt.id("questionText").innerHTML=hasExternalData ? texts[lang].closeExt : ((backdata.nq ? texts[lang].unqualified : texts[lang].success)+"<br><br>"+texts[lang].timeLeft.replace("*",secondsToClose));
		if (!hasExternalData)
			setTimeout(closeTimer,1000);
	}
	else
		closeWindow();
}

function closeWindow()
{
	if (nextFinalId!="")
	  callSDK({nextBlock: nextFinalId});
	if (typeof quizData.customParams=="object" && quizData.customParams.blockType)
		callSDK({customData:{name:"blockPassed",data:{blockType:quizData.customParams.blockType || "test",blockId:quizData.id}}});
	if (!backdata.nq)
		backdata.nq=0;
	if (typeof backdata.survey_key=="undefined")
		backdata.survey_key="";
	//console.log({body:backdata});
	
	/*if (backdata.nq)
		callSDK(JSON.stringify(onFailWhenUnqualified ? {"surveyMaster":{"event":"onSuccess","data":callbackData}} : {"surveyMaster":{"event":"onSuccess","data":{body:backdata}}}));
	else*/
		callSDK(JSON.stringify({"surveyMaster":{"event":"onSuccess","data":{body:backdata}}}));
}

function populateQuiz(questionObj)
{
	if (typeof questionObj=="undefined")
		questionObj=quizData.questions[quizIndex];
	deleteInterval("skipTime");
	shrt.id("surveyClose").style.display=hideCrossByDefault ? "none" : "block";
  switch (questionObj.category)
  {
	case 1: questionObj.type=0; break; //single
	case 2: questionObj.type=4; break; //multiple
	case 3: questionObj.type=4; break; //screening
	case 4: questionObj.type=0; break; //redirecting
	case 5: questionObj.type=5; break; //open text
	case 6: questionObj.type=6; break; //open numeric
	case 8: questionObj.type=6; break; //open numeric
	default: questionObj.type=questionObj.category; break;
  }
  if (questionObj.hasOwnProperty("customParams") && typeof questionObj.customParams=="object")
  {
	if (questionObj.category==8)
	{
		questionObj.minIntValue=0;
		questionObj.maxIntValue=2147483646;
		questionObj.text=(questionObj.customParams.cityQuestion && !(questionObj.customParams.overrideDefaultText)) ? texts[lang].cityQuestion : questionObj.text;
	}
	if (questionObj.customParams.hasOwnProperty("text"))
		questionObj.text=questionObj.customParams.text;
	if (questionObj.customParams.parentTextField==true)
	{
		questionObj.type=5;
		questionObj.mayBeSkipped=true;
		questionObj.minLength=0;
		questionObj.placeholderText="Введите Ф.И.О";
	}
  }
  try {shrt.id("otherInput").value="";}catch(e){}
  var nextQ=questionObj;
  multiSelectAnswer=[[]];
  recalledMatrix=[];
  otherString="";
  otherIndex=-1;
  progressBar((quizIndex+1)/(quizData.questions.length+1)*100);
  var _textAlign="center";
  if (nextQ.hasOwnProperty("align"))
	_textAlign=nextQ.align;
  var qd=shrt.id("questionContent");
  qd.innerHTML='';
  nextQ.type=nextQ.type || 0;
  if (nextQ.hasOwnProperty("customParams") && nextQ.customParams.hasOwnProperty("privacy") && (nextQ.customParams.privacy.hasOwnProperty("checks")==false || nextQ.customParams.privacy.checks.length==0))
	  showBackBut(false);
  if (nextQ.type==0 && !(nextQ.hasOwnProperty("customParams") && typeof nextQ.customParams=="object" && nextQ.customParams.oldSingleSelect==true))
  {
	nextQ.type=4;
	nextQ.minAnswersNumber=1;
	nextQ.maxAnswersNumber=1;
  }
  if (nextQ.hasOwnProperty("customParams") && typeof nextQ.customParams=="object" && nextQ.customParams.hasOwnProperty("answerGroups"))
  {
	  if (nextQ.customParams.hasOwnProperty("noneOfTheAbove") && nextQ.customParams.noneOfTheAbove==true)
		  nextQ.customParams.answerGroups["ans"+(nextQ.answers.length-1).toString()]=-10;
	  if (nextQ.hasOwnProperty("answers"))
		  for (var i=0; i<nextQ.answers.length; i++)
		  {
			  if (nextQ.customParams.answerGroups.hasOwnProperty("ans"+i.toString()))
				  nextQ.answers[i].answerGroup=nextQ.customParams.answerGroups["ans"+i.toString()];
		  }
  }
  if (nextQ.hasOwnProperty("customParams") && typeof nextQ.customParams=="object" && nextQ.customParams.hasOwnProperty("shuffle"))
  {
	  nextQ.shuffle=nextQ.customParams.shuffle;
  }
  if (nextQ.type==6)
  {
	if (typeof nextQ.answers[0]=="object")
	{
		nextQ.minIntValue=parseInt(nextQ.answers[0].text) || 0;
		quizData.questions[quizIndex].minIntValue=nextQ.minIntValue;
		
	}
	if (typeof nextQ.answers[1]=="object")
	{
		nextQ.maxIntValue=parseInt(nextQ.answers[1].text) || 100;
		quizData.questions[quizIndex].maxIntValue=nextQ.maxIntValue;
	}
  }
  if (typeof nextQ.customParams.customRecallAnswers=="object")
	  nextQ.customParams.recallAnswers=nextQ.customParams.customRecallAnswers;
  if (nextQ.type==6 && nextQ.hasOwnProperty("customParams") && typeof nextQ.customParams=="object")
  {
	  if (typeof nextQ.customParams.customSlider=="object")
		  nextQ.customParams.slider=nextQ.customParams.customSlider;
	  if (typeof nextQ.customParams.customNpsScale=="object")
	      nextQ.customParams.npsScale=nextQ.customParams.customNpsScale;
	  if (typeof nextQ.customParams.customStarsRating=="object")
	      nextQ.customParams.starsRating=nextQ.customParams.customStarsRating;
	  if (typeof nextQ.customParams.numericDropdown=="object" && nextQ.customParams.numericDropdown.enabled==true)
	  {
		nextQ.type=10;
		nextQ.min=nextQ.minIntValue;
		nextQ.max=nextQ.maxIntValue;
		nextQ.reverse=nextQ.customParams.numericDropdown.reverse || false;
	  }
	  else
	  if (typeof nextQ.customParams.slider=="object" && nextQ.customParams.slider.enabled==true)
	  {
		nextQ.type=1;
		nextQ.min=nextQ.minIntValue || 1;
		nextQ.max=nextQ.maxIntValue || 100;
		nextQ.sliderPos=nextQ.customParams.slider.position || nextQ.max/2;
		nextQ.answers=Object.prototype.toString.call(nextQ.customParams.slider.divisions) === '[object Array]' ? nextQ.customParams.slider.divisions : nextQ.answers;
	  }
	  else
	  if (typeof nextQ.customParams.starsRating=="object" && nextQ.customParams.starsRating.enabled==true)
	  {
		nextQ.type=8;
	  }
	  else
	  if (typeof nextQ.customParams.npsScale=="object" && nextQ.customParams.npsScale.enabled==true)
	  {
		nextQ.type=2;
	  }
  }
  if (nextQ.customParams.hasOwnProperty("quizResults"))
  {
	  var i=0;
	  var _resObj={};
	  while(i<nextQ.customParams.quizResults.length)
	  {
		  if (quizScore>=nextQ.customParams.quizResults[i].min && quizScore<=nextQ.customParams.quizResults[i].max)
		  {
			  _resObj=nextQ.customParams.quizResults[i];
			  break;
		  }
		  i++;
	  }
	  if (_resObj.hasOwnProperty("picture"))
	  {
		var _newPic=new Image();
		_newPic.src=_resObj.picture;
		_newPic.className="questionPic";
		images[quizIndex.toString()]=_newPic;
		nextQ.picture=_resObj.picture;
	  }
  }
  var _promoText="";
  if (nextQ.customParams.hasOwnProperty("promoScratch") && nextQ.customParams.promoScratch.enabled)
  {
	if (typeof nextQ.customParams.promoScratch.code=="string")
		_promoText=nextQ.customParams.promoScratch.code;
	var _num=-1;
	if (typeof nextQ.customParams.promoScratch.code=="object")
	{
		_num=Math.floor(Math.random()*nextQ.customParams.promoScratch.code.length);
		_promoText=nextQ.customParams.promoScratch.code[_num];
	}
  }
  if (nextQ.customParams.hasOwnProperty("promoScratch") && nextQ.customParams.promoScratch.enabled && nextQ.hasOwnProperty("picture") && nextQ.picture=="")
  {
	var _cnv=document.createElement("canvas");
	_cnv.width=850;
	_cnv.height=580;
	var _ctx=_cnv.getContext("2d");
	var _r=document.querySelector(":root");
	var _rs=getComputedStyle(_r);
	_ctx.beginPath();
	_ctx.fillStyle=_rs.getPropertyValue("--col-text1") || "#FFFFFF";
	_ctx.rect(0,0,_cnv.width,_cnv.height);	
	_ctx.fill();
	var _text=_promoText;
	if (_num>-1 && quizData.questions[quizIndex].customParams.additionalData.length>0)
		quizData.questions[quizIndex].customParams.additionalData=[quizData.questions[quizIndex].customParams.additionalData[_num]];
	if (!(quizData.questions[quizIndex].customParams.additionalData) || quizData.questions[quizIndex].customParams.additionalData.length==0)
		quizData.questions[quizIndex].customParams.additionalData=[_text];
	_ctx.fillStyle=_rs.getPropertyValue("--col-but1") || "#2e2d66";
	_ctx.font="1px "+"sans-serif";//_rs.getPropertyValue("font-family");
	var _sz=_cnv.width*0.95/_ctx.measureText(_text).width;
	_ctx.font=_sz+"px "+"sans-serif";//_rs.getPropertyValue("font-family");
	_ctx.textAlign="center";
	_ctx.textBaseline="middle";
	_ctx.fillText(_text,_cnv.width/2,_cnv.height/2);
	images[quizIndex.toString()]=new Image();
	images[quizIndex.toString()].src=_cnv.toDataURL();
	images[quizIndex.toString()].className="questionPic";
	nextQ.picture="promo";
  }
  if (_promoText!="")
  {
	images[quizIndex.toString()].dataset.clipboardText=_text;
	if (nextQ.customParams.promoScratch.copyOnClick)
	{
		var _copyObj=new ClipboardJS('.questionPic');
		images[quizIndex.toString()].style.cursor="pointer";
		images[quizIndex.toString()].addEventListener("click",function(){
			try{shrt.id("tapToCopy").innerHTML=texts[lang].copied;}catch(e){}
		});
	}
  }
  if ((nextQ.hasOwnProperty("picture") && nextQ.picture!="") || (nextQ.hasOwnProperty("video") && nextQ.video!=""))
  {
    qd.innerHTML+='<div id="questionPicDiv" class="questionPicDiv scale-up-center"></div>';
    shrt.id("questionPicDiv").appendChild(images[quizIndex.toString()]);
	imageResize();
	if (nextQ.customParams.hasOwnProperty("promoScratch") && nextQ.customParams.promoScratch.enabled)
	{
		shrt.q(".questionPic").style.opacity=0;
		var _thr=Math.max(Math.min(nextQ.customParams.promoScratch.threshold || 60,100),0);
		shrt.q(".questionPic").dataset.threshold=_thr;
		setTimeout(function(){
			try{
			if (shrt.q(".questionPic").dataset.hasOwnProperty("threshold"))
			{
				shrt.id("questionPicDiv").appendChild(scratchCard_init());
				var _pntr=document.createElement("img");
				_pntr.src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='127.929' height='99.791' viewBox='0 0 33.848 26.403' xmlns:v='https://vecta.io/nano'%3e%3cpath d='M20.796 26.367c-4.893-1.573-9.938-2.667-14.809-4.293-1.96-1.176-.872-4.892 1.468-4.64.624-.082 3.014.984 1.804-.368C6.276 12.77 3.068 8.631.162 4.279-.779 2.044 2.611-.154 4.309 1.531c1.996 2.564 3.828 5.251 5.802 7.832-.623-2.103 2.186-4.327 3.993-2.936.764.205-.323-1.693.59-2.157.806-1.182 2.638-1.729 3.796-.743-.199-1.299.168-2.731 1.601-3.24 1.821-1.019 3.141.893 4.058 2.182 2.465 3.519 5.248 6.811 7.547 10.445.919 1.565 1.828 3.218 2.152 5.017-.086 1.955-2.062 2.956-3.304 4.178-2.411 1.937-5.132 3.814-8.261 4.244-.493.051-.993.071-1.486.012z' fill='%232e2d66'/%3e%3c/svg%3e";
				_pntr.className="scratchPointer";
				_pntr.style.filter=filterColor;
				shrt.id("questionPicDiv").appendChild(_pntr);
				scratchCard_resize();
				shrt.q(".questionPic").style.opacity=1;
			}}catch(e){}
		},50);
		setTimeout(function(){try{scratchCard_resize();shrt.q(".scratchPointer").style.opacity=1;}catch(e){}},450);
	}
	images[quizIndex.toString()].removeAttribute("autoplay");
  }
  var questionType=nextQ.type;
  var _noteSelectTxt=nextQ.note || "";
  var _matrixSt=HtmlSanitizer.SanitizeHtml(nextQ.matrix.matrixStatement || "");
  if (nextQ.hasOwnProperty("customParams"))
  {
	  if (nextQ.customParams.hasOwnProperty("note"))
		  _noteSelectTxt=nextQ.customParams.note;
  }
  if (questionType==4)
  {
	if (nextQ.minAnswersNumber==0 && nextQ.maxAnswersNumber==0)
	{
		if (nextQ.category==3)
		{
			nextQ.minAnswersNumber=1;
			nextQ.maxAnswersNumber=1;
		}
		else
		{
			nextQ.minAnswersNumber=0;
			nextQ.maxAnswersNumber=nextQ.answers.length;
		}
	}
	if (nextQ.hasOwnProperty("minAnswersNumber")==false)
		nextQ.minAnswersNumber=1;
	nextQ.maxAnswersNumber=nextQ.maxAnswersNumber || nextQ.answers.length;
  if (_noteSelectTxt=="")
  {
	if (nextQ.minAnswersNumber==0)
	_noteSelectTxt=(nextQ.maxAnswersNumber<nextQ.answers.length) ? texts[lang].noteSelectMax.replaceAll("*",texts[lang].answers.hasOwnProperty("plural") ? texts[lang].answers.plural[nextQ.maxAnswersNumber==1 ? 0 : 1] : declOfNum(nextQ.maxAnswersNumber,texts[lang].answers.genitive)) : texts[lang].noteSelectMulti;
	else
	_noteSelectTxt=(nextQ.minAnswersNumber<=1 && nextQ.maxAnswersNumber>=nextQ.answers.length) ? texts[lang].noteSelectAll : ((nextQ.maxAnswersNumber<nextQ.answers.length) ? texts[lang].noteSelect.replaceAll("*",texts[lang].answers.hasOwnProperty("plural") ? texts[lang].answers.plural[nextQ.maxAnswersNumber==1 ? 0 : 1] : declOfNum(nextQ.maxAnswersNumber,texts[lang].answers.genitive)) : texts[lang].noteSelectMin.replaceAll("*",texts[lang].answers.hasOwnProperty("plural") ? texts[lang].answers.plural[nextQ.minAnswersNumber==1 ? 0 : 1] : declOfNum(nextQ.minAnswersNumber,texts[lang].answers.genitive)));
	if (nextQ.minAnswersNumber==nextQ.maxAnswersNumber)
		_noteSelectTxt=texts[lang].noteSelectEqual.replaceAll("*",texts[lang].answers.hasOwnProperty("plural") ? texts[lang].answers.plural[nextQ.maxAnswersNumber==1 ? 0 : 1] : declOfNum(nextQ.maxAnswersNumber,texts[lang].answers.nominative));
  }
	console.log(_matrixSt);
	_noteSelectTxt=_noteSelectTxt.replace('%x%',nextQ.minAnswersNumber).replace('%y%',nextQ.maxAnswersNumber)+(_matrixSt!="" ? " "+texts[lang].matrix : "");
	setAnswer([]);
  }
  if (questionType==1)
  {
	nextQ.minAnswersNumber=1;
	nextQ.maxAnswersNumber=1;
	_noteSelectTxt="";
  }
  if (questionType==6 && typeof nextQ.customParams=="object" && typeof nextQ.customParams.constantSum=="object" && nextQ.customParams.constantSum.enabled)
	  _noteSelectTxt=texts[lang].constantSum+" "+nextQ.customParams.constantSum.sum;
  if (typeof nextQ.customParams=="object" && typeof nextQ.customParams.wheelOfFortune=="object" && nextQ.customParams.wheelOfFortune.enabled)
	  _noteSelectTxt="";
  if (nextQ.customParams.hasOwnProperty("quizResults"))
  {
	  var i=0;
	  var _resObj={};
	  while(i<nextQ.customParams.quizResults.length)
	  {
		  if (quizScore>=nextQ.customParams.quizResults[i].min && quizScore<=nextQ.customParams.quizResults[i].max)
		  {
			  _resObj=nextQ.customParams.quizResults[i];
			  break;
		  }
		  i++;
	  }
	  if (_resObj.hasOwnProperty("text"))
		  nextQ.text=HtmlSanitizer.SanitizeHtml(_resObj.text.replaceAll("$result",quizScore)).replaceAll("[br]","<br>");
  }
	var _nextQText=nextQ.text;
  if (nextQ.customParams.hasOwnProperty("recallInformation") || nextQ.customParams.hasOwnProperty("recallCustomVars"))
  {
	  var j;
	  var _insArr=[];
	  if (nextQ.customParams.hasOwnProperty("recallInformation"))
	  {
		  for (j=0; j<nextQ.customParams.recallInformation.array.length; j++)
		  {
			  _insArr.push([nextQ.customParams.recallInformation.array[j].position,getUserAnswer(nextQ.customParams.recallInformation.array[j].from)]);
		  }
	  }
	  if (nextQ.customParams.hasOwnProperty("recallCustomVars"))
	  {
		  for (j=0; j<nextQ.customParams.recallCustomVars.array.length; j++)
		  {
			  _insArr.push([nextQ.customParams.recallCustomVars.array[j].position,customVars.hasOwnProperty(nextQ.customParams.recallCustomVars.array[j].name) ? customVars[nextQ.customParams.recallCustomVars.array[j].name][customVars[nextQ.customParams.recallCustomVars.array[j].name].length-1] : ""]);
		  }
	  }
	  _nextQText="";
	  for (j=0; j<nextQ.text.length; j++) {
		_nextQText += _insArr.filter(x => x.includes(j))
		.reduce(( total, current) => total + current[1],'') + nextQ.text[j];
		}
  }
  if (nextQ.customParams.hideQuestionText)
	  _nextQText="";
  _matrixSt="";
  var _qTxt=shrt.cr("div");
  _qTxt.innerHTML='<div id="questionText" class="questionText scale-up-center" style="text-align: '+_textAlign+';"><span id="qText">'+_nextQText.replaceAll("${quizTimer}",shrt.id("quizTimer").innerHTML)+"</span>"+((_noteSelectTxt!="") ? '<br><br><span class="questionNote">'+_noteSelectTxt+'</span>' : '')+'</div>';
  qd.appendChild(_qTxt.firstChild);
  qd=shrt.id("answersDiv");
  qd.innerHTML="";
  shrt.id("questionDiv").style.height="50%";
  shrt.id("answersDiv").style.height="50%";
  var _anslgt=0, _ansarr=[];
  if (typeof nextQ.answers=="object")
  {
	if (nextQ.hasOwnProperty("customParams"))
	{
		try {
			if (typeof nextQ.customParams=="object")
				Object.assign(nextQ.settings,nextQ.customParams);
		}catch(e){console.log("custom_params unparseable");}
	}
	var i;
	for (i=0; i<nextQ.answers.length; i++)
		_ansarr[i]=i;
	if (nextQ.hasOwnProperty("customParams") && typeof nextQ.customParams=="object" && nextQ.customParams.hasOwnProperty("shuffleFirst") && typeof nextQ.customParams.shuffleFirst=="number")
	{
		_ansarr=shuffleArray(_ansarr,{to:nextQ.customParams.shuffleFirst});
	}
	else
	{
		if (nextQ.hasOwnProperty("shuffle"))
		{
			_ansarr=handleShuffleOption(_ansarr,nextQ.shuffle);
		}
	}
	if (nextQ.hasOwnProperty("customParams") && typeof nextQ.customParams.otherPos=="number")
	{
		var k, _otherPos=-1;
		for (k=0; k<_ansarr.length; k++)
			if (quizData.questions[quizIndex].answers[_ansarr[k]].customAnswer)
				_otherPos=k;
		if (k>=0)
			_ansarr=array_move(_ansarr,_otherPos,nextQ.customParams.otherPos);
	}
  }
  
	if (typeof nextQ.settings=="undefined")
		nextQ.settings={};
	
	if (quizData.settings.hasOwnProperty("isPrivacy"))
	{
		if (quizData.settings.isPrivacy==true)
			callbackData.isPrivacy=true;
	}
	
  switch (questionType)
  {
	  case 1:
		  var _slideVars='';
		  if (nextQ.customParams.slider.isTime)
		  {
			  nextQ.min=0;
			  nextQ.max=95;
		  }
		  var _slMin=nextQ.min || 1;
		  var _slMax=nextQ.max || 100;
		  var _slCur=nextQ.sliderPos || 50;
		  var _slStep=nextQ.step || 1;
		  _slCur=(nextQ.customParams.slider.isTime ? minsToTime(_slCur,_slMax) : _slCur);
		  for (var i=0; i<nextQ.answers.length; i++)
			_slideVars+='<span>'+nextQ.answers[i]+'</span>';
		  qd.innerHTML='<div id="multiSelectArea" class="answersDiv multiSelectArea" ><div class="sliderCont"><p>'+_slCur+'</p><input type="range" min="'+_slMin+'" max="'+_slMax+'" value="'+_slCur+'" step="'+_slStep+'" class="slider" id="slider" style="background-size: '+((_slCur-_slMin)*100/(_slMax-_slMin)).toString()+'% 100%;"><div class="break"></div><div id="sliderVars" class="sliderCont">'+_slideVars+'</div></div></div><div id="cont"><div id="contBut" class="answersBut scale-up-center" style="'+(nextQ.settings.hasOwnProperty("butBg") ? 'background: '+nextQ.settings.butBg+';' : (quizData.settings.hasOwnProperty("butCol") ? 'background: '+quizData.settings.butCol+';' : ''))+(quizData.settings.hasOwnProperty("butText") ? 'color: '+quizData.settings.butText+';' : '')+(nextQ.settings.hasOwnProperty("butTextSize") ? 'font-size: '+nextQ.settings.butTextSize+'px;' : '')+'" data-number="0">'+texts[lang].next+'</div></div>';
		  if (nextQ.customParams.slider.showValue!=true)
			  shrt.q(".sliderCont > p").style.display="none";
		  shrt.id("contBut").style.filter="grayscale(1)";
		  shrt.id("contBut").dataset.clickable=false;
		  shrt.id("contBut").addEventListener('click', clickCallback, false);
		  if (nextQ.customParams.slider.isTime)
			shrt.id("slider").dataset.isTime="true";
		  shrt.id("slider").addEventListener('change', function(){shrt.id("contBut").style.filter="none";shrt.id("contBut").dataset.clickable=true;}, false);
		  shrt.id("slider").addEventListener("input",function() {
			var _val;
			if (this.dataset.isTime!="true")
				_val=this.value;
			else
				_val=minsToTime(this.value,this.max);
		  shrt.q(".sliderCont > p").innerHTML = _val;
		  this.style.backgroundSize = ((this.value - this.min) * 100 / (this.max - this.min)).toString() + "% 100%";
		});
	  break;
	  case 8:
		  var _stars=nextQ.maxIntValue || 5;
		  var _starsStr='';
		  for (var i=0; i<nextQ.maxIntValue; i++)
			_starsStr+='<input type="radio" name="rating" id="rating-'+(nextQ.maxIntValue-i)+'" data-rating='+(nextQ.maxIntValue-i)+' onclick="handleStarsRating(this)"><label for="rating-'+(nextQ.maxIntValue-i)+'"></label>'
		  qd.innerHTML='<div id="multiSelectArea" class="answersDiv multiSelectArea"><div class="rating"><input type="hidden" id="starsHidden">'+_starsStr+'</div></div><div id="cont"><div id="contBut" class="answersBut scale-up-center" style="'+(nextQ.settings.hasOwnProperty("butBg") ? 'background: '+nextQ.settings.butBg+';' : (quizData.settings.hasOwnProperty("butCol") ? 'background: '+quizData.settings.butCol+';' : ''))+(quizData.settings.hasOwnProperty("butText") ? 'color: '+quizData.settings.butText+';' : '')+(nextQ.settings.hasOwnProperty("butTextSize") ? 'font-size: '+nextQ.settings.butTextSize+'px;' : '')+'" data-number="0">'+texts[lang].next+'</div></div>';
		  shrt.id("contBut").style.filter="grayscale(1)";
		  shrt.id("contBut").dataset.clickable=false;
		  shrt.id("contBut").addEventListener('click', clickCallback, false);
	  break;
	  case 2:
		  qd.innerHTML+='<div id="npsCont"></div><div class="break"></div><div id="answer0"><div id="answersBut0" class="answersBut scale-up-center" style="filter: grayscale(1);" data-number="0">'+texts[lang].next+'</div></div>';
		  var _npsLgt=11;
		  var _npsStart=0;
		  if (nextQ.customParams.npsScale.hasOwnProperty("npsLength"))
			  _npsLgt=nextQ.customParams.npsScale.npsLength;
		  if (nextQ.customParams.npsScale.hasOwnProperty("npsStart"))
			  _npsStart=nextQ.customParams.npsScale.npsStart;
		  _npsStart=Math.max(_npsStart,0);
		  _npsLgt=Math.min(Math.max(_npsLgt,1),13);
		  for (var i=Math.max(_npsStart,0); i<_npsStart+_npsLgt; i++)
		  {
			var _t=shrt.cr("button");
			_t.id="npsBut"+i;
			_t.value=i;
			_t.innerHTML=i;
			_t.classList.add("npsBut");
			_t.style.width=(100/(_npsLgt-1))+"%";
			_t.onclick=npsFunc;
			if (is_iOS())
				_t.style.margin=0;
			shrt.id("npsCont").appendChild(_t);
		  }
		  setAnswer([]);
		  var buts = document.getElementsByClassName("answersBut");

		  for (var i = 0; i < buts.length; i++)
			buts[i].addEventListener('click', clickCallback, false);
	  break;
	  case 10:
		  var _min='';
		  var _max='';
		  if (nextQ.hasOwnProperty("min"))
			_min='min="'+handleNumber(nextQ.minIntValue)+'"';
		  if (nextQ.hasOwnProperty("max"))
			_max='max="'+handleNumber(nextQ.maxIntValue)+'"';
		  var _rev=nextQ.hasOwnProperty('reverse') ? nextQ.reverse : false;
		  _min=nextQ.hasOwnProperty("minIntValue") ? handleNumber(nextQ.minIntValue) : 1900;
		  _max=nextQ.hasOwnProperty("maxIntValue") ? handleNumber(nextQ.maxIntValue) : new Date().getFullYear();
		  qd.innerHTML+='<select id="ageSelect" style="font-size:32px;width:100%;max-width:280px;text-align:center;"></select><div class="break"></div><div id="answer0"><div id="answersBut0" class="answersBut scale-up-center" style="filter: grayscale(1);" data-number="0">'+texts[lang].next+'</div></div>'; 
		  var _dd=shrt.id("ageSelect");
		  _dd.innerHTML+='<option value="">----</option>';
		  for (var i=0; i<=_max-_min; i++)
			_dd.innerHTML+='<option value="'+(_rev ? _min+i : _max-i)+'">'+(_rev ? _min+i : _max-i)+'</option>';
		  shrt.id("ageSelect").onchange=function(){shrt.id("answersBut0").style.filter=(isNaN(parseInt(this.value)) ? "grayscale(1)" : "none");}
		  var buts = document.getElementsByClassName("answersBut");

		  for (var i = 0; i < buts.length; i++)
			buts[i].addEventListener('click', clickCallback, false);
	  break;
	  default:
		  var i;
		  var _ansbreak='';
			if (typeof nextQ.settings=="undefined")
				nextQ.settings={};
			if (nextQ.hasOwnProperty("customParams"))
			{
				try {
					nextQ.customParams=JSON.parse(HtmlSanitizer.SanitizeHtml(nextQ.customParams).replaceAll("[br]","<br>"));
					Object.assign(nextQ.settings,nextQ.customParams);
				}catch(e){}
			}
		  if (questionType==1 || questionType==4 || questionType==5  || questionType==6)
		  {
			nextQ.breakline=true;
			var _textarea='';
			if (questionType==5)
			{
				if (nextQ.hasOwnProperty("minLength")==false)
					nextQ.minLength=0;
				if (nextQ.hasOwnProperty("maxLength")==false)
					nextQ.maxLength=100;
				if (nextQ.customParams.hasOwnProperty("minLength"))
					nextQ.minLength=nextQ.customParams.minLength;
				if (nextQ.customParams.hasOwnProperty("maxLength"))
					nextQ.maxLength=nextQ.customParams.maxLength;
				nextQ.minLength=nextQ.mayBeSkipped ? 0 : nextQ.minLength;
				_textarea='<'+(quizData.questions[quizIndex].customParams.phoneField ? 'input type="tel"' : (quizData.questions[quizIndex].customParams.cityQuestion ? 'input type="text"' : 'textarea'))+' id="textArea" autocomplete="off" minlength='+nextQ.minLength+' maxlength='+nextQ.maxLength+' placeholder="'+(nextQ.hasOwnProperty("placeholderText") ? nextQ.placeholderText : texts[lang].placeholderText)+'"></textarea>';
				nextQ.answers=[];
				if (nextQ.hasOwnProperty("customParams") && typeof nextQ.customParams=="object" && nextQ.customParams.parentTextField==true)
					setAnswer([]);
				else
					setAnswer([_textarea.value],true);
			}
			if (questionType==6)
			{
				if (nextQ.hasOwnProperty("matrix") && nextQ.matrix.isMatrix && nextQ.matrix.matrixId!="")
				{
					  var statArray=[];
					  if (typeof nextQ.customParams=="object" && nextQ.customParams.hasOwnProperty("matrix"))
						  if (typeof nextQ.customParams.matrix=="object")
							  nextQ.matrix=nextQ.customParams.matrix;
					  multiSelectAnswer=[];
					  var i;
					  for (i=quizIndex; i<quizData.questions.length; i++)
					  {  
						  if (quizData.questions[i].hasOwnProperty("matrix"))
						  {
							  if (quizData.questions[i].matrix.isMatrix && quizData.questions[i].matrix.matrixId==nextQ.matrix.matrixId)
							  {
								  multiSelectAnswer.push([]);
								  statArray.push({num:i,stat:typeof quizData.questions[i].matrix=="object" ? (quizData.questions[i].matrix.matrixStatement || "") : ""})
							  }
						  }
					  }
					  var _isMtr=true;
					  if (statArray.length==0)
					  {
						  statArray.push({num:-1,stat:""});
						  _isMtr=false;
					  }
					  else
					  {
						quizData.questions[quizIndex].next=quizIndex+statArray.length;
						for (i=0; i<statArray.length; i++) setAnswer([],false,quizIndex+i);
					  }
					  var j,jj;
					  _textarea='';
					  var _mtrArr=[];
					  for (j=0; j<statArray.length; j++)
						  _mtrArr.push(j);
					  _mtrArr=handleShuffleOption(_mtrArr,quizData.questions[quizIndex].customParams.matrixShuffle || 0);
					  for (jj=0; jj<statArray.length; jj++)
					  {
						j=_mtrArr[jj];
						_textarea+='<p class="matrixHead" id="matrixHead'+j+'" style="cursor: auto;" data-hidden=false data-matrixgroup='+j+' data-matrixpart='+j+'><span>'+statArray[j].stat+'</span><span></span><br><span></span></p><div class="answersDiv multiSelectArea matrixCont" id="matrixCont'+j+'" style="width: 80%;margin: auto;" data-matrixid='+j+' data-matrixpart='+j+'><input id="textArea'+j+'" type="number" autocomplete="off" style="height: auto;" min='+nextQ.minIntValue+' max='+nextQ.maxIntValue+' placeholder="'+nextQ.minIntValue+'-'+nextQ.maxIntValue+'" value=0></input></div><div class="matrixDivider"'+' data-matrixpart='+j+'></div>'
					  }
					  setTimeout(function(){try{
						shrt.qAll("div[id^=matrixCont]").forEach((el)=>{el.style.maxHeight=el.clientHeight;el.dataset.maxheight=el.clientHeight;});
					  }catch(e){}},100);
					nextQ.answers=[];
					setAnswer([]);
				}
				else
				{
					if (nextQ.hasOwnProperty("minIntValue")==false)
						nextQ.minIntValue=0;
					if (nextQ.hasOwnProperty("maxIntValue")==false)
						nextQ.maxIntValue=100;
					_textarea='<input id="textArea" type="number" autocomplete="off" style="height: auto;" min='+nextQ.minIntValue+' max='+nextQ.maxIntValue+' placeholder="'+(nextQ.hasOwnProperty("placeholderText") ? nextQ.placeholderText : texts[lang].placeholderTextNumeric.replaceAll("%x%",nextQ.minIntValue).replaceAll("%y%",nextQ.maxIntValue))+'"></input>';
					nextQ.answers=[];
					setAnswer([]);
				}
			}
			qd.innerHTML='<div id="multiSelectArea" class="answersDiv multiSelectArea" >'+_textarea+'</div><div id="cont"><div id="contBut" class="answersBut scale-up-center" style="'+(nextQ.settings.hasOwnProperty("butBg") ? 'background: '+nextQ.settings.butBg+';' : (quizData.settings.hasOwnProperty("butCol") ? 'background: '+quizData.settings.butCol+';' : ''))+(quizData.settings.hasOwnProperty("butText") ? 'color: '+quizData.settings.butText+';' : '')+(nextQ.settings.hasOwnProperty("butTextSize") ? 'font-size: '+nextQ.settings.butTextSize+'px;' : '')+'" data-number="0">'+texts[lang].next+'</div></div>';
			qd=shrt.id("multiSelectArea");
			if (quizData.questions[quizIndex].customParams.cityQuestion)
			{
				shrt.id("textArea").type="text";
				shrt.id("textArea").placeholder="";
				shrt.id("textArea").style.height="auto";
				var _d=shrt.cr("div");
				_d.id="dropdown";
				shrt.id("multiSelectArea").appendChild(_d);
				_d=shrt.cr("div");
				_d.className="loaderSmall";
				shrt.id("multiSelectArea").appendChild(_d);
				_d.style.opacity=0;
				dropdownResize();
			}
			if (quizData.questions[quizIndex].customParams.textRegExp)
				shrt.id("textArea").pattern=quizData.questions[quizIndex].customParams.textRegExp;
			if (quizData.questions[quizIndex].customParams.phoneField || quizData.questions[quizIndex].customParams.oneLineText)
			{
				shrt.id("textArea").style.height="auto";
				if (quizData.questions[quizIndex].customParams.phoneField)
				{
					shrt.id("textArea").pattern="^[+7]?[0-9]{11}$";
					shrt.id("textArea").placeholder="+70123456789";
				}
			}
			if (questionType==6 && nextQ.hasOwnProperty("matrix") && nextQ.matrix.isMatrix && nextQ.matrix.matrixId!="")
				qd.style.display="block";
			if (nextQ.hasOwnProperty("customParams") && typeof nextQ.customParams=="object" && nextQ.customParams.parentTextField==true)
			{
				shrt.id("textArea").style.height="32px";
				shrt.id("answersDiv").prepend(shrt.id("cont"));
			}
			var _enableCond=(multiSelectAnswer[0].length<quizData.questions[quizIndex].minAnswersNumber);
			if (questionType==5)
			{
				var _textarea=shrt.id("textArea");
				_textarea.addEventListener("input",function(){
						if (quizData.questions[quizIndex].customParams.cityQuestion)
						{
							setAnswer([],true);
							shrt.id("contBut").style.filter="grayscale(1)";
							shrt.id("contBut").dataset.clickable=false;
							if (savedCities.hasOwnProperty(_textarea.value))
								fillDropdown(savedCities[_textarea.value])
							else
							{
								shrt.q(".loaderSmall").style.opacity=1;
								addInterval("city",function(){
									request(apiData.cityEndpoint+"?lang="+lang+"&q="+_textarea.value,"GET",{body:"lang="+lang+"&q="+_textarea.value}).then(res=>{
										shrt.q(".loaderSmall").style.opacity=0;
										if (!res)
											res[{name:texts[lang].nocities}]
										savedCities[_textarea.value]=res;
										fillDropdown(res);
									})
									.catch(e=>{
										console.log(e);
									});
									deleteInterval("city");
								},500);
							}
							if (_textarea.value=="")
							{
								shrt.id("dropdown").innerHTML="";
								deleteInterval("city");
								shrt.q(".loaderSmall").style.opacity=0;
							}
						}
					else
					{
						var _regPass=true;
						if (typeof _textarea.pattern=="string" && _textarea.pattern!="")
						{
							_regPass=false;
							var _regexp=new RegExp(_textarea.pattern);
							var _testStr=_textarea.value;
							if (nextQ.customParams.phoneField && _testStr.indexOf("8")==0) _testStr.replace("8","+7");
							_regPass=_regexp.test(_testStr);
						}
						var _pass=(this.value.length>=this.minLength && _regPass)
						shrt.id("contBut").style.filter=!_pass ? "grayscale(1)" : "none";
						shrt.id("contBut").dataset.clickable=_pass;
					}
				});
				_enableCond=(_textarea.value.length<nextQ.minLength);
			}
			if (questionType==6)
			{
				if (nextQ.hasOwnProperty("matrix") && nextQ.matrix.isMatrix)
				{
					quizData.questions[quizIndex]._sum=0;
					if (typeof nextQ.customParams=="object" && nextQ.customParams.constantSum && nextQ.customParams.constantSum.enabled)
						quizData.questions[quizIndex]._constantSum=nextQ.customParams.constantSum.sum || 0;
					var _textarea=shrt.qAll("input[id^='textArea']");
					var i;
					for (i=0; i<_textarea.length; i++)
					{
						_textarea[i].addEventListener("input",function(){
							this.value=Math.min(Math.max(parseInt(this.value) || 0, parseInt(this.min) || 0),parseInt(this.max) || 100)
							quizData.questions[quizIndex]._sum=0;
							var _textarea=shrt.qAll("input[id^='textArea']");
							var i;
							for (i=0; i<_textarea.length; i++)
								quizData.questions[quizIndex]._sum+=parseInt(_textarea[i].value) || 0;
							_enableCond=(quizData.questions[quizIndex]._sum!=quizData.questions[quizIndex]._constantSum)
							shrt.id("contBut").style.filter=_enableCond ? "grayscale(1)" : "none";
							shrt.id("contBut").dataset.clickable=!(_enableCond);
							shrt.id("contBut").innerHTML=!_enableCond ? texts[lang].next : quizData.questions[quizIndex]._sum+"/"+quizData.questions[quizIndex]._constantSum;
						});
					}
					_enableCond=(quizData.questions[quizIndex]._sum!=quizData.questions[quizIndex]._constantSum);
					shrt.id("contBut").innerHTML=!_enableCond ? texts[lang].next : quizData.questions[quizIndex]._sum+"/"+quizData.questions[quizIndex]._constantSum;
				}
				else
				{
					var _textarea=shrt.id("textArea");
					_textarea.addEventListener("input",function(){
						if (quizData.questions[quizIndex].customParams.cityQuestion)
						{
							setAnswer([]);
							shrt.id("contBut").style.filter="grayscale(1)";
							shrt.id("contBut").dataset.clickable=false;
							if (savedCities.hasOwnProperty(_textarea.value))
								fillDropdown(savedCities[_textarea.value])
							else
							{
								shrt.q(".loaderSmall").style.opacity=1;
								addInterval("city",function(){
									request(apiData.cityEndpoint+"?lang="+lang+"&q="+_textarea.value,"GET",{body:"lang="+lang+"&q="+_textarea.value}).then(res=>{
										shrt.q(".loaderSmall").style.opacity=0;
										if (!res)
											res[{name:texts[lang].nocities}]
										savedCities[_textarea.value]=res;
										fillDropdown(res);
									})
									.catch(e=>{
										console.log(e);
									});
									deleteInterval("city");
								},500);
							}
							if (_textarea.value=="")
							{
								shrt.id("dropdown").innerHTML="";
								deleteInterval("city");
								shrt.q(".loaderSmall").style.opacity=0;
							}
						}
						else
						{
							shrt.id("contBut").style.filter=(isNaN(parseInt(this.value)) || parseInt(this.value)<parseInt(this.min) || parseInt(this.value)>parseInt(this.max)) ? "grayscale(1)" : "none";
							shrt.id("contBut").dataset.clickable=!(isNaN(parseInt(this.value)) || parseInt(this.value)<parseInt(this.min) || parseInt(this.value)>parseInt(this.max));
						}
					});
					_enableCond=(isNaN(parseInt(_textarea.value)) || parseInt(_textarea.value)<nextQ.minIntValue || parseInt(_textarea.value)>nextQ.maxIntValue);
				}
			}
			shrt.id("contBut").style.filter=_enableCond ? "grayscale(1)" : "none";
			shrt.id("contBut").dataset.clickable=!(_enableCond);
		  }
		  if (typeof nextQ.customParams=="object" && nextQ.customParams.oldSingleSelect==true && typeof nextQ.customParams.breakline=="undefined")
			nextQ.breakline=true;
		  if (typeof nextQ.customParams=="object" && nextQ.customParams.hasOwnProperty("breakline"))
			nextQ.breakline=nextQ.customParams.breakline;
		  if (typeof nextQ.breakline!="undefined")
			if (nextQ.breakline==true && nextQ.type!=4 && !(nextQ.customParams.hasOwnProperty("binaryChoice") && nextQ.customParams.binaryChoice.enabled))
				_ansbreak='<div class="break'+(shrt.id("multiSelectArea") ? ' multi' : '')+'"></div>';
		  if (nextQ.customParams.oldSingleSelect && nextQ.customParams.newBreakline)
			  _ansbreak='';
		  var statArray=[];
		  if (typeof nextQ.customParams=="object" && nextQ.customParams.hasOwnProperty("matrix"))
			  if (typeof nextQ.customParams.matrix=="object")
				  nextQ.matrix=nextQ.customParams.matrix;
		  if (nextQ.hasOwnProperty("matrix"))
		  {
			  if (nextQ.matrix.isMatrix && nextQ.matrix.matrixId!="")
			  {
				  multiSelectAnswer=[];
				  var i;
				  for (i=quizIndex; i<quizData.questions.length; i++)
				  {   if (typeof quizData.questions[i].customParams=="object" && quizData.questions[i].customParams.hasOwnProperty("matrix"))
						if (typeof quizData.questions[i].customParams.matrix=="object")
							quizData.questions[i].matrix=quizData.questions[i].customParams.matrix;
					  if (quizData.questions[i].hasOwnProperty("matrix"))
					  {
						  if (quizData.questions[i].matrix.isMatrix && quizData.questions[i].matrix.matrixId==nextQ.matrix.matrixId)
						  {
							  multiSelectAnswer.push([]);
							  statArray.push({num:i,stat:typeof quizData.questions[i].matrix=="object" ? ((quizData.questions[i].matrix.matrixStatement || quizData.questions[i].customParams.matrixStatement) || "") : ""})
						  }
					  }
				  }
			  }
		  }
		  var _isMtr=true;
		  if (statArray.length==0)
		  {
			  statArray.push({num:-1,stat:""});
			  _isMtr=false;
		  }
		  else
		  {
			quizData.questions[quizIndex].next=quizIndex+statArray.length;
			for (i=0; i<statArray.length; i++) setAnswer([],false,quizIndex+i);
		  }
		  var j,jj;
		  var _mtrArr=[];
		  for (j=0; j<statArray.length; j++)
			  _mtrArr.push(j);
		  _mtrArr=handleShuffleOption(_mtrArr,quizData.questions[quizIndex].customParams.matrixShuffle || 0);
		  for (jj=0; jj<statArray.length; jj++)
		  {
			j=_mtrArr[jj];
		    if (!(nextQ.breakline))
			  qd=shrt.id("multiSelectArea");
			if (questionType==4 && !(statArray.length==1 && statArray[0].stat==""))
			{
				qd=shrt.id("multiSelectArea");
				qd.innerHTML+='<p class="matrixHead" id="matrixHead'+j+'" data-hidden=false data-matrixgroup='+j+' data-matrixpart='+j+'><span>'+statArray[j].stat+'</span><span class="matrixArrow">˄</span><br><span></span></p><div class="answersDiv multiSelectArea matrixCont" id="matrixCont'+j+'" data-matrixid='+j+' data-matrixpart='+j+'></div><div class="matrixDivider"'+' data-matrixpart='+j+'></div>';
				qd=shrt.id("matrixCont"+j);
			}
			  for (i=0; i<nextQ.answers.length; i++)
			  {
				var _anstxt="";
				var _ansimg="";
				var _ansind=_ansarr[i];
				var _ansgroup=1;
				if (typeof nextQ.answers[_ansind]=="object")
				{
					if (nextQ.answers[_ansind].hasOwnProperty("text"))
						_anstxt=nextQ.answers[_ansind].text.toString();
					var _datatxt='';
					if (quizData.questions[quizIndex].category==3)
						_datatxt+='data-nq='+(!(nextQ.answers[_ansind].screening))+' ';
					if (nextQ.answers[_ansind].hasOwnProperty("picture") && nextQ.answers[_ansind].picture!="")
						_ansimg=quizIndex.toString()+'_'+_ansind.toString();
					if (nextQ.answers[_ansind].hasOwnProperty("answerGroup"))
						_ansgroup=nextQ.answers[_ansind].answerGroup;
					if (nextQ.answers[_ansind].hasOwnProperty("customAnswer") && nextQ.answers[_ansind].customAnswer==true)
						otherIndex=_ansind;
					if (nextQ.answers[_ansind].hasOwnProperty("customAnswer") && nextQ.answers[_ansind].customAnswer==false)
					{
						if (typeof nextQ.customParams=="object" && nextQ.customParams.hasOwnProperty("recallAnswers") && nextQ.customParams.recallAnswers.enabled)
						{
							var _from=typeof nextQ.customParams.recallAnswers.from=="string" ? questionNumById(nextQ.customParams.recallAnswers.from) : nextQ.customParams.recallAnswers.from;
							if (answers[_from].hasOwnProperty("array_of_uints"))
								if (answers[_from].array_of_uints.array.includes(_ansind) && quizData.questions[_from].answers[_ansind].customAnswer)
									_anstxt=answers[_from].array_of_uints.own_answer || _anstxt;
						}
					}
							
				}
				else
					_anstxt=nextQ.answers[_ansind].toString();
				var _mtrNum=(_isMtr ? '_'+j : '');
				qd.innerHTML+='<div id="answer'+_ansind+_mtrNum+'"'+(((nextQ.shuffle==2 && i==nextQ.answers.length-1) || (nextQ.shuffle==3 && i>=nextQ.answers.length-2) || (typeof nextQ.customParams=="object" && typeof nextQ.customParams.searchBar=="object" && typeof nextQ.customParams.searchBar.nonsearchable=="object" && nextQ.customParams.searchBar.nonsearchable.includes(_ansind))) ? 'data-nonsearchable="true"' : '')+(shrt.id("multiSelectArea") ? 'class="multi"' : '')+' data-answergroup='+_ansgroup+'><div id="answersBut'+_ansind+_mtrNum+'" class="answersBut scale-up-center '+((_ansimg!="" && questionType==0) ? 'imgBut' : '')+'" style="'+(nextQ.settings.hasOwnProperty("butBg") ? 'background: '+nextQ.settings.butBg+';' : (quizData.settings.hasOwnProperty("butCol") ? 'background: '+quizData.settings.butCol+';' : ''))+(quizData.settings.hasOwnProperty("butText") ? 'color: '+quizData.settings.butText+';' : '')+(nextQ.settings.hasOwnProperty("butTextSize") ? 'font-size: '+nextQ.settings.butTextSize+'px;' : '')+'" data-number='+_ansind+' '+(_isMtr ? 'data-matrixnum="'+_mtrNum.replace("_","")+'" ' : ' ')+(nextQ.type==3 ? 'data-quiz="'+_ansind+'"' : '')+(nextQ.type==4 ? 'data-selected=false ' : '')+_datatxt+' data-answergroup='+_ansgroup+'>'+((_ansimg!="" && questionType==0) ? '<div class="answerButImgCont"></div>' : '')+(questionType==4 ? '<div class="multiSelectCheckbox"><div class="multiSelectCheckmark" id="checkbox'+_ansind+_mtrNum+'" style="opacity: 0;"></div></div>' : '')+(questionType==4 ? ('<div class="multiButCont">'+(_anstxt!="" ? '<span>'+_anstxt+'</span>' : '')+'<div class="quizBg"></div></div>') : (_anstxt!="" ? '<span>'+_anstxt+'</span>' : ''))+'</div></div>'+_ansbreak;
				if (_ansimg!="")
				{
					switch (questionType)
					{
						case 4:
							shrt.q("div[id=answersBut"+_ansind+"] > .multiButCont").prepend(images[_ansimg]); 
						break;
						default:
							shrt.id("answersBut"+_ansind).firstChild.appendChild(images[_ansimg]);
							if (typeof nextQ.customParams.answerImageSize=="number")
							{
								var _ais=Math.max(1,Math.min(100,parseInt(nextQ.customParams.answerImageSize)));
								var _imgtarget=shrt.q("div[id=answersBut"+_ansind+"] > .answerButImgCont > img");
								_imgtarget.style.maxWidth=_ais+"vw";
								_imgtarget.style.maxHeight=_ais+"vh";
								if (!nextQ.customParams.newBreakline)
									shrt.id("answersBut"+_ansind).style.maxWidth="100vmin";
							}
						break;
					}
				}
			  }
		  }
		  setTimeout(function(){try{
			shrt.qAll("div[id^=matrixCont]").forEach((el)=>{el.style.maxHeight=el.clientHeight;el.dataset.maxheight=el.clientHeight;});
		  }catch(e){}},100);
		  if (shrt.q(".matrixHead") && questionType!=6)
		  {
			  for (j=0; j<statArray.length; j++) shrt.id("matrixHead"+j).onclick=function(){var _new=this.dataset.hidden=="true" ? "false" : "true"; this.dataset.hidden=_new; var _gr=shrt.id("matrixCont"+this.dataset.matrixgroup); _new=_gr.dataset.hidden=="true" ? "false" : "true"; _gr.dataset.hidden=_new; _gr.style.maxHeight=_new=="true" ? 0 : _gr.dataset.maxheight+"px";}
		  }
		if (questionType==4) shrt.qAll(".answersDiv .multiSelectArea").forEach((el)=>{el.style.display="block";});
		  var buts = document.getElementsByClassName("answersBut");

		  for (var i = 0; i < buts.length; i++) {
			buts[i].addEventListener('click', clickCallback, false);
		  }
	  break;
  }
  if (nextQ.hasOwnProperty("fineprint"))
  {
	var _fineprint=shrt.cr("fineprint");
	_fineprint.id="fineprint";
	_fineprint.className="fineprint";
	_fineprint.innerHTML=nextQ.fineprint;
	shrt.id("answersDiv").appendChild(_fineprint);
  }
  if (nextQ.hasOwnProperty("customParams"))
  {
	if (typeof nextQ.customParams=="object")
	{
		var _cp=nextQ.customParams;
		if (_cp.hasOwnProperty("theme"))
			customColorsSetup(_cp.theme);
		if (_cp.hasOwnProperty("privacy"))
		{
			var _privacyCont=shrt.cr("div");
			_privacyCont.id="privacyCont";
			_privacyCont.className="fineprint";
			_privacyCont.innerHTML=_cp.privacy.text!="" ? "<p>"+_cp.privacy.text+"</p>" : "";
			shrt.id("answersDiv").appendChild(_privacyCont);
			var _privacyForm=shrt.cr("form");
			_privacyForm.id="privacyForm";
			_privacyCont.appendChild(_privacyForm);
			if (_cp.privacy.hasOwnProperty("checks"))
			{
				for (var i=0; i<_cp.privacy.checks.length; i++)
				{
					var _cb=shrt.cr("input");
					_cb.type="checkbox";
					_cb.id="privacyCb"+i.toString();
					_cb.checked=_cp.privacy.checks[i].hasOwnProperty("checked") ? _cp.privacy.checks[i].checked : false;
					_cb.dataset.required=_cp.privacy.checks[i].hasOwnProperty("required") ? _cp.privacy.checks[i].required : false;
					_cb.addEventListener("change",function(){checkPrivacyBoxes(privacyButHandle);});
					_privacyForm.appendChild(_cb);
					_cb=shrt.cr("label");
					_cb.htmlFor="privacyCb"+i.toString();
					_privacyForm.appendChild(_cb);
					_cb=shrt.cr("span");
					_cb.innerHTML=_cp.privacy.checks[i].text;
					if (_cp.privacy.checks[i].hasOwnProperty("link"))
					{
						_cb.style.textDecoration="underline";
						_cb.style.cursor="pointer";
						_cb.dataset.link=_cp.privacy.checks[i].link;
						_cb.addEventListener("click",function(e){openPopup(e.target.dataset.link);});
					}
					_privacyForm.appendChild(_cb);
					if (i!=_cp.privacy.checks.length-1)
					_privacyForm.appendChild(shrt.cr("br"));
				}
			}
		}
		if (_cp.hasOwnProperty("searchBar"))
		{
			if (_cp.searchBar.enabled==true)
			{
				var _asf=shrt.cr("input");
				_asf.id="answerSearchField";
				_asf.type="text";
				_asf.placeholder=_cp.searchBar.hasOwnProperty("placeholder") ? _cp.searchBar.placeholder : "Поиск по вариантам...";
				_asf.addEventListener("input",function(e){answerSearch(e.target.value);});
				shrt.id("questionContent").appendChild(_asf);
			}
		}
		if (_cp.hasOwnProperty("recallAnswers"))
		{
			if (typeof _cp.recallAnswers=="object")
			{
				if (_cp.recallAnswers.enabled==true)
				{
					  var _recFrom=-1;
					  if (typeof _cp.recallAnswers.from=="string")
					  {
						  _recFrom=questionNumById(_cp.recallAnswers.from)
					  }
					  else
					  if (typeof _cp.recallAnswers.from=="number")
						  _recFrom=Math.min(Math.max(_cp.recallAnswers.from,-1),quizData.questions.length-1);
					var _arr=answers[_recFrom].array_of_uints.array;
					if (quizData.questions[_recFrom].category==6 && answers[_recFrom].array_of_uints.array.length>0)
					{
						_arr=[];
						for (var i=0; i<Math.max(answers[_recFrom].array_of_uints.array[0],0); i++)
							_arr.push(i);
					}
					else
					if (quizData.questions[_recFrom].category==1 || quizData.questions[_recFrom].category==2)
					{
						for (var i=0; i<Math.max(answers[_recFrom].array_of_uints.array.length,0); i++)
							if (quizData.questions[_recFrom].answers[answers[_recFrom].array_of_uints.array[i]].customAnswer && answers[_recFrom].array_of_uints.array[i]<quizData.questions[quizIndex].answers.length)
								quizData.questions[quizIndex].answers[answers[_recFrom].array_of_uints.array[i]].text=answers[_recFrom].array_of_uints.own_answer;
					}
					answerHideByArray(_arr,typeof _cp.recallAnswers.invert=="boolean" ? _cp.recallAnswers.invert : false, _cp.recallAnswers.hasOwnProperty("first") ? _cp.recallAnswers.first : undefined, _cp.recallAnswers.hasOwnProperty("alwaysShow") ? _cp.recallAnswers.alwaysShow : []);
				}
			}
		}
		if (_cp.hasOwnProperty("recallMatrix"))
		{
			if (typeof _cp.recallMatrix=="object")
			{
				if (_cp.recallMatrix.enabled==true)
				{
					  var _recFrom=-1;
					  if (typeof _cp.recallMatrix.from=="string")
					  {
						  _recFrom=questionNumById(_cp.recallMatrix.from)
					  }
					  else
					  if (typeof _cp.recallMatrix.from=="number")
						  _recFrom=Math.min(Math.max(_cp.recallMatrix.from,-1),quizData.questions.length-1);
					var _arr=answers[_recFrom].array_of_uints.array;
					if (quizData.questions[_recFrom].category==6 && answers[_recFrom].array_of_uints.array.length>0)
					{
						_arr=[];
						for (var i=0; i<Math.max(answers[_recFrom].array_of_uints.array[0],0); i++)
							_arr.push(i);
					}
					else
					if (quizData.questions[_recFrom].category==1 || quizData.questions[_recFrom].category==2)
					{
						for (var i=0; i<Math.max(answers[_recFrom].array_of_uints.array.length,0); i++)
							if (quizData.questions[_recFrom].answers[answers[_recFrom].array_of_uints.array[i]].customAnswer && answers[_recFrom].array_of_uints.array[i]<quizData.questions.length)
								try{shrt.q("#matrixHead"+answers[_recFrom].array_of_uints.array[i]+" > span:first-of-type").innerHTML=answers[_recFrom].array_of_uints.own_answer; }catch(e){}
					}
					recalledMatrix=_arr;
					matrixHideByArray(_arr,typeof _cp.recallMatrix.invert=="boolean" ? _cp.recallMatrix.invert : false);
				}
			}
		}
		if (_cp.hasOwnProperty("clickMap"))
		{
			if (_cp.clickMap.enabled==true)
			{
				quizData.questions[quizIndex].pointsNeeded=_cp.clickMap.hasOwnProperty("number") ? Math.min(Math.max(_cp.clickMap.number,0),10) : 1;
				quizData.questions[quizIndex].pointsPlaced=0;
				quizData.questions[quizIndex].pointsArray=[];
				shrt.id("textArea").style.display="none";
				shrt.id("questionDiv").style.height="80%";
				shrt.id("answersDiv").style.height="20%";
				shrt.id("multiSelectArea").style.overflow="hidden";
				shrt.id("questionContent").prepend(shrt.id("questionText"));
				shrt.id("questionText").style.paddingBottom="32px";
				if (_cp.clickMap.number!=0)
				{
					shrt.id("textArea").minLength=1;
					shrt.id("contBut").style.filter="grayscale(1)";
					shrt.id("contBut").dataset.clickable=false;
				}
				shrt.q("#questionPicDiv > img").style.cursor="pointer";
				shrt.q("#questionPicDiv > img").onclick=(e)=>
				{
					if (quizData.questions[quizIndex].pointsPlaced<quizData.questions[quizIndex].pointsNeeded)
					{
						quizData.questions[quizIndex].pointsPlaced++;
						var coords=e.target.getBoundingClientRect();
						var coordArr=[];
						coordArr[0]= Math.round((e.pageX - coords.left)/coords.width*100);
						coordArr[1]= Math.round((e.pageY - coords.top)/coords.height*100);
						quizData.questions[quizIndex].pointsArray.push(coordArr.join(";"));
						var _notenoughPoints=(quizData.questions[quizIndex].pointsPlaced<quizData.questions[quizIndex].pointsNeeded);
						shrt.id("textArea").value=quizData.questions[quizIndex].pointsArray.join("_");
						shrt.id("textArea").dispatchEvent(new Event('input', {bubbles:true}));
						shrt.id("contBut").style.filter=(_notenoughPoints) ? "grayscale(1)" : "none";
						shrt.id("contBut").dataset.clickable=!(_notenoughPoints);
						if (_notenoughPoints==false)
							shrt.q("#questionPicDiv > img").style.cursor="not-allowed";
						var _pointer=shrt.cr("div");
						_pointer.className="clickMapPointer";
						_pointer.id="clickMapPointer"+quizData.questions[quizIndex].pointsPlaced;
						document.body.appendChild(_pointer);
						_pointer.dataset.x=coordArr[0];
						_pointer.dataset.y=coordArr[1];
						setPoint(_pointer,coordArr[0],coordArr[1]);
					}
				}
			}
		}
		if (_cp.hasOwnProperty("doubleSlider"))
		{
			if (_cp.doubleSlider.enabled==true)
			{
				if (typeof _cp.doubleSlider.min=="undefined") _cp.doubleSlider.min=0;
				if (typeof _cp.doubleSlider.max=="undefined") _cp.doubleSlider.max=100;
				if (typeof _cp.doubleSlider.minDef=="undefined") _cp.doubleSlider.minDef=_cp.doubleSlider.max*0.25;
				if (typeof _cp.doubleSlider.maxDef=="undefined") _cp.doubleSlider.maxDef=_cp.doubleSlider.max*0.75;
				if (typeof _cp.doubleSlider.step=="undefined") _cp.doubleSlider.step=1;
				console.log(_cp.doubleSlider);
				shrt.id("textArea").style.display="none";
				shrt.id("multiSelectArea").style.overflow="hidden";
				shrt.id("multiSelectArea").insertAdjacentHTML("beforeend",'</div><div class="sliderCont" id="sliderCont">  <div class="range"><div class="range-price" id="range-price">      <label for="min">'+texts[lang].from+' <span id="spanMin" style="display: none;"></span></label><input type="number" name="min" id="dblMin" value="'+_cp.doubleSlider.minDef+'" wfd-id="id2"><label for="max">'+texts[lang].to+' <span id="spanMax" style="display: none;"></span></label><input type="number" name="max" id="dblMax" value="'+_cp.doubleSlider.maxDef+'" wfd-id="id3"></div><div class="range-price" id="range-name" style="display: none;"><span></span></div><div class="range-slider"><span class="range-selected" style="left: '+_cp.doubleSlider.minDef/_cp.doubleSlider.max*100+'%; right: '+_cp.doubleSlider.maxDef/_cp.doubleSlider.max*100+'%;"></span></div><div class="range-input"><input type="range" class="min" min="'+_cp.doubleSlider.min+'" max="'+_cp.doubleSlider.max+'" value="'+_cp.doubleSlider.minDef+'" step="'+_cp.doubleSlider.step+'" wfd-id="id0"><input type="range" class="max" min="'+_cp.doubleSlider.min+'" max="'+_cp.doubleSlider.max+'" value="'+_cp.doubleSlider.maxDef+'" step="'+_cp.doubleSlider.step+'" wfd-id="id1"></div></div></div>');
				if (_cp.doubleSlider.hideInput)
				{
					shrt.id("dblMin").style.display="none";
					shrt.id("dblMax").style.display="none";
					shrt.id("spanMin").style.display="block";
					shrt.id("spanMax").style.display="block";
				}
				if (_cp.doubleSlider.isTime)
				{
					shrt.id("sliderCont").dataset.isTime="true";
					shrt.id("sliderCont").dataset.min=_cp.doubleSlider.min;
					shrt.id("sliderCont").dataset.max=_cp.doubleSlider.max;
				}
				shrt.id("spanMin").innerHTML=(_cp.doubleSlider.isTime ? minsToTime(shrt.id("dblMin").value,_cp.doubleSlider.max) : shrt.id("dblMin").value);
				shrt.id("spanMax").innerHTML=(_cp.doubleSlider.isTime ? minsToTime(shrt.id("dblMax").value,_cp.doubleSlider.max) : shrt.id("dblMax").value);
				if (_cp.doubleSlider.min>0)
					shrt.q(".range-selected").style.display="none";
				doubleSlider_init();
				if (_cp.doubleSlider.hasOwnProperty("name") && _cp.doubleSlider.name!="")
				{
					shrt.id("range-price").style.marginBottom="15px";
					shrt.id("range-name").style.marginBottom="15px";
					shrt.id("range-name").style.display="block";
					shrt.q("#range-name > span").innerHTML=HtmlSanitizer.SanitizeHtml(_cp.doubleSlider.name);
					
				}
			}
		}
		if (_cp.hasOwnProperty("sortable"))
		{
			if (_cp.sortable.enabled==true)
			{
				shrt.id("questionDiv").style.height="40%";
				shrt.id("answersDiv").style.height="60%";
				shrt.id("multiSelectArea").style.display="block";
				var _but,_cntr;
				var _svg='<svg class="svgIcon" focusable="false" aria-hidden="true" viewBox="0 0 24 24"><path d="M11 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm-2-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path></svg>';
				for (var i=0; i<shrt.id("multiSelectArea").childNodes.length; i++)
				{
					_but=shrt.id("answersBut"+i);
					_but.childNodes[0].innerHTML=_svg;
					_but.childNodes[0].style.background="#ffffff00";
					_but.childNodes[0].style.display="flex";
					_cntr=document.createElement("span");
					_cntr.classList.add("sortableNum");
					_cntr.innerHTML=i+1;
					shrt.q("#answersBut"+i+" > .multiButCont > span").prepend(_cntr);
					_but.addEventListener("animationend",function(e){this.style.animationDuration="0s";this.style.webkitAnimationDuration="0s";this.outerHTML=this.outerHTML;});
				}
				shrt.q(".questionNote").remove();
				shrt.id("contBut").style.filter="grayscale(1)";
				shrt.id("contBut").dataset.clickable=false;
				Sortable.create(shrt.id("multiSelectArea"),{direction:"vertical",animation:150,onEnd:function(){
					var i;
					multiSelectAnswer=[[]];
					for (i=0; i<shrt.id("multiSelectArea").childNodes.length; i++)
					{
						multiSelectAnswer[0].push(parseInt(shrt.id("multiSelectArea").childNodes[i].childNodes[0].dataset.number));
						shrt.id("multiSelectArea").childNodes[i].childNodes[0].childNodes[1].childNodes[0].childNodes[0].innerHTML=i+1;
					}
					setAnswer(multiSelectAnswer[0]);
					shrt.id("contBut").style.filter="none";
					shrt.id("contBut").dataset.clickable=true;
				}});
				var _imgs=shrt.qAll(".multiButCont > img");
				for (i=0; i<_imgs.length; i++)
				{
					_imgs[i].parentElement.appendChild(_imgs[i]);
					_imgs[i].classList.add("sortableImg");
				}
				for (i=0; i<shrt.id("multiSelectArea").childNodes.length; i++)
					shrt.id("multiSelectArea").childNodes[i].childNodes[0].childNodes[1].childNodes[0].childNodes[0].innerHTML=i+1;
			}
		}
		if (_cp.hasOwnProperty("video"))
		{
			if (_cp.video.src!="")
			{
				shrt.id("textArea").style.display="none";
				shrt.id("questionDiv").style.height="80%";
				shrt.id("answersDiv").style.height="20%";
				shrt.id("multiSelectArea").style.overflow="hidden";
				shrt.id("questionContent").prepend(shrt.id("questionText"));
				shrt.id("questionText").style.paddingBottom="32px";
				_cp.video.timer=_cp.video.hasOwnProperty("timer") ? _cp.video.timer : true;
				if (_cp.video.timer)
				{
					shrt.id("textArea").minLength=1;
					shrt.id("contBut").style.filter="grayscale(1)";
					shrt.id("contBut").dataset.clickable=false;
				}
				else
				{
					shrt.id("textArea").minLength=0;
					shrt.id("contBut").style.filter="none";
					shrt.id("contBut").dataset.clickable=true;
				}
				var _playbut=shrt.cr("div");
				_playbut.className="videoPlayBut";
				_playbut.innerHTML=timer.svgPlayBut;
				shrt.id("questionPicDiv").appendChild(_playbut);
				if (_cp.video.hasOwnProperty("height") && _cp.video.height)
					shrt.id("questionPicDiv").style.maxHeight=_cp.video.height.toString()+"vh";
				_playbut.addEventListener("click",handlePlayButton);
				shrt.q(".questionPic").addEventListener("click",handlePlayButton);
				shrt.q(".questionPic").addEventListener("pause",function(){
					try {
						if (shrt.q(".questionPic").dataset.ended!="true")
						{
							shrt.q(".questionPic").addEventListener("click",handlePlayButton);
							shrt.q(".videoPlayBut").addEventListener("click",handlePlayButton);
							shrt.q(".videoPlayBut").style.display="block";
						}
					} catch(e){}
				});
				shrt.q(".questionPic").addEventListener("ended",function(){
					shrt.q(".questionPic").dataset.ended="true";
					shrt.q(".questionPic").removeEventListener("click",handlePlayButton);
					shrt.q(".videoPlayBut").removeEventListener("click",handlePlayButton);
					shrt.q(".videoPlayBut").style.display="none";
				});
			}
		}
		if (_cp.hasOwnProperty("hideAnswersText"))
		{
			if (_cp.hideAnswersText==true)
			{
				var _targetsel=_cp.oldSingleSelect ? ".answersBut > span" : ".multiButCont > span";
				for (var i=0; i<shrt.qAll(_targetsel).length; i++)
					shrt.qAll(_targetsel)[i].style.display="none";
			}
		}
		if (quizData.customParams.hasOwnProperty("defaultExpandQuestionArea") && (_cp.hasOwnProperty("expandQuestionArea")===false || typeof _cp.expandQuestionArea==="undefined"))
			_cp.expandQuestionArea=quizData.customParams.defaultExpandQuestionArea;
		if ((nextQ.type==0 || nextQ.type==4 || nextQ.type==1 || nextQ.type==8) && ((_cp.hasOwnProperty("expandQuestionArea") && _cp.expandQuestionArea!=false) || (nextQ.answers.length==1 && nextQ.picture!="") || (_cp.hasOwnProperty("promoScratch") && _cp.promoScratch.enabled)))
		{
			var _hh=(typeof _cp.expandQuestionArea=="boolean" ? 80 : parseInt(_cp.expandQuestionArea))
			shrt.id("questionDiv").style.height=_hh+"%";
			shrt.id("answersDiv").style.height=(100-_hh)+"%";
			if (_cp.hasOwnProperty("picAreaHeight") && typeof _cp.picAreaHeight=="number")
			{
				shrt.q(".questionPicDiv").style.maxHeight=_cp.picAreaHeight+"vh";
			}
			if (_cp.hasOwnProperty("promoScratch"))
			{
				if (nextQ.answers.length==1 && nextQ.picture!="" && _cp.promoScratch.skippable!=true)
				{
					shrt.id("answersBut0").dataset.clickable=false;
					shrt.id("answersBut0").dataset.threshold=true;
				}
			}
		}
		if (_cp.expandAnswersArea || (_cp.hasOwnProperty("wheelOfFortune") && _cp.wheelOfFortune.enabled))
		{
			shrt.id("questionDiv").style.height="30%";
			shrt.id("answersDiv").style.height="70%";
		}
		if (_cp.hasOwnProperty("ctaLink") && _cp.ctaLink.enabled)
		{
			if (_cp.ctaLink.externalContinue)
			{
				_cp.ctaLink.link=[apiData.externalContinue];
				if (!previewMode)
				{
					applyExternalRedirectRules();
				}
			}
			if (_cp.ctaLink.link)
			{
				if (!_cp.ctaLink.text)
					_cp.ctaLink.text=texts[lang].cta.text;
				if (!_cp.ctaLink.skipText)
					_cp.ctaLink.skipText=texts[lang].cta.skip;
				if (Array.isArray(_cp.ctaLink.link))
					_cp.ctaLink.link=shuffle(_cp.ctaLink.link)[0];
				shrt.id("textArea").style.display="none";
				setAnswer([1]);
				shrt.id("multiSelectArea").appendChild(createCtaLink(_cp.ctaLink));
				shrt.id("multiSelectArea").style.overflowY="visible";
				if (_cp.ctaLink.skipText)
					shrt.id("contBut").innerHTML=_cp.ctaLink.skipText;
				shrt.id("contBut").style.filter="none";
				shrt.id("contBut").dataset.clickable=true;
				shrt.id("cont").style.paddingTop=_cp.hasOwnProperty("privacy") ? "0px" : "64px";
				if (_cp.ctaLink.hasOwnProperty("skipTime") && typeof _cp.ctaLink.skipTime=="number" && _cp.ctaLink.skipTime>0)
				{
					shrt.id("contBut").style.display="none";
					addInterval("skipTime",function(){
						try{
							shrt.id("contBut").style.display="flex";
							shrt.id("contBut").classList.add("fadeIn");
						}catch(e){}
						deleteInterval("skipTime");
					},1000*_cp.ctaLink.skipTime);
				}
				shrt.id("multiSelectArea").style.height="calc(100% - 128px)";
				/*if (shrt.id("questionPicDiv"))
				{
					_link=shrt.cr("a");
					_link.href=_cp.ctaLink.link;
					_link.target="_blank";
					shrt.wrap(_link,shrt.id("questionPicDiv"));
					imageResize();
				}*/
				
			}
		}
		if (_cp.hasOwnProperty("wheelOfFortune") && typeof _cp.wheelOfFortune=="object")
		{
			if (_cp.wheelOfFortune.enabled)
			{
				_cp.wheelOfFortune.num=getRandomInt(0,quizData.questions[quizIndex].answers.length-1);
				var _n=shrt.id("multiSelectArea").childNodes;
				for (var i=0; i<_n.length; i++)
					_n[i].style.display="none";
				var _ldr=shrt.cr("div");
				_ldr.className="loaderCont";
				_ldr.id="initLoader";
				shrt.id("multiSelectArea").appendChild(_ldr);
				var _ldr2=shrt.cr("div");
				_ldr2.className="loader";
				_ldr.appendChild(_ldr2);
				setTimeout(function(){shrt.id("initLoader").remove();wheelOfFortune.html(shrt.id("multiSelectArea"));shrt.id("wheelOfFortune").classList.add("fadeInFast");},500);
				shrt.id("multiSelectArea").style.overflowY="visible";
			}
		}
		if (_cp.hideCross)
			shrt.id("surveyClose").style.display="none";
		if ((_cp.hasOwnProperty("contCtaColors") && _cp.contCtaColors==true) || forceContCtaColors)
		{
			try {
				shrt.id("contBut").classList.add("contCta");
			}catch(e){}
		}
		if (_cp.hasOwnProperty("binaryChoice") && _cp.binaryChoice.enabled)
		{
			if (_cp.binaryChoice.colors)
			{
				try {
					var i;
					for (i=0; i<_cp.binaryChoice.colors.length; i++)
					{
						shrt.id("answersBut"+i).style.background=_cp.binaryChoice.colors[i].bg;
						shrt.id("answersBut"+i).style.color=_cp.binaryChoice.colors[i].text;
					}
				}catch(e){}
			}
		}
		if (typeof _cp.pictureZoom=="undefined") _cp.pictureZoom=false;
		if (_cp.pictureZoom && !(_cp.wheelOfFortune || _cp.clickMap || _cp.promoScratch || _cp.video))
		{
			var _img=shrt.q(".questionPic");
			_img.style.cursor="pointer";
			_img.onclick=onZoomedImg;
			var _iconCont=shrt.cr("div");
			_iconCont.id="zoomIcon";
			_iconCont.style.opacity=0;
			_img.parentElement.appendChild(_iconCont);
			var _icon=document.createElementNS("http://www.w3.org/2000/svg","svg");
			_icon.setAttribute("viewBox","0 0 512 512");
			_icon.innerHTML=icons.search_plus;
			_iconCont.appendChild(_icon);
			_iconCont.onclick=onZoomedImg;
			shrt.id("questionPicDiv").addEventListener("animationend",function(){
				shrt.id("zoomIcon").style.position="fixed";
				shrt.id("zoomIcon").style.opacity=1;
				shrt.id("zoomIcon").classList.add("fadeInFast");
				iconFix();
				_zoomInt=setInterval(iconFix,50);
			});
		}
		if (_cp.verticalPic)
		{
			try{shrt.id("questionPicDiv").style.maxHeight=(typeof _cp.verticalPic=="number" ? Math.max(0,Math.min(100,_cp.verticalPic)).toString()+"vh" : "70vh");}catch(e){}
		}
		pauseQuizTimer(_cp.hasOwnProperty("pauseQuizTimer") && _cp.pauseQuizTimer);
		if (_cp.stopQuizTimer)
			stopQuizTimer();
	}
  }
  for(var i=0; i<shrt.qAll("div:not(.multi)>.scale-up-center").length; i++){shrt.qAll("div:not(.multi)>.scale-up-center")[i].addEventListener("animationend",function(){this.style.animation="none";})}
}

window.addEventListener("resize",function(){
	imageResize();
	scratchCard_resize();
	wheelOfFortune.resize();
	dropdownResize();
	var _pts=shrt.qAll(".clickMapPointer");
	for (var i=0; i<_pts.length; i++)
		setPoint(_pts[i]);
});

function dropdownResize() {
	try {
		var _d=shrt.id("dropdown");
		var _t=shrt.id("textArea");
		_d.style.width=_t.offsetWidth+"px";
		_d.style.left=_t.offsetLeft+"px";
		_d.style.top=_t.offsetTop+_t.offsetHeight+"px";
		_d.style.height=shrt.id("contBut").offsetTop-(_t.offsetTop+_t.offsetHeight)-10+"px";
		_d=shrt.q(".loaderSmall");
		var _h=16;
		var _ww=(_t.offsetHeight-_h)+"px";
		_d.style.width=_ww;
		_d.style.height=_ww;
		_d.style.minWidth=_ww;
		_d.style.left=(_t.offsetWidth+_t.offsetLeft-_h/2-_d.offsetWidth)+"px";
		_d.style.top=(_t.offsetTop+_h/4)+"px";
	}catch(e){}
}

function fillDropdown(obj){
	var _d=shrt.id("dropdown");
	_d.innerHTML="";
	var i, _de, _arr;
	for (i=0; i<obj.length;i++)
	{
		_de=document.createElement("div");
		_de.className="dropdownCity";
		_arr=[]; if (obj[i].hasOwnProperty("area") && obj[i].area.hasOwnProperty("name")) _arr.push(obj[i].area.name); if (obj[i].hasOwnProperty("region") && obj[i].region.hasOwnProperty("name")) _arr.push(obj[i].region.name);
		_de.innerHTML="<p>"+obj[i].name+(_arr.length>0 ? "<br><span>"+_arr.join(", ")+"</span>" : "")+"</p>";
		if (obj[i].hasOwnProperty("id"))
		{
			_de.dataset.id=obj[i].id;
			_de.onclick=onCitySelected;
		}
		else
			_de.style.cursor="default";
		_de.dataset.city=obj[i].name;
		if (obj[i].area.hasOwnProperty("name"))
			_de.dataset.area=obj[i].area.name;
		if (obj[i].region.hasOwnProperty("name"))
			_de.dataset.region=obj[i].region.name;
		_d.appendChild(_de);
	}
	dropdownResize();
}

function onCitySelected() {
	var _res=this.dataset.city;
	if (quizData.questions[quizIndex].customParams.hasOwnProperty("citySettings"))
	{
		var _arr=[_res];
		if (quizData.questions[quizIndex].customParams.citySettings.includeArea && this.dataset.hasOwnProperty("area"))
			_arr.push(this.dataset.area);
		if (quizData.questions[quizIndex].customParams.citySettings.includeRegion && this.dataset.hasOwnProperty("region"))
			_arr.push(this.dataset.region);
		_res=_arr.join(quizData.questions[quizIndex].customParams.citySettings.separator || ", ");
	}
	shrt.id("textArea").value=this.dataset.city;
	deleteInterval("city");
	shrt.id("dropdown").innerHTML="";
	var _isText=!(quizData.questions[quizIndex].category==6);
	setAnswer(_isText ? [_res] : [parseInt(this.dataset.id)],_isText);
	shrt.id("contBut").style.filter="none";
	shrt.id("contBut").dataset.clickable=true;
}

function setPoint(point,x,y) {
	try {
		if (point)
		{
			if (typeof x=="undefined")
				x=parseInt(point.dataset.x);
			if (typeof y=="undefined")
				y=parseInt(point.dataset.y);
			var coords= shrt.q("#questionPicDiv > img").getBoundingClientRect();
			var xx = Math.round(coords.left+coords.width*x/100);
			var yy = Math.round(coords.top+coords.height*y/100);
			point.style.left=xx+"px";
			point.style.top=yy+"px";
		}
	}catch(e){}
}

function openPopup(link) {
	shrt.id("popupIframe").style.opacity=0;
	shrt.id("popupCont").style.display="flex";
	shrt.id("popupIframe").src=link;
}

function closePopup(){
	shrt.id("popupCont").style.display="none";
}

function checkPrivacyBoxes(callback) {
	try{
		var _res=true;
		shrt.id("privacyForm").querySelectorAll("input[type=checkbox]").forEach(e=>{
			if (e.checked==false) _res=false;
		});
		callback(_res);
	}catch(e){}
}

function privacyButHandle(val)
{
	var _trg=shrt.id("answersBut0");
	_trg.style.filter=val ? "none" : "grayscale(1)";
	_trg.dataset.clickable=val;
}

function handleOther(result)
{
	var _othVal=shrt.id("otherInput").value;
	var _targetBut=shrt.id("answersBut"+otherIndex);
	if (result==true)
		otherString=_othVal;
	else
	if (otherString=="")
		shrt.id("otherInput").value="";
	shrt.q("#answersBut"+otherIndex+" > .multiButCont > span").innerHTML=(otherString=="") ? quizData.questions[quizIndex].answers[otherIndex].text : _othVal;
	otherChecker=true;
	_targetBut.click();
	shrt.id("otherPopupCont").style.display="none";
}

shrt.id("surveyClose").onclick=function(){
	if (shrt.qAll("#zoomedCont").length==0)
	{
		if (shrt.id("popupCont").style.display=="flex")
			closePopup();
		else
		if (shrt.id("otherPopupCont").style.display!="none")
			handleOther(false);
		else
		{
			this.style.display="none";
			shrt.id("confirmOverlay").style.display="flex";
		}
	}
	else
	{
		this.classList.remove("zoomCross");
		shrt.id("zoomedCont").remove();
	}
};

shrt.id("confirmNo").onclick=function(){
	shrt.id("surveyClose").style.display="block";
	shrt.id("confirmOverlay").style.display="none";
};

shrt.id("confirmYes").onclick=function(){
	sendPostback("closed");
	var _resp={surveyMaster:{event:"onFail",data:callbackData}};
	callSDK(JSON.stringify(_resp));
};

function handleNumber(num)
{
	if (typeof num=="number")
		return num;
	if (typeof num=="string")
	{
		var nonum=num.replace(/[0-9]/g, '');
		var curYear=new Date().getFullYear();
		if (nonum=="y")
			return curYear;
		if (nonum=="y-")
			return curYear-parseInt(num.replace("y-",""));
		if (nonum=="y+")
			return curYear+parseInt(num.replace("y+",""));
		
		return parseInt(num);
	}
}

function declOfNum(number, titles)
{
    cases = [2, 0, 1, 1, 1, 2];
    return titles[ (number%100>4 && number%100<20)? 2 : cases[(number%10<5)?number%10:5] ];
}

function answerSearch(str) {
	var _sel=shrt.qAll("#multiSelectArea > div[id^=answer]");
	var _vsbl="";
	var _altStr="";
	for (var i=0; i<_sel.length; i++) {
		if (_sel[i].dataset.nonsearchable!="true" && _sel[i].dataset.hidden!="true")
		{
			if (quizData.questions[quizIndex].customParams.searchBar.hasOwnProperty("altTexts"))
				_altStr=quizData.questions[quizIndex].customParams.searchBar.altTexts["ans"+_sel[i].firstChild.dataset.number] || "";
			_vsbl=((_sel[i].querySelector("div[id^=answers] > .multiButCont > span").innerHTML+_altStr).toUpperCase().replaceAll("Ё","Е").replaceAll("Й","И").indexOf(str.toUpperCase().replaceAll("Ё","Е").replaceAll("Й","И"))>-1) ? "flex" : "none";
			_sel[i].style.display=_vsbl;
			/*if (_sel[i].nextSibling)
				_sel[i].nextSibling.style.display=_vsbl;*/
		}
	}
}

function answerHideByArray(arr,invert,first,alshow) {
	if (typeof invert=="undefined") invert=false;
	var _sel=shrt.qAll(".multiSelectArea > div[id^=answer]");
	var _vsbl="";
	console.log(first);
	if (typeof first=="undefined")
		first=_sel.length;
	first=Math.min(Math.max(first,1),_sel.length);
	var _annum;
	if (typeof alshow==="undefined")
		alshow=[];
	for (var i=0; i<first; i++) {
		if (_sel[i].dataset.nonsearchable!="true")
		{
			_annum=parseInt(_sel[i].querySelector("div[id^=answers]").dataset.number);
			_vsbl=(arr.includes(_annum)!=invert || alshow.includes(_annum)) ? "flex" : "none";
			_sel[i].style.display=_vsbl;
			/*if (_sel[i].nextSibling)
				_sel[i].nextSibling.style.display=_vsbl;*/
			_sel[i].dataset.hidden="true";
		}
	}
}

function matrixHideByArray(arr,invert) {
	if (typeof invert=="undefined") invert=false;
	var _sel=shrt.qAll("[data-matrixpart]");
	var _vsbl="";
	for (var i=0; i<_sel.length; i++) {
			_vsbl=(arr.includes(parseInt(_sel[i].dataset.matrixpart))!=invert) ? "block" : "none";
			_sel[i].style.display=_vsbl;
			_sel[i].dataset.hidden=(_vsbl=="none");
			if (_vsbl=="none") _sel[i].dataset.omit="true";
	}
}

function themeSetup()
{
	if (isWebView)
	{
		if (platform==1)
		{
			document.documentElement.style.setProperty("--safe-top","20px");
		}
	}
	if (quizData.settings.theme)
		customColorsSetup(quizData.settings.theme);
	if (quizData.settings.bg)
	{
		if (quizData.settings.bg.indexOf(":")>-1)
			quizData.settings.bg=quizData.settings.bg.split(":");
		var _bgstyle;
		if (typeof quizData.settings.bg=="object")
			_bgstyle="linear-gradient(0deg, "+quizData.settings.bg[0]+" 0%, "+quizData.settings.bg[1]+" 100%)";
		else
			_bgstyle=quizData.settings.bg;
		document.body.style.backgroundColor=_bgstyle;
		shrt.id("area").style.background=_bgstyle;
	}
	if (quizData.settings.text)
		document.body.style.color=quizData.settings.text;
	if (quizData.settings.but)
	{
		if (quizData.settings.but.indexOf(":")>-1)
			quizData.settings.but=quizData.settings.but.split(":");
		if (typeof quizData.settings.but=="object")
			quizData.settings.butCol="linear-gradient(to right, "+quizData.settings.but[0]+", "+quizData.settings.but[1]+")";
		else
			quizData.settings.butCol=quizData.settings.but;
	}
	if (quizData.settings.logo)
	{
		if (quizData.settings.logo.enabled==false)
			shrt.id("logoImg").style.display="none";
		if (quizData.settings.logo.src)
			shrt.id("logoImg").src=quizData.settings.logo.src;
	}
}

function customColorsSetup(obj)
{
	if (obj)
	{
		if (typeof obj=="object")
		{
			var _names=Object.getOwnPropertyNames(obj);
			for (var i=0; i<_names.length; i++)
			{
				document.documentElement.style.setProperty("--"+_names[i].replaceAll("_","-"),obj[_names[i]]);
			}
			if (obj.hasOwnProperty("col_logo"))
			{
				var _clr=logoColor(obj.col_logo);
				shrt.id("logoImg").style.filter=_clr;
				filterColor=_clr;
			}
			if (obj.hasOwnProperty("bg_type"))
				if (obj.bg_type!=bgId)
					bgSetup(obj.bg_type);
		}
	}
}

function bgSetup(type)
{
	var _arr=["none","squares","grid","gradient"];
	if (type=="random")
		type=shuffle(_arr)[0];
	if (bgId!=type)
	{
		var _bg=shrt.id("area");
		var _bgl=_bg.classList;
		for (var i=0; i<_bgl.length; i++)
		{
			if (_bgl[i]!="area")
				_bg.classList.remove(_bgl[i]);
		}
		_bg.innerHTML="";
		switch (type)
		{
			case "squares":
				_bg.innerHTML='<ul class="circles"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>';
				bgId="squares";
			break;
			case "grid":
				_bg.classList.add("grid");
				_bg.innerHTML='<div></div><div></div>';
				bgId="grid";
			break;
			case "gradient":
				_bg.classList.add("gradient");
				bgId="gradient";
			break;
			case "none":
			default:
				bgId="none";
			break;
		}
	}
}

function imagesSetup(callback)
{
	var i,j,num;
	imagesTotal=0;
	images=[];
	for (i=0; i<quizData.questions.length; i++)
	{
		if (quizData.questions[i].hasOwnProperty("customParams") && quizData.questions[i].customParams.hasOwnProperty("picture"))
			quizData.questions[i].picture=quizData.questions[i].customParams.picture;
		if (quizData.questions[i].hasOwnProperty("picture") && quizData.questions[i].picture!="")
		{
			imagesTotal++;
			num=i.toString();
			if (quizData.questions[i].picture.indexOf("api/v1/service/picture?pic=")==0)
				quizData.questions[i].picture=quizData.questions[i].picture.replace("api/v1/service/picture?pic=","");
			if (quizData.questions[i].picture.indexOf("http")!=0)
				quizData.questions[i].picture=apiData.pictureEndpoint+quizData.questions[i].picture;
			addImage(num,quizData.questions[i].picture,callback,"questionPic");
		}
		if (quizData.questions[i].hasOwnProperty("customParams"))
		{
			try {
				var _cp=quizData.questions[i].customParams;
				if (_cp.hasOwnProperty("video"))
					if (_cp.video.src!="")
						quizData.questions[i].video=_cp.video.src;
			}catch(e){}
		}
		if (quizData.questions[i].hasOwnProperty("video") && quizData.questions[i].video!="")
		{
			imagesTotal++;
			num=i.toString();
			if (quizData.questions[i].video.indexOf("api/v1/service/picture?pic=")==0)
				quizData.questions[i].video=quizData.questions[i].video.replace("api/v1/service/picture?pic=","");
			if (quizData.questions[i].video.indexOf("http")!=0)
				quizData.questions[i].video=apiData.pictureEndpoint+quizData.questions[i].video;
			addVideo(num,quizData.questions[i].video,callback,"questionPic");
		}
		if (typeof quizData.questions[i].answers=="object")
		{
			for (j=0; j<quizData.questions[i].answers.length; j++)
			{
				if (quizData.questions[i].answers[j].hasOwnProperty("picture") && quizData.questions[i].answers[j].picture!="")
				{
					imagesTotal++;
					num=i.toString()+"_"+j.toString();
					if (quizData.questions[i].answers[j].picture.indexOf("api/v1/service/picture?pic=")==0)
						quizData.questions[i].answers[j].picture=quizData.questions[i].answers[j].picture.replace("api/v1/service/picture?pic=","");
					if (quizData.questions[i].answers[j].picture.indexOf("http")!=0)
						quizData.questions[i].answers[j].picture=apiData.pictureEndpoint+quizData.questions[i].answers[j].picture;
					addImage(num,quizData.questions[i].answers[j].picture,callback);
				}
			}
		}
	}
	if (imagesTotal==0)
		callback();
}

function imageResize()
{
	var _newimg=shrt.q(".questionPicDiv > img");
	if (_newimg)
	{
		if (_newimg.naturalWidth>_newimg.naturalHeight && _newimg.width/_newimg.height!=_newimg.naturalWidth/_newimg.naturalHeight && !quizData.questions[quizIndex].customParams.imageScaleFixOff)
			_newimg.style.height=_newimg.width*(_newimg.naturalHeight/_newimg.naturalWidth)+"px";
	}	
}

function addImage(num,src,callback,className)
{
	images[num]=new Image();
	images[num].src=src;
	images[num].className=className || "";
	images[num].number=num;
	images[num].onload=images[num].onerror=function(){
		imagesLoaded++;
		if (imagesLoaded==imagesTotal)
			callback();
	}
}

function addVideo(num,src,callback,className)
{
	images[num]=new Video();
	images[num].src=src+"#t=0.1";
	images[num].setAttribute("preload","auto");
	images[num].setAttribute("playsinline","");
	images[num].className=className || "";
	images[num].number=num;
	images[num].oncanplaythrough=function(){
		imagesLoaded++;
		if (imagesLoaded==imagesTotal)
			callback();
	}
	images[num].addEventListener("error",function(){
		console.log("video error");
		if (currentBlock==0)
			callSDK('{"surveyMaster":{"event":"onLoadFail","data":{}}}');
		else
			closeTimer();
	});
	images[num].load();
}

if (typeof Video=="undefined")
{
	Video=function(src) {
		var v = shrt.cr("video");
		if (src != "")
		v.src = src;
		return v;
	}
}

function playVideo() 
{
    var _vid=shrt.q(".questionPic");
    _vid.play();
	startTimer(Math.round(_vid.duration),shrt.id("contBut"),function(){
		shrt.id("textArea").value="1";
		shrt.id("textArea").dispatchEvent(new Event('input', {bubbles:true}));
		shrt.id("contBut").innerHTML=texts[lang].next;
	});
}

function handlePlayButton() {
	playVideo();
	shrt.q(".videoPlayBut").removeEventListener("click",handlePlayButton);
	shrt.q(".videoPlayBut").style.display="none";
	shrt.q(".questionPic").removeEventListener("click",handlePlayButton);
}

function sendPostback(postback)
{
	if (quizData.customParams.postbacks)
	{
		if (quizData.customParams.postbacks.enabled)
		{
			if (quizData.customParams.postbacks.list.indexOf(postback)>-1)
				request(apiData.endpoint+"survey/postback","POST",{body:{user_id:apiData.uid.toString(),app_key:apiData.gid.toString(),postback:postback,token:quizData.timerData.token}});
		}
	}
}

function startTimer(seconds,targetElement,callback)
{
	timer.seconds=seconds;
	if (targetElement)
		targetElement.innerHTML=secondsToTimer(seconds);
	timer.target=targetElement;
	clearInterval(timer.interval);
	timer.callback=callback;
	timer.interval=setInterval(function(){
		if (timer.seconds>0)
		{
			timer.seconds--;
			if (timer.target)
				timer.target.innerHTML=secondsToTimer(timer.seconds);
		}
		else
		{
			clearInterval(timer.interval);
			timer.callback();
		}
	},1000);
}

function completeCrossTimer(forced){
	clearInterval(crossTimer.interval);
	shrt.id("crossTimer").style.display="none";
	if (!forced)
		sendPostback("timeout");
}

function startCrossTimer(seconds,targetElement,callback)
{
	crossTimer.seconds=seconds;
	if (targetElement)
		targetElement.innerHTML=seconds;
	crossTimer.target=targetElement;
	clearInterval(crossTimer.interval);
	crossTimer.callback=callback;
	crossTimer.interval=setInterval(function(){
		if (crossTimer.seconds>1)
		{
			crossTimer.seconds--;
			if (crossTimer.target)
				crossTimer.target.innerHTML=crossTimer.seconds;
		}
		else
		{
			clearInterval(crossTimer.interval);
			crossTimer.callback();
		}
	},1000);
}

function startQuizTimer(targetElement)
{
	quizTimer.seconds=0;
	if (targetElement)
		targetElement.innerHTML=secondsToTimer(0);
	quizTimer.target=targetElement;
	clearInterval(quizTimer.interval);
	quizTimer.interval=setInterval(function(){
		if (!quizTimer.paused)
		{
			quizTimer.seconds++;
			if (quizTimer.target)
				quizTimer.target.innerHTML=millisecondsToTimer(quizTimer.seconds);
		}
	},10);
}

function stopQuizTimer(){
	clearInterval(quizTimer.interval);
	if (quizTimer.target)
	{
		quizTimer.target.classList.remove("paused");
		quizTimer.target.classList.add("timerFlash");
	}
}

function pauseQuizTimer(pause){
	quizTimer.paused=(typeof pause=="boolean" ? pause : !quizTimer.paused);
	if (quizTimer.target)
	{
		if (quizTimer.paused)
			quizTimer.target.classList.add("paused");
		else
			quizTimer.target.classList.remove("paused");
	}
}

function secondsToTimer(secs)
{
    var sec_num = parseInt(secs, 10);
    var hours   = Math.floor(sec_num / 3600);
    var minutes = Math.floor((sec_num - (hours * 3600)) / 60);
    var seconds = sec_num - (hours * 3600) - (minutes * 60);

    if (hours   < 10) {hours   = "0"+hours;}
    if (minutes < 10) {minutes = "0"+minutes;}
    if (seconds < 10) {seconds = "0"+seconds;}
    return (secs>=3600 ? hours+':' : '')+minutes+':'+seconds;
}

function millisecondsToTimer(secs)
{
    var milsec_num = parseInt(secs, 10);
    var hours   = Math.floor(milsec_num / 360000);
    var minutes = Math.floor((milsec_num - (hours * 360000)) / 6000);
    var seconds = Math.floor((milsec_num - (hours * 360000) - (minutes * 6000)) / 100);
	var milseconds = milsec_num - (hours * 360000) - (minutes * 6000) - (seconds * 100);

    if (hours   < 10) {hours   = "0"+hours;}
    if (minutes < 10) {minutes = "0"+minutes;}
    if (seconds < 10) {seconds = "0"+seconds;}
	if (milseconds < 10) {milseconds = "0"+milseconds;}
    return (secs>=360000 ? hours+':' : '')+minutes+':'+seconds+':'+milseconds;
}

function npsFunc()
{
	if (typeof answers[quizIndex].array_of_uints!="undefined" && answers[quizIndex].array_of_uints.array.length>0)
		shrt.id("npsBut"+answers[quizIndex].array_of_uints.array[0]).classList.remove("npsSelected");
	setAnswer([parseInt(this.value)]);
	this.classList.add("npsSelected");
	shrt.id("answersBut0").style.filter="none";
}

function handleStarsRating(obj)
{
	shrt.id("starsHidden").value=obj.dataset.rating;
	shrt.id("contBut").style.filter="none";
	shrt.id("contBut").dataset.clickable=true;
}

function shuffle(array) {
  var currentIndex = array.length,  randomIndex;

  while (currentIndex != 0) {

    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex--;

    [array[currentIndex], array[randomIndex]] = [
      array[randomIndex], array[currentIndex]];
  }

  return array;
}

function shuffleArray(array,obj){
	if (!obj) obj={}
	var from=Math.max(obj.from || 0,0);
	var to=Math.max((obj.to+1) || array.length,0);
	var reverse=obj.reverse || false;
	var _temparr=array.slice(from,to);
	_temparr=reverse ? _temparr.reverse() : shuffle(_temparr);
	_temparr=array.slice(0,from).concat(_temparr.concat(array.slice(to,array.length)));
	return _temparr
}

function handleShuffleOption(array,opt)
{
	switch (opt)
	{
		case 1:
			array=shuffle(array);
		break;
		case 2:
			array=shuffleArray(array,{from:0,to:array.length-2});
		break;
		case 3:
			array=shuffleArray(array,{from:0,to:array.length-3});
		break;
		case 4:
			array=shuffleArray(array,{from:1});
		break;
		case 5:
			array=shuffleArray(array,{from:2});
		break;
		case 6:
			array=shuffleArray(array,{from:1,to:array.length-2});
		break;
		case 7:
			array=shuffleArray(array,{reverse:true});
		break;
		case 8:
			array=shuffleArray(array,{reverse:true,to:array.length-2});
		break;
		case 9:
			array=shuffleArray(array,{reverse:true,to:array.length-3});
		break;
		case 10:
			array=shuffleArray(array,{from:1,to:array.length-3});
		default: break;
	}
	return array;
}

function redirectCond(val,target,cond)
{
	try {
		var _res=false;
		switch (cond)
		{
			case "equals": _res=(val==target); break;
			case "not_equals": _res=(val!=target); break;
			case "lesser": _res=(val<target); break;
			case "lesser_or_equal": _res=(val<=target); break;
			case "greater": _res=(val>target); break;
			case "greater_or_equal": _res=(val>=target); break;
			case "contains": _res=(val.toLowerCase().includes(target.toLowerCase())); break;
			case "not_contains": _res=(!(val.toLowerCase().includes(target.toLowerCase()))); break;
			default: break;
		}
		return _res;
	} catch(e){return false;}
}

function checkArrOfBools(arr,operator)
{
	if (arr.length==0) return false;
	var _res=false;
	switch (operator)
	{
		case "and":	_res=(arr.every(Boolean)); break;
		case "or":
			for (var i=0; i<arr.length; i++)
			{
				if (arr[i]==true)
				{
					_res=true;
					break;
				}
			}
		break;
		default:
		break;
	}
	return _res;
}

function checkRules()
{
	var qObj=null;
	var _defaultResult={redirect:{question_id: -1, block_id: ""},customVars:[]};
	var i,j,k,_ansArr,_condArr,_compArr,_compVal,l,l0,l1;
	if (quizData.rules)
	{
		for (i=0; i<quizData.rules.length; i++)
		{
			if (quizData.rules[i].question_id==quizIndex)
			{
				qObj=quizData.rules[i];
				break;
			}
		}
		if (qObj==null) return _defaultResult;
		for (i=0; i<qObj.list_of_rules.length; i++)
		{
			_condArr=[];
			for (j=0; j<qObj.list_of_rules[i].list_of_conditions.length; j++)
			{
				_compArr=[];
				if (answers[qObj.list_of_rules[i].list_of_conditions[j].question_id].hasOwnProperty("array_of_uints"))
				{
					_ansArr=answers[qObj.list_of_rules[i].list_of_conditions[j].question_id].array_of_uints.array;
					_compVal="comparison_int_value";
				}
				if (answers[qObj.list_of_rules[i].list_of_conditions[j].question_id].hasOwnProperty("array_of_strings"))
				{
					_ansArr=answers[qObj.list_of_rules[i].list_of_conditions[j].question_id].array_of_strings.array;
					_compVal="comparison_string_value";
				}
				for (k=0; k<qObj.list_of_rules[i].list_of_conditions[j].list_of_comparisons.length; k++)
				{
					if (qObj.list_of_rules[i].list_of_conditions[j].list_of_comparisons[k].comparison_element_id==-1)
					{
						l0=0;
						l1=_ansArr.length;
					}
					else
					{
						l0=qObj.list_of_rules[i].list_of_conditions[j].list_of_comparisons[k].comparison_element_id;
						l1=qObj.list_of_rules[i].list_of_conditions[j].list_of_comparisons[k].comparison_element_id+1;
					}
					for (l=l0; l<l1; l++)
					{
						_compArr.push(redirectCond((qObj.list_of_rules[i].list_of_conditions[j].list_of_comparisons[k].comparison_element_id==-2 ? _ansArr.length : _ansArr[l]),qObj.list_of_rules[i].list_of_conditions[j].list_of_comparisons[k][_compVal],qObj.list_of_rules[i].list_of_conditions[j].list_of_comparisons[k].comparison_type));
					}
				}
				_condArr.push(checkArrOfBools(_compArr,qObj.list_of_rules[i].list_of_conditions[j].comparison_keyword));
			}
			if (checkArrOfBools(_condArr,qObj.list_of_rules[i].condition_keyword))
				return {redirect:qObj.list_of_rules[i].redirect,customVars:qObj.list_of_rules[i].custom_vars};
		}
		return {redirect:qObj.redirect_default,customVars:qObj.custom_vars_default};
	}
	return _defaultResult;
}

function handleCustomVars(arr)
{
	var i;
	var _k=Object.keys(customVars);
	var _names=[];
	for (i=0; i<arr.length; i++)
		_names.push(arr[i].name);
	for (i=0; i<_k.length; i++)
	{
		var _lastvar=customVars[_k[i]][customVars[_k[i]].length-1];
		if (_names.indexOf(_k[i])>-1)
		{
			var _obj=arr.filter(el=>{return el.name==_k[i]})[0];
			switch(_obj.operation)
			{
				case "add": if (typeof _lastvar!="string") _lastvar+=_obj.value_int; break;
				case "substract": if (typeof _lastvar!="string") _lastvar-=_obj.value_int; break;
				case "set": _lastvar=(typeof _lastvar=="string") ? HtmlSanitizer.SanitizeHtml(_obj.value_string) : _obj.value_int; break;
			}
		}
		customVars[_k[i]].push(_lastvar);
	}
}

function progressBar(perc)
{
	shrt.id("progressBar").style.width=perc+"%";
}

function quizDataSetup()
{
	if (quizData.hasOwnProperty("sex")==false)
		quizData.sex=0;
	if (typeof quizData.rules=="undefined" || quizData.rules===null)
		quizData.rules=[];
	if (typeof quizData.customParams=="object" && Array.isArray(quizData.customParams.rules))
	{
		quizData.rules=[];
		for (i=0; i<quizData.customParams.rules.length; i++)
			quizData.rules.push(quizData.customParams.rules[i]);
	}
	var i, j, k;
	for (i=0; i<quizData.questions.length; i++)
	{
		if (quizData.questions[i].hasOwnProperty("matrix")==false)
			quizData.questions[i].matrix={isMatrix:false,matrixId:"",matrixStatement:""};
		if (quizData.questions[i].hasOwnProperty("customParams") && typeof quizData.questions[i].customParams=="object" && quizData.questions[i].customParams.hasOwnProperty("matrix"))
		{
			quizData.questions[i].matrix=quizData.questions[i].customParams.matrix;
		}
		if (quizData.questions[i].matrix.isMatrix)
		{
			quizData.questions[i].minAnswersNumber=1;console.log("matrix");
			if (i==0 || (i>0 && (quizData.questions[i-1].matrix.isMatrix===false || (quizData.questions[i-1].matrix.isMatrix && quizData.questions[i-1].matrix.matrixId!=quizData.questions[i].matrix.matrixId))))
			{
				var i2=0;
				var _next;console.log("dostart");
				do
				{
					i2++;
					console.log(quizData.questions[i+i2] || "end");
					if (i+i2>=quizData.questions.length || quizData.questions[i+i2].matrix.matrixId!=quizData.questions[i].matrix.matrixId)
						break;
				}while(true);
				console.log(i+i2);
				_next=(i+i2>=quizData.questions.length ? -2 : i+i2);
				console.log(_next);
				var _hasRule=false;
				for (k=0; k<quizData.rules.length; k++)
				{
					if (quizData.rules[k]==i)
					{
						quizData.rules[k].redirect_default={question_id:_next,block_id:""};
						_hasRule=true;
						break;
					}
				}
				if (!_hasRule)
					quizData.rules.push({question_id:i,list_of_rules:[],redirect_default:{question_id:_next,block_id:""},custom_vars_default:[]});
			}
		}
		else
		{
			if (quizData.questions[i].category==2 && quizData.questions[i].minAnswersNumber<=0 && quizData.questions[i].maxAnswersNumber<=0)
			{
				quizData.questions[i].minAnswersNumber=1;
				quizData.questions[i].maxAnswersNumber=quizData.questions[i].answers.length;
			}
		}
	}
	if (typeof quizData.customParams=="object" && (quizData.customParams.hasOwnProperty("shuffle") || quizData.customParams.hasOwnProperty("shuffleOptions")))
	{
		var _newOrder=[].concat.apply([],quizData.customParams.hasOwnProperty("shuffleOptions") ? shuffleArray(breakQuizArray(quizData.questions),quizData.customParams.shuffleOptions) : handleShuffleOption(breakQuizArray(quizData.questions),quizData.customParams.shuffle));
		for (i=0; i<_newOrder.length; i++)
		{
			for (j=0; j<_newOrder.length; j++)
			{
				if (_newOrder[i].id==quizData.questions[j].id)
				{
					shuffledOrder.push(j);
					break;
				}
			}
		}
		quizData.questions=_newOrder;
	}
	if (typeof quizData.customParams=="object" && (quizData.customParams.hasOwnProperty("customVars")))
	{
		for (i=0; i<quizData.customParams.customVars.length; i++)
			customVars[quizData.customParams.customVars[i].name]=[quizData.customParams.customVars[i].type=="string" ? HtmlSanitizer.SanitizeHtml(quizData.customParams.customVars[i].defaultValue.toString()) : quizData.customParams.customVars[i].defaultValue];
	}
	for (i=0; i<quizData.questions.length; i++)
	{
		var regex = /\[.*?\]/g, result, indices = [];
		while ( (result = regex.exec(quizData.questions[i].text)) ) {
			indices.push(result[0].replaceAll("[","").replaceAll("]",""));
		}
		for (j=0; j<indices.length; j++)
			quizData.questions[i].text=HtmlSanitizer.SanitizeHtml(quizData.questions[i].text.replace("["+indices[j]+"]",indices[j].split(",")[quizData.sex]));
		//redirects
		for (j=0; j<quizData.questions[i].answers.length; j++)
		{
			if (!(quizData.questions[i].answers[j].redirect==null))
			{
				//if (quizData.questions[i].answers[j].redirect.redirect==true)
				//{
					var _redirectTo=quizData.questions[i].answers[j].redirect.hasOwnProperty("toType") ? quizData.questions[i].answers[j].redirect.toType : quizData.questions[i].answers[j].redirect.to;
					switch(_redirectTo)
					{
						case 2:
						case 4:
							quizData.questions[i].answers[j].next=previewMode ? {next: -2, itemId: quizData.questions[i].answers[j].redirect.itemId}: -2;
						break;
						case 7:
							quizData.questions[i].answers[j].next=-2;
						break;
						case 6:
							var _nxtQ=questionNumById(quizData.questions[i].answers[j].redirect.itemId);
							if (_nxtQ>-1)
								quizData.questions[i].answers[j].next=_nxtQ;
						break;
						default: break;
					}
				//}
			}
			quizData.questions[i].answers[j].text=HtmlSanitizer.SanitizeHtml(quizData.questions[i].answers[j].text);
			quizData.questions[i].answers[j].picture=HtmlSanitizer.SanitizeHtml(quizData.questions[i].answers[j].picture);
		}
		quizData.questions[i].text=HtmlSanitizer.SanitizeHtml(quizData.questions[i].text);
		quizData.questions[i].picture=HtmlSanitizer.SanitizeHtml(quizData.questions[i].picture);
	}
}

window.onload=function()
{
	var _testapps=[];
	var _testusers=[];
	var _testusers_404=[];
	var _testapps_allowed=[];
	var testMode="0";

	urlParams=new URLSearchParams(window.location.search);
	if (typeof urlParams.get("uid")=="string")
	{
		var _uuu=urlParams.get("uid");
		if (_uuu.indexOf("__KUKUDATA__")>-1)
		{
			_uuu=_uuu.split("__KUKUDATA__");
			apiData.uid=_uuu[0];
			try{
				var _qd=JSON.parse(atou(_uuu[1]));
				idData=_qd;
			}catch(e){console.log(e);console.log("userId data parsing fail");}
		}
			else
		apiData.uid=_uuu;
	}
	if (typeof urlParams.get("gid")=="string")
		apiData.gid=urlParams.get("gid");
	if (typeof urlParams.get("isWebView")=="string")
		isWebView=parseInt(urlParams.get("isWebView") || 0);
	if (typeof urlParams.get("platform")=="string")
		platform=parseInt(urlParams.get("platform") || -1);
	if (typeof urlParams.get("test_mode")=="string")
		testMode=urlParams.get("test_mode");
	if (typeof urlParams.get("hideCross")=="string")
		hideCrossByDefault=urlParams.get("hideCross")=="1";
	if (typeof urlParams.get("test")=="string")
		hideCrossByDefault=urlParams.get("test")=="1";
	if (typeof urlParams.get("forceCross")=="string")
		hideCrossByDefault=urlParams.get("forceCross")!="1";
	if (typeof urlParams.get("version")=="string")
		version.current=urlParams.get("version");
	if (typeof urlParams.get("grabTheme")=="string")
		grabTheme=urlParams.get("grabTheme")=="1";
	if (typeof urlParams.get("grabTexts")=="string")
		grabTexts=urlParams.get("grabTexts")=="1";
	if (typeof urlParams.get("grabReward")=="string")
		grabReward=urlParams.get("grabReward")=="1";
	if (typeof urlParams.get("forceContCtaColors")=="string")
		forceContCtaColors=urlParams.get("forceContCtaColors")=="1";
	if (typeof urlParams.get("reward")=="string")
		forceReward=urlParams.get("reward")=="1";
	if (typeof urlParams.get("innerSurvey")=="string")
	{
		innerSurvey=(urlParams.get("innerSurvey")=="1" || urlParams.get("innerSurvey").toLowerCase()=="true");
		if (innerSurvey)
			apiData.uid="game_"+apiData.gid+"_"+apiData.uid;
	}
	if (typeof urlParams.get("vk_controls_type")=="string")
	{
		if (urlParams.get("vk_controls_type")=="1")
		{
			shrt.id("surveyClose").classList.add("vkControl");
		}
	}
	if (typeof urlParams.get("send_from_page")=="string")
	{
		if (urlParams.get("send_from_page")=="1")
		{
			sendAnswersFromPage=true;
		}
	}
	if (typeof urlParams.get("onFailWhenUnqualified")=="string")
		onFailWhenUnqualified=(urlParams.get("onFailWhenUnqualified")=="1");
	if (typeof urlParams.get("extData")=="string")
	{
		try {
			var _ed=JSON.parse(atou(decodeURIComponent(urlParams.get("extData"))));
			if (_ed.c && _ed.a && _ed.u && _ed.t && _ed.i && _ed.g && _ed.s)
			{
				externalData=_ed;
				apiData.uid=_ed.u;
				apiData.gid=_ed.g;
				touchArr=_ed.c;
				hasExternalData=true;
				hideCrossByDefault=true;
			}
		}catch(e){console.log("error: corrupt extData");callSDK('{"surveyMaster":{"event":"onLoadFail","data":{}}}');}
	}
	if (navigator.language)
		lang=navigator.language.split("-")[0];
	if (typeof urlParams.get("lang")=="string")
		lang=urlParams.get("lang");
	if (texts.hasOwnProperty(lang)==false)
		lang="en";
	if (grabTheme)
		callSDK('{"kykyshkaDebug":{"action":"grabTheme"}}');
	if (grabTexts)
		callSDK('{"kykyshkaDebug":{"action":"grabTexts"}}');
	if (grabReward)
		callSDK('{"kykyshkaDebug":{"action":"grabReward"}}');
	shrt.id("confirmNo").innerHTML='<b>'+texts[lang].no+'</b>';
	shrt.id("confirmYes").innerHTML='<b>'+texts[lang].yes+'</b>';
	shrt.id("confirmPopupMain").innerHTML='<p><b>'+texts[lang].closeLine0+'</b><br>'+texts[lang].closeLine1+'</p>';
	if (apiData.uid.indexOf("n6Dae0cWLz84")==0)
		apiData.cityEndpoint="https://black-snowflake.org/quiz_mockup/cityMock.php";
	if (_testusers_404.indexOf(apiData.uid)>-1 || _testusers_404[0]=="all" || (_testapps_allowed.indexOf(apiData.gid)==-1 && _testapps_allowed.length>0))
	{
		apiData.uid="";
		apiData.gid="";
		console.log("test user blocked from survey viewing");
		var _resp={surveyMaster:{event:"onSurveyUnavailable",data:{reason:"GAME_NOT_WHITELISTED"}}};
		if (currentBlock==0)
		{
			console.log("game not whitelisted");
			callSDK(JSON.stringify(_resp));
		}
		else
			closeTimer();
	}
	else
	if (((_testapps.indexOf(apiData.gid)>-1 || _testusers.indexOf(apiData.uid)>-1) && typeof urlParams.get("test_mode")!="string") || testMode=="1" || apiData.gid.indexOf("gamedemo")==0)
	{
		console.log("testid");
		var _testobj={ru:[{"block":{"id":"","type":0,"nextBlock":"","questions":[{"id":"aecfa583-419c-4301-b638-451e4604aa3a","text":"Привет! Это тестовый опрос для проверки интеграции SDK. Выбери интересующий ответ","answers":[{"text":"Пройти дальше","picture":"","redirect":{"to":0,"itemId":"","redirect":false},"screening":0,"answerGroup":0,"customAnswer":false,"customParams":""},{"text":"Тоже пройти дальше","picture":"","redirect":{"to":0,"itemId":"","redirect":false},"screening":0,"answerGroup":0,"customAnswer":false,"customParams":""},{"text":"Не пройти дальше","picture":"","redirect":{"to":0,"itemId":"","redirect":false},"screening":1,"answerGroup":0,"customAnswer":false,"customParams":""}],"picture":"","shuffle":0,"category":3,"targetId":0,"targetName":"","maxIntValue":0,"minIntValue":0,"customParams":"","mayBeSkipped":false,"maxAnswersNumber":1,"minAnswersNumber":1},{"id":"1f098950-bce5-49d9-bb34-98d3d8f3923a","text":"Выбери 1-2 вариантов ответа","answers":[{"text":"1","picture":"","redirect":{"to":0,"itemId":"","redirect":false},"screening":0,"answerGroup":0,"customAnswer":false,"customParams":""},{"text":"2","picture":"","redirect":{"to":0,"itemId":"","redirect":false},"screening":0,"answerGroup":0,"customAnswer":false,"customParams":""},{"text":"3","picture":"","redirect":{"to":0,"itemId":"","redirect":false},"screening":0,"answerGroup":0,"customAnswer":false,"customParams":""},{"text":"4","picture":"","redirect":{"to":0,"itemId":"","redirect":false},"screening":0,"answerGroup":0,"customAnswer":false,"customParams":""},{"text":"Другое. Укажите свой вариант","picture":"","redirect":{"to":0,"itemId":"","redirect":false},"screening":0,"answerGroup":0,"customAnswer":true,"customParams":""}],"picture":"","shuffle":0,"category":2,"targetId":0,"targetName":"","maxIntValue":0,"minIntValue":0,"customParams":"","mayBeSkipped":false,"maxAnswersNumber":2,"minAnswersNumber":1},{"id":"8ecbf01d-c5e7-4a48-a986-c8c3d9e17dcf","text":"Введи свой ответ","answers":[],"picture":"","shuffle":0,"category":5,"targetId":0,"targetName":"","maxIntValue":0,"minIntValue":0,"customParams":"","mayBeSkipped":false,"maxAnswersNumber":0,"minAnswersNumber":0},{"id":"fb583148-b2a7-485a-91b6-f7f581cf7dc4","text":"А тут введи число от 0 до 500","answers":[{"text":"0","picture":"","redirect":{"to":0,"itemId":"","redirect":false},"screening":0,"answerGroup":0,"customAnswer":false,"customParams":""},{"text":"500","picture":"","redirect":{"to":0,"itemId":"","redirect":false},"screening":0,"answerGroup":0,"customAnswer":false,"customParams":""}],"picture":"","shuffle":0,"category":6,"targetId":0,"targetName":"","maxIntValue":0,"minIntValue":0,"customParams":"","mayBeSkipped":false,"maxAnswersNumber":0,"minAnswersNumber":0},{"id":"34a4fce9-9785-4bfc-baed-ea4c0fc2de0b","text":"Картинки","answers":[{"text":"Другое. Укажите свой вариант","picture":"","redirect":{"to":0,"itemId":"","redirect":false},"screening":0,"answerGroup":0,"customAnswer":true,"customParams":""},{"text":" ","picture":"https://account.kykyshka.ru/api/v1/service/picture?pic=qETyhfUADX2BJG0Rmfr5ziII0KFAFYeD.png","redirect":{"to":0,"itemId":"","redirect":false},"screening":0,"answerGroup":0,"customAnswer":false,"customParams":""},{"text":" ","picture":"https://account.kykyshka.ru/api/v1/service/picture?pic=43jg3JU62WQUZDsLY1J2CYXnk0bBnDee.png","redirect":{"to":0,"itemId":"","redirect":false},"screening":0,"answerGroup":0,"customAnswer":false,"customParams":""}],"picture":"https://cdn.kykyshka.ru/images/testimg.png","shuffle":0,"category":1,"targetId":0,"targetName":"","maxIntValue":0,"minIntValue":0,"customParams":"{\"pictureZoom\":true}","mayBeSkipped":false,"maxAnswersNumber":0,"minAnswersNumber":0}],"callbackUrl":"","customParams":""}}],
		en:[{"block":{"id":"","type":0,"nextBlock":"","questions":[{"id":"aecfa583-419c-4301-b638-451e4604aa3a","text":"Hi there! This is a test survey designed to let you see if our SDK has been implemented correctly. Now go select an answer!","answers":[{"text":"Go further","picture":"","redirect":{"to":0,"itemId":"","redirect":false},"screening":0,"answerGroup":0,"customAnswer":false,"customParams":""},{"text":"Go further too","picture":"","redirect":{"to":0,"itemId":"","redirect":false},"screening":0,"answerGroup":0,"customAnswer":false,"customParams":""},{"text":"Screen me out","picture":"","redirect":{"to":0,"itemId":"","redirect":false},"screening":1,"answerGroup":0,"customAnswer":false,"customParams":""}],"picture":"","shuffle":0,"category":3,"targetId":0,"targetName":"","maxIntValue":0,"minIntValue":0,"customParams":"","mayBeSkipped":false,"maxAnswersNumber":1,"minAnswersNumber":1},{"id":"1f098950-bce5-49d9-bb34-98d3d8f3923a","text":"Select 1-2 answers","answers":[{"text":"1","picture":"","redirect":{"to":0,"itemId":"","redirect":false},"screening":0,"answerGroup":0,"customAnswer":false,"customParams":""},{"text":"2","picture":"","redirect":{"to":0,"itemId":"","redirect":false},"screening":0,"answerGroup":0,"customAnswer":false,"customParams":""},{"text":"3","picture":"","redirect":{"to":0,"itemId":"","redirect":false},"screening":0,"answerGroup":0,"customAnswer":false,"customParams":""},{"text":"4","picture":"","redirect":{"to":0,"itemId":"","redirect":false},"screening":0,"answerGroup":0,"customAnswer":false,"customParams":""}],"picture":"","shuffle":0,"category":2,"targetId":0,"targetName":"","maxIntValue":0,"minIntValue":0,"customParams":"","mayBeSkipped":false,"maxAnswersNumber":2,"minAnswersNumber":1},{"id":"8ecbf01d-c5e7-4a48-a986-c8c3d9e17dcf","text":"This is an open question, so enter your answer","answers":[],"picture":"","shuffle":0,"category":5,"targetId":0,"targetName":"","maxIntValue":0,"minIntValue":0,"customParams":"","mayBeSkipped":false,"maxAnswersNumber":0,"minAnswersNumber":0},{"id":"fb583148-b2a7-485a-91b6-f7f581cf7dc4","text":"Enter a number between 0 and 500","answers":[{"text":"0","picture":"","redirect":{"to":0,"itemId":"","redirect":false},"screening":0,"answerGroup":0,"customAnswer":false,"customParams":""},{"text":"500","picture":"","redirect":{"to":0,"itemId":"","redirect":false},"screening":0,"answerGroup":0,"customAnswer":false,"customParams":""}],"picture":"","shuffle":0,"category":6,"targetId":0,"targetName":"","maxIntValue":0,"minIntValue":0,"customParams":"","mayBeSkipped":false,"maxAnswersNumber":0,"minAnswersNumber":0},{"id":"34a4fce9-9785-4bfc-baed-ea4c0fc2de0b","text":"Surveys can contain images","answers":[{"text":"Other (please specify)","picture":"","redirect":{"to":0,"itemId":"","redirect":false},"screening":0,"answerGroup":0,"customAnswer":true,"customParams":""},{"text":" ","picture":"https://account.kykyshka.ru/api/v1/service/picture?pic=qETyhfUADX2BJG0Rmfr5ziII0KFAFYeD.png","redirect":{"to":0,"itemId":"","redirect":false},"screening":0,"answerGroup":0,"customAnswer":false,"customParams":""},{"text":" ","picture":"https://account.kykyshka.ru/api/v1/service/picture?pic=43jg3JU62WQUZDsLY1J2CYXnk0bBnDee.png","redirect":{"to":0,"itemId":"","redirect":false},"screening":0,"answerGroup":0,"customAnswer":false,"customParams":""}],"picture":"media/askgames_logo.svg","shuffle":0,"category":1,"targetId":0,"targetName":"","maxIntValue":0,"minIntValue":0,"customParams":"","mayBeSkipped":false,"maxAnswersNumber":0,"minAnswersNumber":0}],"callbackUrl":"","customParams":"{\"logo\":{\"enabled\":false,\"src\":\"media/askgames_logo.svg\"}}"}}]};
		var _testidobj={
			cta: [{"block":{"callbackUrl":"","customParams":"","id":"","nextBlock":"","questions":[{"answers":[{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Салями"},{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Ветчина"},{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Оливки"},{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Перец"},{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Томаты"},{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Анчоусы"},{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Грибы"},{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Лук"},{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Ананас"},{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Сыр"}],"category":2,"customParams":"{\"additionalData\":[\"sa\",\"vet\",\"oli\",\"per\",\"tom\",\"anc\",\"gri\",\"luk\",\"ans\",\"syr\"]}","id":"98f0dc23-8dc3-4008-afe5-5fbf5c0421f6","maxAnswersNumber":10,"maxIntValue":0,"mayBeSkipped":false,"minAnswersNumber":1,"minIntValue":0,"picture":"","shuffle":2,"targetId":0,"targetName":"","text":"Соберите пиццу своей мечты! Выберите ингредиенты:"},{"answers":[{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Маленькая (30 см)"},{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Средняя (35 см)"},{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Большая (40 см)"}],"category":1,"customParams":"{\"hideCross\":true,\"additionalData\":[\"small\",\"medium\",\"big\"]}","id":"a9cf3aab-1680-47f7-9d56-8b376f315e1f","maxAnswersNumber":0,"maxIntValue":0,"mayBeSkipped":false,"minAnswersNumber":0,"minIntValue":0,"picture":"","shuffle":0,"targetId":0,"targetName":"","text":"Выберите размер пиццы:"},{"answers":[{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Тартар"},{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Барбекю"},{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Кетчуп"},{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Сырный"},{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Чесночный"},{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Медовый"}],"category":2,"customParams":"","id":"fad272fa-d8b6-40a1-93dd-b2300700a48b","maxAnswersNumber":6,"maxIntValue":0,"mayBeSkipped":false,"minAnswersNumber":1,"minIntValue":0,"picture":"","shuffle":1,"targetId":0,"targetName":"","text":"Выберите соусы к пицце:"},{"answers":[{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Кола"},{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Дюшес"},{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Байкал"},{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Чай"},{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Кофе"},{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Молочный коктейль"},{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Вода"}],"category":1,"customParams":"","id":"7540e369-b352-4695-8adc-97ffe61458ed","maxAnswersNumber":0,"maxIntValue":0,"mayBeSkipped":false,"minAnswersNumber":0,"minIntValue":0,"picture":"","shuffle":1,"targetId":0,"targetName":"","text":"Выберите напиток к пицце:"},{"answers":[{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Додо"},{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Domino's"},{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Папа Джонс"}],"category":1,"customParams":"{\"hideCross\":true,\"quiz\":{\"enabled\":true,\"answerData\":[{\"correct\":true,\"text\":\"Верно! Ведь только сейчас Додо Пицца раздаёт промокоды за прохождение опроса!\",\"percentage\":64},{\"correct\":false,\"text\":\"Не угадали! Ведь только сейчас Додо Пицца раздаёт промокоды за прохождение опроса!\",\"percentage\":17},{\"correct\":false,\"text\":\"Не угадали! Ведь только сейчас Додо Пицца раздаёт промокоды за прохождение опроса!\",\"percentage\":19}]}}","id":"4dc21373-21c9-42cd-839c-93caefe7fc3d","maxAnswersNumber":0,"maxIntValue":0,"mayBeSkipped":false,"minAnswersNumber":0,"minIntValue":0,"picture":"","shuffle":1,"targetId":0,"targetName":"","text":"Угадаете, где вы сможете выгоднее всего заказать пиццу мечты?"},{"answers":[{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"Спасибо!"}],"category":1,"customParams":"{\"cantGoBack\":true,\"privacy\":{\"text\":\"Реклама. ООО \\\"Название\\\", ИНН 123456789123\"},\"oldSingleSelect\":true,\"promoScratch\":{\"enabled\":true,\"code\":[\"ПИРОЖОК\",\"НАБОР РОЛЛОВ\",\"САЛАТ\"]}}","id":"bb98dd20-0b6c-4563-9c85-08fb95a51c77","maxAnswersNumber":0,"maxIntValue":0,"mayBeSkipped":false,"minAnswersNumber":0,"minIntValue":0,"picture":"","shuffle":0,"targetId":0,"targetName":"","text":"Сотрите защитный слой и узнайте, какой бесплатный сюрприз вас ждёт в Додо Пицце при первом заказе!"},{"answers":[{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"0"},{"answerGroup":0,"customAnswer":false,"customParams":"","picture":"","redirect":{"itemId":"","redirect":false,"to":0},"screening":0,"text":"1"}],"category":6,"customParams":"{\"hideCross\":true,\"privacy\":{\"text\":\"Реклама. ООО \\\"Название\\\", ИНН 123456789123\"},\"cantGoBack\":true,\"ctaLink\":{\"enabled\":true,\"track\":true,\"link\":\"https://black-snowflake.org/quiz_mockup/release/ctaExample.html\",\"queryParams\":{\"ing\":\"${q_0}\",\"size\":\"${q_a9cf3aab-1680-47f7-9d56-8b376f315e1f}\",\"sauce\":\"${q_2}\",\"drink\":\"${q_3}\",\"bonus\":\"${q_add_5}\",\"customvar\":\"${var_test}\",\"utm_source\":\"kyky\"},\"text\":\"Заказать пиццу мечты!\",\"skipText\":\"Неинтересно\",\"skipTime\":4,\"icon\":\"pizza\",\"iconAlign\":\"left\"},\"picture\":\"https://cdn.kykyshka.ru/images/dodo/7.jpg\"}","id":"3b111546-cae2-4fdb-85c5-d8fd4fcde402","maxAnswersNumber":0,"maxIntValue":1,"mayBeSkipped":false,"minAnswersNumber":0,"minIntValue":0,"picture":"","shuffle":0,"targetId":0,"targetName":"","text":"Спасибо за ваши ответы! Дарим скидку на заказ вашей мечты!"}],"type":1}}]
		}
		var _testarr=apiData.gid.indexOf("gamedemo_")==0 ? shuffle(_testidobj.hasOwnProperty(apiData.gid.slice(9)) ? _testidobj[apiData.gid.slice(9)] : _testobj[lang]) : shuffle(_testobj[lang]);
		handleTestQuiz(_testarr[0]);
		apiData.uid="";
		apiData.gid="";
		var _txt=shrt.cr("p");
		_txt.style.position="absolute";
		_txt.style.left="4vw";
		_txt.style.top="4vh";
		_txt.style.fontWeight=700;
		_txt.style.color="var(--col-text2)";
		_txt.innerHTML=texts[lang].test+("<br>"+urlParams.get("innerSurvey"))+(innerSurvey ? "<br>"+texts[lang].innerMode : "")+"<br>v"+version.current;
		document.body.appendChild(_txt);
	}
	else
	if (typeof urlParams.get("test")=="string")
	{
		callSDK('{"kykyshkaDebug":{"action":"grabBlock"}}');
		apiData.uid="";
		apiData.gid="";
		previewMode=true;
	}
	else
	if (typeof urlParams.get("data")=="string")
	{
		try {
			console.log((urlParams.get("data")));
			var res=JSON.parse(atou(urlParams.get("data")));
			apiData.uid="";
			apiData.gid="";
			handleQuizObj(res);
			quizData.timerData={startTime: "0",token:""};
		}
		catch(e){
			console.log(e);
			callSDK('{"surveyMaster":{"event":"onSurveyUnavailable","data":{}}}');
		};
	}
	else
	if (apiData.uid.toString()!="" && apiData.gid.toString()!="")
	{
		var _getBody={user_id:apiData.uid.toString(),app_key:apiData.gid.toString()};
		if (innerSurvey)
			_getBody.inner_survey=1;
		request(apiData.endpoint+"survey/get","POST",{body:_getBody}).then(res=>{
			console.log(res);
			handleQuizObj(res);
		})
		.catch(e=>{
			console.log(e);
			callSDK('{"surveyMaster":{"event":"onSurveyUnavailable","data":{}}}');
		});
	}
	else
		callSDK('{"surveyMaster":{"event":"onLoadFail","data":{}}}');
}

function linkAppend(link,params,hash,sep,enc) {
	if (!hash) hash="";
	if (!sep) sep=",";
	if (typeof enc=="undefined") enc=true;
	var url=new URL(link);
	var keys=Object.keys(params);
	var _kykyId=false;
	for (var i in keys) {
		url.searchParams.set(keys[i],handleURLParam(params[keys[i]],sep,enc));
	}
	if (_kykyId==false)
		url.searchParams.set("kyky_token",quizData.hasOwnProperty("timerData") ? (quizData.timerData.token ? quizData.timerData.token : md5(apiData.uid+Date.now())) : md5(apiData.uid+Date.now()));
	if (hash && hash.length>0)
		url.hash=handleURLParam(hash);
	return url.href;
}

function handleURLParam(param,sep,enc) {
	if (!sep) sep=",";
	if (typeof enc=="undefined") enc=true;
	var _val="";
	switch(param)
	{
		case "${block_id}": _val=quizData.id; break;
		case "${fill_token}": _kykyId=true; _val=quizData.hasOwnProperty("timerData") ? quizData.timerData.token : ""; break;
		case "${user_id}": _val=apiData.uid; break;
		
		default: _val=param; break;
	}
	if (/\${q_.+}/g.test(param))
		_val=getUserAnswer(param.slice(4,param.length-1),sep);
	if (/\${var_.+}/g.test(param))
		_val=customVars.hasOwnProperty(param.slice(6,param.length-1)) ? customVars[param.slice(6,param.length-1)] : "";
	if (/\${q_add_.+}/g.test(param))
	{
		var _num=(/^\d+$/.test(param.slice(8,param.length-1))) ? Math.min(Math.max(parseInt(param.replace(/\D/g,'')),-1),quizData.questions.length-1) : questionNumById(param.slice(8,param.length-1)); 
		if (typeof quizData.questions[_num].customParams=="object")
			if (quizData.questions[_num].customParams.additionalData)
				_val=quizData.questions[_num].customParams.additionalData.join(",");
		
	}
	_val=enc ? encodeURIComponent(_val) : _val;
	return _val;
}

function applyExternalRedirectRules()
{
	if (quizData.rules.length==0)
	{
		quizData.rules.push({question_id:quizIndex,list_of_rules:[],redirect_default:{question_id:-2,block_id:""},custom_vars_default:[]})
	}
	else
	{
		var i;
		for (i=0; i<quizData.rules.length; i++)
		{
			if (quizData.rules[i].question_id==quizIndex || quizData.rules[i].question_id==quizData.questions[quizIndex].id)
			{
				quizData.rules[i].list_of_rules=[];
				quizData.rules[i].redirect_default={question_id:-2,block_id:""};
			}
		}
	}
}

function createCtaLink(obj){
	var _link=shrt.cr("a");
	if (typeof obj.queryParams!="object")
		obj.queryParams={};
	if (obj.externalContinue)
	{
		var _dt={
			a: answers,
			u: apiData.uid,
			g: apiData.gid,
			s: quizData.surveyKey,
			t: quizData.timerData,
			i: quizIndex,
			c: touchArr
		}
		obj.queryParams.d=utoa(JSON.stringify(_dt));
		obj.track=false;
	}
	if (typeof obj.encodeQuery=="undefined")
		obj.encodeQuery=true;
	obj.link=linkAppend(obj.link,obj.queryParams,obj.hash || "",obj.querySeparator || ",",obj.encodeQuery);
	_link.dataset.href=obj.link;
	_link.target="_blank";
	_link.innerHTML="<span>"+HtmlSanitizer.SanitizeHtml(obj.text)+"</span>";
	_link.id="ctaLink";
	_link.classList.add("answersBut");
	if (obj.hasOwnProperty("animation"))
	{
		var _anims={
			jump: "cta_jump .4s infinite alternate",
			float: "cta_float 6s ease-in-out infinite",
			pulse: "cta_pulse 0.4s ease infinite alternate",
			wiggle: "cta_wiggle 1s ease infinite",
			perspective: "cta_perspective 2s infinite linear",
			perspective2: "cta_perspective2 2s infinite linear"
		}
		_link.style.animation=obj.animation=="none" ? "none" : (obj.animation=="random" ? _anims[shuffle(Object.keys(_anims))[0]] : (_anims.hasOwnProperty(obj.animation) ? _anims[obj.animation] : _anims.none));
		if (typeof _anims[obj.animation]=="undefined")
			_link.style.boxShadow="inset 2px 4px 4px rgba(0,0,0,0.2)";
		if (obj.animation.indexOf("perspective")==0)
			shrt.id("multiSelectArea").style.perspective="400px";
		if (obj.glint)
		{
			var _glint=shrt.cr("div");
			_glint.className="ctaGlint";
			_link.appendChild(_glint);
		}
	}
	if (obj.hasOwnProperty("border"))
		if (obj.border==false)
			_link.style.border="none";
	if (obj.hasOwnProperty("shadow"))
		if (obj.shadow==false)
			_link.style.boxShadow="none";
	if (obj.icon)
	{
		if (icons.hasOwnProperty(obj.icon))
		{
			var _ic=document.createElementNS("http://www.w3.org/2000/svg","svg");
			_ic.setAttribute("viewBox","0 0 512 512");
			_ic.innerHTML=icons[obj.icon];
			obj.iconAlign=obj.iconAlign || "left";
			if (obj.iconAlign=="left")
			{
				_ic.style.paddingRight="0.5em";
				_link.prepend(_ic);
			}
			else
			{
				_ic.style.paddingLeft="0.5em";
				_link.appendChild(_ic);
			}
		}
	}
	if (obj.hideCross)
		shrt.id("surveyClose").style.display="none";
	var _finalLink=_link.dataset.href;
	if (!obj.hasOwnProperty("track"))
		obj.track=true;
	if (obj.track)
	{
		var _url=new URL(apiData.redirectEndpoint);
		_url.searchParams.set("to",obj.link);
		_url.searchParams.set("from",quizData.id);
		_url.searchParams.set("token",quizData.hasOwnProperty("timerData") ? (quizData.timerData.token ? quizData.timerData.token : md5(apiData.uid+Date.now())) : md5(apiData.uid+Date.now()));
		_url.searchParams.set("app_id",apiData.gid || "");
		_finalLink=_url.href;
	}
	if (obj.isTest)
		_link.dataset.test="true";
	else
	if (!isWebView)
		_link.href=_finalLink;
	_link.dataset.href=_finalLink;
	if (obj.externalContinue)
		_link.dataset.nosend="1";
	_link.onclick=function(){
		/*if (isWebView) window.open(this.dataset.href,"_blank");*/
		if (this.dataset.nosend=="1")
		{
			if (previewMode)
				applyExternalRedirectRules();
			dontSendAnswers=true;
			try{shrt.id("contBut").innerHTML=texts[lang].next;}catch(e){}
		}
		if (!(this.dataset.test=="true"))
			callSDK({customData:{name:"ctaLinkClicked",data:{link:this.dataset.href}}});
		else
		{
			setAnswer([0]);
			nextQuestion();
		}
	}
	return _link;
}

function getUserAnswer(qid,sep) {
	if (!sep)
		sep=", ";
  var _recFrom=-1;
  var _ansStr="";
  if (/^\d+$/.test(qid))
	  qid=parseInt(qid);
  if (typeof qid=="string")
  {
	  _recFrom=questionNumById(qid)
  }
  else
  if (typeof qid=="number")
	  _recFrom=Math.min(Math.max(qid,-1),quizData.questions.length-1);
  if (_recFrom>-1)
  {
	  var _trgAns=answers[_recFrom];
	  if (_trgAns.hasOwnProperty("array_of_strings"))
		  _ansStr=_trgAns.array_of_strings.array.join(sep);
	  if (_trgAns.hasOwnProperty("array_of_uints"))
	  {
		  var _uints=[];
		  var _closedCats=[0,1,2,3];
		  if (_closedCats.indexOf(quizData.questions[_recFrom].category)>-1)
		  {
			for (var i=0; i<_trgAns.array_of_uints.array.length; i++)
				_uints.push(quizData.questions[_recFrom].answers[_trgAns.array_of_uints.array[i]].customAnswer==true ? answers[_recFrom].array_of_uints.own_answer : quizData.questions[_recFrom].answers[_trgAns.array_of_uints.array[i]].text)
		  }
		  else
			  _uints=_trgAns.array_of_uints.array;
		  _ansStr=_uints.join(sep);
		  
	  }
  }
  return _ansStr;
}

function handleQuizObj(res)
{
	if (res.hasOwnProperty("block"))
	{
		quizData=res.block;
		if (res.hasOwnProperty("surveyKey"))
			quizData.surveyKey=res.surveyKey;
		if (hasExternalData && quizData.surveyKey!=externalData.s)
		{
			console.log("no external data");
			callSDK('{"surveyMaster":{"event":"onSurveyUnavailable","data":{}}}');
		}
		else
		{
			var _test_allowedKeys=[]; //"dfc533c0-67b6-48d1-a43c-06b0f0f2b681"
			if (_test_allowedKeys.length>0 && (_test_allowedKeys.indexOf(quizData.surveyKey)==-1 || _test_allowedKeys[0]=="all"))
			{
				apiData.uid="";
				apiData.gid="";
				console.log("survey key whitelist on SDK level active; current survey key not whitelisted");
				var _resp={surveyMaster:{event:"onSurveyUnavailable",data:{reason:"SURVEY_NOT_WHITELISTED"}}};
				if (currentBlock>0)
					closeTimer();
				else
					callSDK(JSON.stringify(_resp));
			}
			else
			{
				if (currentBlock>0)
				{
					getSurveyTime();
				}
				else
					callSDK('{"surveyMaster":{"event":"onSurveyAvailable","data":{}}}');
				startSurvey();
			}
		}
	}
	else
	{
		if (currentBlock>0)
			closeTimer();
		else
		{
			console.log("no block property in obj passed to handleQuizObj");
			callSDK('{"surveyMaster":{"event":"onSurveyUnavailable","data":{}}}');
		}
	}
}

function getSurveyTime(){
	if (apiData.gid!="")
	{
		if (hasExternalData)
			quizData.timerData=externalData.t;
		else
		{
			request(apiData.endpoint+"survey/start","POST",{body:{user_id:apiData.uid.toString(),app_key:apiData.gid.toString(),survey_key:quizData.surveyKey}}).then(res=>{
				quizData.timerData=res;
				if (hasReward)
					request(apiData.rewEndpoint+"?f=a&u="+apiData.uid+"&t="+quizData.timerData.token+"&s="+quizData.id,"GET",{})
			})
			.catch(e=>{
			quizData.timerData={startTime: "0",token:""};
			});
		}
	}
}

window.addEventListener("message",(event) => {
	if (event.data=="getTime")
		getSurveyTime();
	else
	if (event.data.hasOwnProperty("kykyshkaDebug"))
	{console.log(event.data);
		if (event.data.kykyshkaDebug.directSurvey)
		{
			handleQuizObj(event.data.kykyshkaDebug);
		}
		else
		if (event.data.theme)
		{
			tempTheme=event.data.theme;
			grabbedTheme=true;
		}
		else
		if (event.data.texts)
		{
			var _keys=Object.keys(event.data.texts);
			for (var i=0; i<_keys.length; i++)
				texts.ru[_keys[i]]=event.data.texts[_keys[i]];
			grabbedTexts=true;
		}
		if (event.data.reward)
		{
			tempReward=event.data.reward;
			grabbedReward=true;
		}
		else
		if (event.data.resetTimer)
			startQuizTimer(shrt.id("quizTimer"));
		else
		if (Object.keys(event.data.kykyshkaDebug).length>0)
			handleTestQuiz(event.data.kykyshkaDebug);
	}
}, false);

function handleTestQuiz(obj)
{
	try {
		handleQuizObj(obj);
		quizData.timerData={startTime: "0",token:""};
	}catch(e){console.log(e);callSDK('{"surveyMaster":{"event":"onLoadFail","data":{}}}');}
}

function showBackBut(hide)
{
	shrt.id("backBut").style.display=hide ? "flex" : "none";
}

function breakQuizArray(arr)
{
	var res=[]
	var i=0, mtr=[], j;
	/*for (i=0; i<arr.length; i++)
		if (arr[i].hasOwnProperty("customParams") && typeof arr[i].customParams=="object" && arr[i].customParams.hasOwnProperty("matrix"))
			arr[i].matrix=arr[i].customParams.matrix;*/
	i=0;
	do {
		if (arr[i].hasOwnProperty("matrix") && arr[i].matrix.isMatrix) {
	j=0;
	mtr=[];
	do {
		mtr.push(arr[i+j]);
	  j++; //console.log(i+" "+arr[i].matrix.matrixId+" "+j+" "+arr[i+j].matrix.matrixId);
	} while(i+j<arr.length && arr[i+j].hasOwnProperty("matrix") && arr[i+j].matrix.hasOwnProperty("isMatrix") && arr[i+j].matrix.isMatrix && arr[i+j].matrix.matrixId==arr[i+j-1].matrix.matrixId);
	i+=j;
	res.push(mtr);
	}
	else{
		res.push([arr[i]]);
	  i++;
	}
	}
	while (i<arr.length);
	return res;
}

function minsToTime(val,max)
{
	var _minsInDay=60*24;
	var _minStep=(_minsInDay/(parseInt(max)+1));
	var _h=(val*_minStep)/60;
	var _hh=Math.floor(_h);
	var _mm=Math.floor(val*_minStep%60);
	return (_hh<10 ? "0"+_hh.toString() : _hh)+":"+(_mm<10 ? "0"+_mm.toString() : _mm);
}

function scratchCard_init()
{
	var _card=document.createElement("canvas");
	var _ww=850;
	var _hh=580;
	_card.id="scratchCard";
	_card.width=_ww;
	_card.height=_hh;
	_card.dataset.isdrag="false";
	var _ctx=_card.getContext("2d"),
	c1="#a7a7a7",c2="#9a9a9a",stripes=10;
for (var i=0;i<stripes*2;i++){
  var thickness = _ww / stripes;
  _ctx.beginPath();
  _ctx.strokeStyle = i % 2?c1:c2;
  _ctx.lineWidth =thickness;
  _ctx.lineCap = 'round';
  
   _ctx.moveTo(i*thickness + thickness/2 - _hh,0);
  _ctx.lineTo(0 + i*thickness+thickness/2,_hh);
  _ctx.stroke();
}
	var _cardSmall=document.createElement("canvas");
	_cardSmall.id="cardSmall";
	_cardSmall.width=_card.width/10;
	_cardSmall.height=_card.height/10
	_cardSmall.style.display="none";
	document.body.appendChild(_cardSmall);
	_card.addEventListener('mousedown', function(event) {
		_card.dataset.isdrag = true;

		scratchCard_clear(event.offsetX, event.offsetY);
		scratchCard_get_cleared();
	  }, false);

	  _card.addEventListener('mousemove', function(event) {
		if (_card.dataset.isdrag=="false") {
		  return;
		}

		scratchCard_clear(event.offsetX, event.offsetY);
		scratchCard_get_cleared();
	  }, false);

	  _card.addEventListener('mouseup', function(event) {
		_card.dataset.isdrag = false;
	  }, false);

	  _card.addEventListener('mouseleave', function(event) {
		_card.dataset.isdrag = false;
	  }, false);

	  _card.addEventListener('touchstart', function(event) {
		if (event.targetTouches.length !== 1) {
		  return;
		}

		event.preventDefault();

		_card.dataset.isdrag = true;

		scratchCard_clear(event.touches[0].pageX-event.touches[0].target.offsetLeft, event.touches[0].pageY-event.touches[0].target.offsetTop);
		scratchCard_get_cleared();
	  }, false);

	  _card.addEventListener('touchmove', function(event) {
		if (_card.dataset.isdrag=="false" || event.targetTouches.length !== 1) {
		  return;
		}

		event.preventDefault();

		scratchCard_clear(event.touches[0].pageX-event.touches[0].target.offsetLeft, event.touches[0].pageY-event.touches[0].target.offsetTop);
		scratchCard_get_cleared();
	  }, false);

	  _card.addEventListener('touchend', function(event) {
		_card.dataset.isdrag = false;
	  }, false);
	  return _card;
}

function scratchCard_clear(x,y)
{
	var _card=shrt.id("scratchCard");
	var _ctx=_card.getContext("2d");
	_ctx.globalCompositeOperation="destination-out";
	_ctx.beginPath();
	_ctx.arc(x*(_card.width/_card.clientWidth),y*(_card.height/_card.clientHeight),20*(_card.height/_card.clientHeight),0,Math.PI*2,false);
	_ctx.fill();
}

function scratchCard_get_cleared()
{
	shrt.q(".scratchPointer").style.display="none";
	var _card=shrt.id("scratchCard");
	var _ctx=_card.getContext("2d");
	var _cardSmall=shrt.id("cardSmall");
	var _ctxSmall=shrt.id("cardSmall").getContext("2d");
	//_ctxSmall.scale(0.1,0.1);
	_ctxSmall.clearRect(0,0,_cardSmall.width,_cardSmall.height);
	_ctxSmall.drawImage(_card,0,0,_cardSmall.width,_cardSmall.height);
	var _imgData=_ctxSmall.getImageData(0,0,_cardSmall.width,_cardSmall.height),
	pixels=_imgData.data,
	result={},
	i,len;
    for (i = 3, len = pixels.length; i < len; i += 4) {
      result[pixels[i]] || (result[pixels[i]] = 0);
      result[pixels[i]]++;
    }
	var _res=result["0"]/(result["0"]+result["255"]);
	if (_res>=parseInt(shrt.q(".questionPic").dataset.threshold)/100)
	{
		if (_card.style.display!="none") //ios fix
		{
			if (quizData.questions[quizIndex].customParams.promoScratch.copyOnClick)
				shrt.id("qText").innerHTML+='<br><br><span id="tapToCopy">'+texts[lang].tapToCopy+'</span>';
		}
		_card.style.display="none";
		if (shrt.q(".answersBut[data-threshold=true]"))
		shrt.q(".answersBut[data-threshold=true]").dataset.clickable=true;
	}
}

function scratchCard_resize() {
	try{
		shrt.id("scratchCard").style.width=shrt.q(".questionPic").clientWidth;
		shrt.id("scratchCard").style.height=shrt.q(".questionPic").clientHeight;
		shrt.q(".scratchPointer").style.top=shrt.id("scratchCard").offsetTop+shrt.id("scratchCard").offsetHeight/2+"px";
		shrt.q(".scratchPointer").style.width=shrt.q(".questionPic").clientWidth*0.2;
	}catch(e){};
}

function doubleSlider_init() {
	var rangeMin = 1;
	var range = shrt.q(".range-selected");
	var rangeInput = shrt.qAll(".range-input input");
	var rangePrice = shrt.qAll(".range-price input");
	var _ds_inited=false;
	

	rangeInput.forEach((input) => {
	  input.addEventListener("input", (e) => {
		var minRange = parseInt(rangeInput[0].value);
		var maxRange = parseInt(rangeInput[1].value);
		if (maxRange - minRange < rangeMin) {
		  if (e.target.className === "min") {
			rangeInput[0].value = maxRange - rangeMin;
			
		  } else {
			rangeInput[1].value = minRange + rangeMin;
		  }
		} else {
		  rangePrice[0].value = minRange;
		  rangePrice[1].value = maxRange;
		  range.style.left = (minRange / rangeInput[0].max) * 100 + "%";
		  range.style.right = 100 - (maxRange / rangeInput[1].max) * 100 + "%";
		}
		shrt.id("textArea").value=rangePrice[0].value+";"+rangePrice[1].value;
		shrt.id("spanMin").innerHTML=(shrt.id("sliderCont").dataset.isTime=="true" ? minsToTime(rangePrice[0].value,parseInt(shrt.id("sliderCont").dataset.max)) : rangePrice[0].value);
		shrt.id("spanMax").innerHTML=(shrt.id("sliderCont").dataset.isTime=="true" ? minsToTime(rangePrice[1].value,parseInt(shrt.id("sliderCont").dataset.max)) : rangePrice[1].value);
		if (_ds_inited) shrt.id("textArea").dispatchEvent(new Event('input', {bubbles:true}));
	  });
	});

	rangePrice.forEach((input) => {
	  input.addEventListener("input", (e) => {
		var minPrice = rangePrice[0].value;
		var maxPrice = rangePrice[1].value;
		if (e.target.name=="min")
		{
			if (e.target.value=="")
				e.target.value=rangeInput[0].min;
			if (parseInt(e.target.value)<parseInt(rangeInput[0].min))
				e.target.value=rangeInput[0].min;
			if (parseInt(e.target.value)>parseInt(rangeInput[1].value))
				e.target.value=rangeInput[1].value;
		}
		else
		{
			if (e.target.value=="")
				e.target.value=rangeInput[1].max;
			if (parseInt(e.target.value)<parseInt(rangeInput[0].value))
				e.target.value=rangeInput[0].value;
			if (parseInt(e.target.value)>parseInt(rangeInput[1].max))
				e.target.value=rangeInput[1].max;
		}
		if (maxPrice - minPrice >= rangeMin && maxPrice <= parseInt(rangeInput[1].max)) 
		{
		  if (e.target.name === "min") {
			rangeInput[0].value = minPrice;
			range.style.left = (minPrice / rangeInput[0].max) * 100 + "%";
		  } else {
			rangeInput[1].value = maxPrice;
			range.style.right = 100 - (maxPrice / rangeInput[1].max) * 100 + "%";
		  }
		}
		shrt.id("textArea").value=rangePrice[0].value+";"+rangePrice[1].value;
		shrt.id("spanMin").innerHTML=(shrt.id("sliderCont").dataset.isTime=="true" ? minsToTime(rangePrice[0].value,parseInt(shrt.id("sliderCont").dataset.max)) : rangePrice[0].value);
		shrt.id("spanMax").innerHTML=(shrt.id("sliderCont").dataset.isTime=="true" ? minsToTime(rangePrice[1].value,parseInt(shrt.id("sliderCont").dataset.max)) : rangePrice[1].value);
		if (_ds_inited) shrt.id("textArea").dispatchEvent(new Event('input', {bubbles:true}));
	  });
	});
	rangeInput.forEach((input) => {
	  input.dispatchEvent(new Event("input",{bubbles:true}));
	});
	_ds_inited=true;
}

var wheelOfFortune = {
    sectors: [{
            color: '--col-but1',
            label: '❌'
        }, {
            color: '--col-but2',
            label: '🎁'
        }, {
            color: '--col-but1',
            label: '❌'
        }, {
            color: '--col-but2',
            label: '🎁'
        }, {
            color: '--col-but1',
            label: '❌'
        }, {
            color: '--col-but2',
            label: '🎁'
        }
    ],
	defaultLabels: {
		good: ['🎁'],
		bad: ['❌']
	},
	lastIndex: -1,
    html: function(toappend){
		var _div=shrt.cr("div");
		_div.id="wheelOfFortune";
		_div.style.width=wheelOfFortune.dia;
		_div.style.height=wheelOfFortune.dia;
		toappend.appendChild(_div);
		var _cnv=shrt.cr("canvas");
		_cnv.id="wheel";
		_cnv.width=wheelOfFortune.dia;
		_cnv.height=wheelOfFortune.dia;
		_cnv.style.width=wheelOfFortune.dia;
		_cnv.style.height=wheelOfFortune.dia;
		_div.appendChild(_cnv);
		var _spin=shrt.cr("div");
		_spin.id="spin";
		_spin.classList.add("spinInit");
		_div.appendChild(_spin);
		var _txt=shrt.cr("span");
		_txt.id="wheelTxt";
		_txt.innerHTML='👆';//texts[lang].spin;
		_spin.appendChild(_txt);
		wheelOfFortune.init();
		wheelOfFortune.resize();
	},
    rand: function (m, M) {
        return Math.random() * (M - m) + m;
    },
    tot: 6,
    dia: 600,
    rad: 300,
    PI: Math.PI,
    TAU: 2 * Math.PI,
    arc: 2 * Math.PI / 7,
	colors:["--col-but1","--col-but2"],
	textColors:["--col-text1","--col-but1"],

    friction: 0.991,
    angVel: 0,
    ang: 0,
	target: 0,
	time: 0,
	timeTarget: 0,
	frameNumber: 0,
	previousTime: 0,
	stopped: false,

    getIndex: function () {
        return Math.floor(wheelOfFortune.tot - (wheelOfFortune.ang / wheelOfFortune.TAU) * wheelOfFortune.tot) % wheelOfFortune.tot;
    },

    drawSector: function (sector, i) {
        try {
			var _r=document.querySelector(":root");
			var _rs=getComputedStyle(_r);
            var ang = wheelOfFortune.arc * i;
            var ctx = shrt.id("wheel").getContext("2d");
            ctx.save()
            ctx.beginPath()
            ctx.fillStyle = _rs.getPropertyValue(wheelOfFortune.colors[i%2]) || "#FFFFFF";
                ctx.moveTo(wheelOfFortune.rad, wheelOfFortune.rad)
                ctx.arc(wheelOfFortune.rad, wheelOfFortune.rad, wheelOfFortune.rad, ang, ang + wheelOfFortune.arc)
                ctx.lineTo(wheelOfFortune.rad, wheelOfFortune.rad)
                ctx.fill()
                ctx.translate(wheelOfFortune.rad, wheelOfFortune.rad)
                ctx.rotate(ang + wheelOfFortune.arc / 2 )
                ctx.textAlign = 'right'
                ctx.fillStyle = _rs.getPropertyValue(wheelOfFortune.textColors[i%2]) || "#FFFFFF";
                ctx.font = 'bold 70px sans-serif'
                ctx.fillText(sector.label, wheelOfFortune.rad - 30, 10)
                ctx.restore()
        } catch (e) {console.log(e);}
    },
	
	spinBounce: function() {
		try {
			var _el=shrt.id("spin");
			_el.style.animation="none";
			_el.offsetHeight;
			_el.style.animation=null;
		}catch(e){}
	},

    rotate: function() {
		if (!wheelOfFortune.stopped)
		{
			try {
				var sector = wheelOfFortune.sectors[wheelOfFortune.getIndex()]
					var spinEl = shrt.id("spin");
				var ctx = shrt.id("wheel").getContext("2d");
				ctx.canvas.style.transform = `rotate(${wheelOfFortune.ang - wheelOfFortune.PI / 2}rad)`
				spinEl.querySelector("span").textContent = !(wheelOfFortune.angVel) ? '👆'/*texts[lang].spin*/ : sector.label;
				if (wheelOfFortune.lastIndex!=wheelOfFortune.getIndex())
					wheelOfFortune.spinBounce();
				wheelOfFortune.lastIndex=wheelOfFortune.getIndex();
			} catch (e) {console.log(e);}
		}
    },

    frame: function (curTime) {
			++wheelOfFortune.frameNumber;
			curTime*=0.001;
			var delta=curTime-wheelOfFortune.previousTime;
			wheelOfFortune.previousTime=curTime;
			if (wheelOfFortune.time>=wheelOfFortune.timeTarget || !(shrt.id("spin")) || !(shrt.id("spin").dataset.clicked))
				return;
            wheelOfFortune.time+=delta;
            if (wheelOfFortune.time >= wheelOfFortune.timeTarget)
			{
                wheelOfFortune.time=wheelOfFortune.timeTarget;
				wheelOfFortune.onStop();
			}
                    wheelOfFortune.ang = easeOutExpo(wheelOfFortune.time/wheelOfFortune.timeTarget,0,wheelOfFortune.target,1);
                    wheelOfFortune.ang %= wheelOfFortune.TAU;
                    wheelOfFortune.rotate()
    },

    engine: function (curTime) {
        wheelOfFortune.frame(curTime);
        requestAnimationFrame(wheelOfFortune.engine)
    },
	
	resize: function() {
		if (shrt.id("wheelOfFortune"))
		{
			var _sz=Math.min(shrt.id("multiSelectArea").clientWidth*0.9,shrt.id("multiSelectArea").clientHeight);
			var _scl=(_sz/wheelOfFortune.dia);
			shrt.id("wheelOfFortune").style.transform="translate(-50%, -50%) scale("+_scl+")";
			shrt.id("wheelOfFortune").style["-webkit-transform"]="translate(-0.5, -0.5) scale("+_scl+")";
		}
	},
	
	onStop: function() {
		wheelOfFortune.stopped=true;
		wheelOfFortune.time=0;
		wheelOfFortune.timeTarget=0;
		var _win=shrt.cr("div");
		_win.id="wofResultCont";
		_win.classList.add("fadeInFast");
		var _wh=shrt.id("wheelOfFortune");
		_wh.appendChild(_win);
		var _bg=shrt.cr("div");
		_bg.id="wofResultBg";
		_win.appendChild(_bg);
		var _txt=shrt.cr("p");
		_txt.id="wofResultText";
		var _q=quizData.questions[quizIndex];
		_txt.innerHTML=(_q.customParams.wheelOfFortune.hasOwnProperty("yourGiftText") ? _q.customParams.wheelOfFortune.yourGiftText : texts[lang].yourgift)+"<br><span id='prizeImg'></span>"+(_q.customParams.hideAnswersText ? "" : "<br>"+_q.answers[_q.customParams.wheelOfFortune.num].text);
		_win.appendChild(_txt);
		if (images.hasOwnProperty(quizIndex+"_"+_q.customParams.wheelOfFortune.num))
		{
			shrt.id("prizeImg").appendChild(images[quizIndex+"_"+_q.customParams.wheelOfFortune.num]);
			shrt.id("prizeImg").firstChild.classList.add("scale-up-center");
			shrt.id("prizeImg").firstChild.style.maxWidth="75%";
		}
		shrt.id("answersBut"+_q.customParams.wheelOfFortune.num).click();
	},

    init: function () {
        try {
			wheelOfFortune.ang=0;
			wheelOfFortune.angVel=0;
			wheelOfFortune.frameNumber=0;
			wheelOfFortune.lastIndex=-1;
			//wheelOfFortune.previousTime=0;
			var _cp=quizData.questions[quizIndex].customParams.wheelOfFortune || {};
			for (var i=0; i<wheelOfFortune.tot; i++)
				wheelOfFortune.sectors[i].label=(i%2==1) ? ((_cp.hasOwnProperty("goodLabels") && _cp.goodLabels.length>0) ? _cp.goodLabels[getRandomInt(0,_cp.goodLabels.length-1)] : wheelOfFortune.defaultLabels.good[getRandomInt(0,wheelOfFortune.defaultLabels.good.length-1)]) : ((_cp.hasOwnProperty("badLabels") && _cp.badLabels.length>0) ? _cp.badLabels[getRandomInt(0,_cp.badLabels.length-1)] : wheelOfFortune.defaultLabels.bad[getRandomInt(0,wheelOfFortune.defaultLabels.bad.length-1)]);
			wheelOfFortune.stopped=false;
			wheelOfFortune.tot=wheelOfFortune.sectors.length;
            wheelOfFortune.arc = wheelOfFortune.TAU / wheelOfFortune.sectors.length;
            wheelOfFortune.sectors.forEach(wheelOfFortune.drawSector);
			var _turns=getRandomInt(1,2);
			var _turnsDef=_cp.turns || {};
			if (!_turnsDef.hasOwnProperty("min"))
				_turnsDef.min=_turns;
			if (!_turnsDef.hasOwnProperty("max"))
				_turnsDef.max=_turns;
			wheelOfFortune.target=Math.PI/1.5*getRandomInt(1,3)+Math.PI/6+Math.PI*2*getRandomInt(Math.min(_turnsDef.min,_turnsDef.max),Math.max(_turnsDef.min,_turnsDef.max))+Math.PI/6*getRandomInt(-9,9)/10;
			wheelOfFortune.time=0;
			var _spd=getRandomInt(4,5);
			var _spdDef=_cp.speed || {};
			if (!_spdDef.hasOwnProperty("min"))
				_spdDef.min=_spd;
			if (!_spdDef.hasOwnProperty("max"))
				_spdDef.max=_spd;
			wheelOfFortune.timeTarget=getRandomInt(Math.min(_spdDef.min,_spdDef.max),Math.max(_spdDef.min,_spdDef.max));
            wheelOfFortune.rotate();
            wheelOfFortune.engine();
            var spinEl = shrt.id("spin");
            shrt.id("wheelOfFortune").addEventListener('click', () => {
                if (!wheelOfFortune.angVel && !(spinEl.dataset.clicked))
				{
					spinEl.dataset.clicked=true;
					spinEl.classList.remove("spinInit");
                    wheelOfFortune.angVel = wheelOfFortune.rand(0.25, 0.45);
				}
            })
        } catch (e) {console.log(e);}
    }

}

var panzoom=null;
var _zoomInt=null;
function onZoomedImg()
{
	if (shrt.qAll("#zoomedCont").length==0)
	{
		var _cont=shrt.cr("div");
		_cont.id="zoomedCont";
		document.body.appendChild(_cont);
		/*if (is_iOS())
			_cont.classList.add("scale-up-center-opacity");*/
		var _cont2=shrt.cr("div");
		_cont.appendChild(_cont2);
		var _contImg=shrt.cr("img");
		_contImg.src=shrt.q("#questionPicDiv > .questionPic").src;
		_cont2.appendChild(_contImg);
		panzoom=Panzoom(_cont2, {});
		_cont2.addEventListener("wheel",function(e){
			panzoom.zoomWithWheel(e);
		});
		_cont2.addEventListener("panzoomend",function(e){
			if (e.detail.scale<1)
				panzoom.reset();
		});
		//if (is_iOS()==false)
		panzoom.zoom(0.2);
		setTimeout(function(){panzoom.zoom(1,{animate:true})},10);
		shrt.id("surveyClose").classList.add("zoomCross");
	}
}

function detectDoubleTapClosure() {
  let lastTap = 0;
  let timeout;
  return function detectDoubleTap(event) {
    const curTime = new Date().getTime();
    const tapLen = curTime - lastTap;
	if (event.touches.length<=1)
	{
		if (tapLen < 500 && tapLen > 0) {
		  //onDoubleTap(event);
		  event.preventDefault();
		} else {
		  timeout = setTimeout(() => {
			clearTimeout(timeout);
		  }, 500);
		}
		lastTap = curTime;
	}
  };
}

if (isMobile){
    document.body.addEventListener('touchend', detectDoubleTapClosure(), { passive: false });
}

function onDoubleTap(e){
	try {
		if (e.target==shrt.q("#zoomedCont > div > img"))
		{
			if (panzoom.getScale()>1)
				panzoom.zoomOut();
			else
				panzoom.zoomIn();
		}
	}catch(err){}
}


function iconFix(){
try{var _bb=shrt.q(".questionPic").getBoundingClientRect(); var _trg=shrt.id("zoomIcon");_trg.style.left=_bb.x+_bb.width-32+"px"; _trg.style.top=_bb.y+_bb.height-32+"px";}catch(e){}	
}

function getRandomInt(min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

function easeOutExpo (t, b, c, d) {
    return (t == d) ? b + c : c * (-Math.pow(2, -10 * t / d) + 1) + b;
}

function getAnimationList(){
	try{
    var ss = document.styleSheets;
    var anims = [];
    for (var s = 0; s < ss.length; s++) {
        if (ss[s].cssRules) {
            for (var r = ss[s].cssRules.length - 1; r >= 0; r--) {
                var rule = ss[s].cssRules[r];
                if ((rule.type === window.CSSRule.KEYFRAMES_RULE || rule.type === window.CSSRule.WEBKIT_KEYFRAMES_RULE)) {
                    anims.push(rule.name);
                }
            }
        }
    }
    return anims;
	}catch(e){return [];}
}

function addInterval(name,func,duration)
{
	if (intervals.hasOwnProperty(name))
		clearInterval(intervals[name]);
	intervals[name]=setInterval(func,duration);
}

function deleteInterval(name)
{
	if (intervals.hasOwnProperty(name))
	{
		clearInterval(intervals[name]);
		delete intervals[name];
	}
}

function is_iOS() {
  return [
    'iPad Simulator',
    'iPhone Simulator',
    'iPod Simulator',
    'iPad',
    'iPhone',
    'iPod'
  ].includes(navigator.platform)
  || (navigator.userAgent.includes("Mac") && "ontouchend" in document)
}

window.addEventListener("click",(e)=>{
	touchArr.push({x:Math.round(event.clientX/window.innerWidth*100)/100,y:Math.round(event.clientY/window.innerHeight*100)/100});
	touchArr=touchArr.slice(0,100);
	//console.log(JSON.stringify(touchArr[touchArr.length-1]));
},false);

function request(url, method, options, nostringify) {
	return new Promise((resolve, reject) => {
		const xhr = new XMLHttpRequest();
		let contentTypeIsSet = false;
		options = options || {};
		xhr.open(method, url);
		for (let header in options.headers) {
			if ({}.hasOwnProperty.call(options.headers, header)) {
				header = header.toLowerCase();
				contentTypeIsSet = header === 'content-type' ? true : contentTypeIsSet;
				xhr.setRequestHeader(header, options.headers[header]);
			}
		}
		if (!contentTypeIsSet) {
			xhr.setRequestHeader('Content-type', 'application/json');
		}
		xhr.onload = function() {
			if (xhr.status >= 200 && xhr.status < 300) {
				let response;
				try {
					response = JSON.parse(xhr.response);
				} catch (e) {
					response = xhr.response;
				}
				resolve(response);
			} else {
				reject({
					status: xhr.status,
					statusText: xhr.statusText,
				});
			}
		};
		xhr.send(nostringify ? options.body : JSON.stringify(options.body));
	});
}

function atou(b64) {
  return decodeURIComponent(escape(atob(b64)));
}

function utoa(data) {
  return btoa(unescape(encodeURIComponent(data)));
}

function logoColor(color)
{
		color=hexToRgb(color)
			if (color.length!=3)
					return "none";
		color=new Color(color[0],color[1],color[2]);
		var solver=new Solver(color);
		return "brightness(0) saturate(100%) "+solver.solve().filter;
}

function array_move(arr, old_index, new_index) {
    if (new_index >= arr.length) {
        var k = new_index - arr.length + 1;
        while (k--) {
            arr.push(undefined);
        }
    }
    arr.splice(new_index, 0, arr.splice(old_index, 1)[0]);
    return arr; // for testing
};

class Color{constructor(r,g,b){this.set(r,g,b);}
toString(){return`rgb(${Math.round(this.r)}, ${Math.round(this.g)}, ${Math.round(this.b)})`;}
set(r,g,b){this.r=this.clamp(r);this.g=this.clamp(g);this.b=this.clamp(b);}
hueRotate(angle=0){angle=angle/180*Math.PI;const sin=Math.sin(angle);const cos=Math.cos(angle);this.multiply([0.213+cos*0.787-sin*0.213,0.715-cos*0.715-sin*0.715,0.072-cos*0.072+sin*0.928,0.213-cos*0.213+sin*0.143,0.715+cos*0.285+sin*0.140,0.072-cos*0.072-sin*0.283,0.213-cos*0.213-sin*0.787,0.715-cos*0.715+sin*0.715,0.072+cos*0.928+sin*0.072,]);}
grayscale(value=1){this.multiply([0.2126+0.7874*(1-value),0.7152-0.7152*(1-value),0.0722-0.0722*(1-value),0.2126-0.2126*(1-value),0.7152+0.2848*(1-value),0.0722-0.0722*(1-value),0.2126-0.2126*(1-value),0.7152-0.7152*(1-value),0.0722+0.9278*(1-value),]);}
sepia(value=1){this.multiply([0.393+0.607*(1-value),0.769-0.769*(1-value),0.189-0.189*(1-value),0.349-0.349*(1-value),0.686+0.314*(1-value),0.168-0.168*(1-value),0.272-0.272*(1-value),0.534-0.534*(1-value),0.131+0.869*(1-value),]);}
saturate(value=1){this.multiply([0.213+0.787*value,0.715-0.715*value,0.072-0.072*value,0.213-0.213*value,0.715+0.285*value,0.072-0.072*value,0.213-0.213*value,0.715-0.715*value,0.072+0.928*value,]);}
multiply(matrix){const newR=this.clamp(this.r*matrix[0]+this.g*matrix[1]+this.b*matrix[2]);const newG=this.clamp(this.r*matrix[3]+this.g*matrix[4]+this.b*matrix[5]);const newB=this.clamp(this.r*matrix[6]+this.g*matrix[7]+this.b*matrix[8]);this.r=newR;this.g=newG;this.b=newB;}
brightness(value=1){this.linear(value);}
contrast(value=1){this.linear(value,-(0.5*value)+0.5);}
linear(slope=1,intercept=0){this.r=this.clamp(this.r*slope+intercept*255);this.g=this.clamp(this.g*slope+intercept*255);this.b=this.clamp(this.b*slope+intercept*255);}
invert(value=1){this.r=this.clamp((value+this.r/255*(1-2*value))*255);this.g=this.clamp((value+this.g/255*(1-2*value))*255);this.b=this.clamp((value+this.b/255*(1-2*value))*255);}
hsl(){const r=this.r/255;const g=this.g/255;const b=this.b/255;const max=Math.max(r,g,b);const min=Math.min(r,g,b);let h,s,l=(max+min)/2;if(max===min){h=s=0;}else{const d=max-min;s=l>0.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}
h/=6;}
return{h:h*100,s:s*100,l:l*100,};}
clamp(value){if(value>255){value=255;}else if(value<0){value=0;}
return value;}}
class Solver{constructor(target,baseColor){this.target=target;this.targetHSL=target.hsl();this.reusedColor=new Color(0,0,0);}
solve(){const result=this.solveNarrow(this.solveWide());return{values:result.values,loss:result.loss,filter:this.css(result.values),};}
solveWide(){const A=5;const c=15;const a=[60,180,18000,600,1.2,1.2];let best={loss:Infinity};for(let i=0;best.loss>25&&i<3;i++){const initial=[50,20,3750,50,100,100];const result=this.spsa(A,a,c,initial,1000);if(result.loss<best.loss){best=result;}}
return best;}
solveNarrow(wide){const A=wide.loss;const c=2;const A1=A+1;const a=[0.25*A1,0.25*A1,A1,0.25*A1,0.2*A1,0.2*A1];return this.spsa(A,a,c,wide.values,500);}
spsa(A,a,c,values,iters){const alpha=1;const gamma=0.16666666666666666;let best=null;let bestLoss=Infinity;const deltas=new Array(6);const highArgs=new Array(6);const lowArgs=new Array(6);for(let k=0;k<iters;k++){const ck=c/Math.pow(k+1,gamma);for(let i=0;i<6;i++){deltas[i]=Math.random()>0.5?1:-1;highArgs[i]=values[i]+ck*deltas[i];lowArgs[i]=values[i]-ck*deltas[i];}
const lossDiff=this.loss(highArgs)-this.loss(lowArgs);for(let i=0;i<6;i++){const g=lossDiff/(2*ck)*deltas[i];const ak=a[i]/Math.pow(A+k+1,alpha);values[i]=fix(values[i]-ak*g,i);}
const loss=this.loss(values);if(loss<bestLoss){best=values.slice(0);bestLoss=loss;}}
return{values:best,loss:bestLoss};function fix(value,idx){let max=100;if(idx===2){max=7500;}else if(idx===4||idx===5){max=200;}
if(idx===3){if(value>max){value%=max;}else if(value<0){value=max+value%max;}}else if(value<0){value=0;}else if(value>max){value=max;}
return value;}}
loss(filters){const color=this.reusedColor;color.set(0,0,0);color.invert(filters[0]/100);color.sepia(filters[1]/100);color.saturate(filters[2]/100);color.hueRotate(filters[3]*3.6);color.brightness(filters[4]/100);color.contrast(filters[5]/100);const colorHSL=color.hsl();return(Math.abs(color.r-this.target.r)+
Math.abs(color.g-this.target.g)+
Math.abs(color.b-this.target.b)+
Math.abs(colorHSL.h-this.targetHSL.h)+
Math.abs(colorHSL.s-this.targetHSL.s)+
Math.abs(colorHSL.l-this.targetHSL.l));}
css(filters){function fmt(idx,multiplier=1){return Math.round(filters[idx]*multiplier);}
return`invert(${fmt(0)}%) sepia(${fmt(1)}%) saturate(${fmt(2)}%) hue-rotate(${fmt(3, 3.6)}deg) brightness(${fmt(4)}%) contrast(${fmt(5)}%)`;}}
function hexToRgb(hex){const shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;hex=hex.replace(shorthandRegex,(m,r,g,b)=>{return r+r+g+g+b+b;});const result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?[parseInt(result[1],16),parseInt(result[2],16),parseInt(result[3],16),]:null;}
/*! Sortable 1.15.0 - MIT | git://github.com/SortableJS/Sortable.git */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Sortable=e()}(this,function(){"use strict";function e(e,t){var n,o=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,n)),o}function M(o){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?e(Object(i),!0).forEach(function(t){var e,n;e=o,t=i[n=t],n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach(function(t){Object.defineProperty(o,t,Object.getOwnPropertyDescriptor(i,t))})}return o}function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(){return(a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n,o=arguments[e];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t}).apply(this,arguments)}function i(t,e){if(null==t)return{};var n,o=function(t,e){if(null==t)return{};for(var n,o={},i=Object.keys(t),r=0;r<i.length;r++)n=i[r],0<=e.indexOf(n)||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols)for(var i=Object.getOwnPropertySymbols(t),r=0;r<i.length;r++)n=i[r],0<=e.indexOf(n)||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n]);return o}function r(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function t(t){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(t)}var y=t(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),w=t(/Edge/i),s=t(/firefox/i),u=t(/safari/i)&&!t(/chrome/i)&&!t(/android/i),n=t(/iP(ad|od|hone)/i),c=t(/chrome/i)&&t(/android/i),d={capture:!1,passive:!1};function h(t,e,n){t.addEventListener(e,n,!y&&d)}function f(t,e,n){t.removeEventListener(e,n,!y&&d)}function p(t,e){if(e&&(">"===e[0]&&(e=e.substring(1)),t))try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch(t){return}}function N(t,e,n,o){if(t){n=n||document;do{if(null!=e&&(">"!==e[0]||t.parentNode===n)&&p(t,e)||o&&t===n)return t}while(t!==n&&(t=(i=t).host&&i!==document&&i.host.nodeType?i.host:i.parentNode))}var i;return null}var g,m=/\s+/g;function I(t,e,n){var o;t&&e&&(t.classList?t.classList[n?"add":"remove"](e):(o=(" "+t.className+" ").replace(m," ").replace(" "+e+" "," "),t.className=(o+(n?" "+e:"")).replace(m," ")))}function P(t,e,n){var o=t&&t.style;if(o){if(void 0===n)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(n=t.currentStyle),void 0===e?n:n[e];o[e=!(e in o||-1!==e.indexOf("webkit"))?"-webkit-"+e:e]=n+("string"==typeof n?"":"px")}}function v(t,e){var n="";if("string"==typeof t)n=t;else do{var o=P(t,"transform")}while(o&&"none"!==o&&(n=o+" "+n),!e&&(t=t.parentNode));var i=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return i&&new i(n)}function b(t,e,n){if(t){var o=t.getElementsByTagName(e),i=0,r=o.length;if(n)for(;i<r;i++)n(o[i],i);return o}return[]}function O(){var t=document.scrollingElement;return t||document.documentElement}function k(t,e,n,o,i){if(t.getBoundingClientRect||t===window){var r,a,l,s,c,u,d=t!==window&&t.parentNode&&t!==O()?(a=(r=t.getBoundingClientRect()).top,l=r.left,s=r.bottom,c=r.right,u=r.height,r.width):(l=a=0,s=window.innerHeight,c=window.innerWidth,u=window.innerHeight,window.innerWidth);if((e||n)&&t!==window&&(i=i||t.parentNode,!y))do{if(i&&i.getBoundingClientRect&&("none"!==P(i,"transform")||n&&"static"!==P(i,"position"))){var h=i.getBoundingClientRect();a-=h.top+parseInt(P(i,"border-top-width")),l-=h.left+parseInt(P(i,"border-left-width")),s=a+r.height,c=l+r.width;break}}while(i=i.parentNode);return o&&t!==window&&(o=(e=v(i||t))&&e.a,t=e&&e.d,e&&(s=(a/=t)+(u/=t),c=(l/=o)+(d/=o))),{top:a,left:l,bottom:s,right:c,width:d,height:u}}}function R(t,e,n){for(var o=A(t,!0),i=k(t)[e];o;){var r=k(o)[n];if(!("top"===n||"left"===n?r<=i:i<=r))return o;if(o===O())break;o=A(o,!1)}return!1}function X(t,e,n,o){for(var i=0,r=0,a=t.children;r<a.length;){if("none"!==a[r].style.display&&a[r]!==Bt.ghost&&(o||a[r]!==Bt.dragged)&&N(a[r],n.draggable,t,!1)){if(i===e)return a[r];i++}r++}return null}function Y(t,e){for(var n=t.lastElementChild;n&&(n===Bt.ghost||"none"===P(n,"display")||e&&!p(n,e));)n=n.previousElementSibling;return n||null}function B(t,e){var n=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)"TEMPLATE"===t.nodeName.toUpperCase()||t===Bt.clone||e&&!p(t,e)||n++;return n}function E(t){var e=0,n=0,o=O();if(t)do{var i=v(t),r=i.a,i=i.d}while(e+=t.scrollLeft*r,n+=t.scrollTop*i,t!==o&&(t=t.parentNode));return[e,n]}function A(t,e){if(!t||!t.getBoundingClientRect)return O();var n=t,o=!1;do{if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){var i=P(n);if(n.clientWidth<n.scrollWidth&&("auto"==i.overflowX||"scroll"==i.overflowX)||n.clientHeight<n.scrollHeight&&("auto"==i.overflowY||"scroll"==i.overflowY)){if(!n.getBoundingClientRect||n===document.body)return O();if(o||e)return n;o=!0}}}while(n=n.parentNode);return O()}function D(t,e){return Math.round(t.top)===Math.round(e.top)&&Math.round(t.left)===Math.round(e.left)&&Math.round(t.height)===Math.round(e.height)&&Math.round(t.width)===Math.round(e.width)}function S(e,n){return function(){var t;g||(1===(t=arguments).length?e.call(this,t[0]):e.apply(this,t),g=setTimeout(function(){g=void 0},n))}}function F(t,e,n){t.scrollLeft+=e,t.scrollTop+=n}function _(t){var e=window.Polymer,n=window.jQuery||window.Zepto;return e&&e.dom?e.dom(t).cloneNode(!0):n?n(t).clone(!0)[0]:t.cloneNode(!0)}function C(t,e){P(t,"position","absolute"),P(t,"top",e.top),P(t,"left",e.left),P(t,"width",e.width),P(t,"height",e.height)}function T(t){P(t,"position",""),P(t,"top",""),P(t,"left",""),P(t,"width",""),P(t,"height","")}var j="Sortable"+(new Date).getTime();function x(){var e,o=[];return{captureAnimationState:function(){o=[],this.options.animation&&[].slice.call(this.el.children).forEach(function(t){var e,n;"none"!==P(t,"display")&&t!==Bt.ghost&&(o.push({target:t,rect:k(t)}),e=M({},o[o.length-1].rect),!t.thisAnimationDuration||(n=v(t,!0))&&(e.top-=n.f,e.left-=n.e),t.fromRect=e)})},addAnimationState:function(t){o.push(t)},removeAnimationState:function(t){o.splice(function(t,e){for(var n in t)if(t.hasOwnProperty(n))for(var o in e)if(e.hasOwnProperty(o)&&e[o]===t[n][o])return Number(n);return-1}(o,{target:t}),1)},animateAll:function(t){var c=this;if(!this.options.animation)return clearTimeout(e),void("function"==typeof t&&t());var u=!1,d=0;o.forEach(function(t){var e=0,n=t.target,o=n.fromRect,i=k(n),r=n.prevFromRect,a=n.prevToRect,l=t.rect,s=v(n,!0);s&&(i.top-=s.f,i.left-=s.e),n.toRect=i,n.thisAnimationDuration&&D(r,i)&&!D(o,i)&&(l.top-i.top)/(l.left-i.left)==(o.top-i.top)/(o.left-i.left)&&(t=l,s=r,r=a,a=c.options,e=Math.sqrt(Math.pow(s.top-t.top,2)+Math.pow(s.left-t.left,2))/Math.sqrt(Math.pow(s.top-r.top,2)+Math.pow(s.left-r.left,2))*a.animation),D(i,o)||(n.prevFromRect=o,n.prevToRect=i,e=e||c.options.animation,c.animate(n,l,i,e)),e&&(u=!0,d=Math.max(d,e),clearTimeout(n.animationResetTimer),n.animationResetTimer=setTimeout(function(){n.animationTime=0,n.prevFromRect=null,n.fromRect=null,n.prevToRect=null,n.thisAnimationDuration=null},e),n.thisAnimationDuration=e)}),clearTimeout(e),u?e=setTimeout(function(){"function"==typeof t&&t()},d):"function"==typeof t&&t(),o=[]},animate:function(t,e,n,o){var i,r;o&&(P(t,"transition",""),P(t,"transform",""),i=(r=v(this.el))&&r.a,r=r&&r.d,i=(e.left-n.left)/(i||1),r=(e.top-n.top)/(r||1),t.animatingX=!!i,t.animatingY=!!r,P(t,"transform","translate3d("+i+"px,"+r+"px,0)"),this.forRepaintDummy=t.offsetWidth,P(t,"transition","transform "+o+"ms"+(this.options.easing?" "+this.options.easing:"")),P(t,"transform","translate3d(0,0,0)"),"number"==typeof t.animated&&clearTimeout(t.animated),t.animated=setTimeout(function(){P(t,"transition",""),P(t,"transform",""),t.animated=!1,t.animatingX=!1,t.animatingY=!1},o))}}}var H=[],L={initializeByDefault:!0},K={mount:function(e){for(var t in L)!L.hasOwnProperty(t)||t in e||(e[t]=L[t]);H.forEach(function(t){if(t.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),H.push(e)},pluginEvent:function(e,n,o){var t=this;this.eventCanceled=!1,o.cancel=function(){t.eventCanceled=!0};var i=e+"Global";H.forEach(function(t){n[t.pluginName]&&(n[t.pluginName][i]&&n[t.pluginName][i](M({sortable:n},o)),n.options[t.pluginName]&&n[t.pluginName][e]&&n[t.pluginName][e](M({sortable:n},o)))})},initializePlugins:function(n,o,i,t){for(var e in H.forEach(function(t){var e=t.pluginName;(n.options[e]||t.initializeByDefault)&&((t=new t(n,o,n.options)).sortable=n,t.options=n.options,n[e]=t,a(i,t.defaults))}),n.options){var r;n.options.hasOwnProperty(e)&&(void 0!==(r=this.modifyOption(n,e,n.options[e]))&&(n.options[e]=r))}},getEventProperties:function(e,n){var o={};return H.forEach(function(t){"function"==typeof t.eventProperties&&a(o,t.eventProperties.call(n[t.pluginName],e))}),o},modifyOption:function(e,n,o){var i;return H.forEach(function(t){e[t.pluginName]&&t.optionListeners&&"function"==typeof t.optionListeners[n]&&(i=t.optionListeners[n].call(e[t.pluginName],o))}),i}};function W(t){var e=t.sortable,n=t.rootEl,o=t.name,i=t.targetEl,r=t.cloneEl,a=t.toEl,l=t.fromEl,s=t.oldIndex,c=t.newIndex,u=t.oldDraggableIndex,d=t.newDraggableIndex,h=t.originalEvent,f=t.putSortable,p=t.extraEventProperties;if(e=e||n&&n[j]){var g,m=e.options,t="on"+o.charAt(0).toUpperCase()+o.substr(1);!window.CustomEvent||y||w?(g=document.createEvent("Event")).initEvent(o,!0,!0):g=new CustomEvent(o,{bubbles:!0,cancelable:!0}),g.to=a||n,g.from=l||n,g.item=i||n,g.clone=r,g.oldIndex=s,g.newIndex=c,g.oldDraggableIndex=u,g.newDraggableIndex=d,g.originalEvent=h,g.pullMode=f?f.lastPutMode:void 0;var v,b=M(M({},p),K.getEventProperties(o,e));for(v in b)g[v]=b[v];n&&n.dispatchEvent(g),m[t]&&m[t].call(e,g)}}function z(t,e){var n=(o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}).evt,o=i(o,G);K.pluginEvent.bind(Bt)(t,e,M({dragEl:q,parentEl:V,ghostEl:Z,rootEl:$,nextEl:Q,lastDownEl:J,cloneEl:tt,cloneHidden:et,dragStarted:pt,putSortable:lt,activeSortable:Bt.active,originalEvent:n,oldIndex:nt,oldDraggableIndex:it,newIndex:ot,newDraggableIndex:rt,hideGhostForTarget:kt,unhideGhostForTarget:Rt,cloneNowHidden:function(){et=!0},cloneNowShown:function(){et=!1},dispatchSortableEvent:function(t){U({sortable:e,name:t,originalEvent:n})}},o))}var G=["evt"];function U(t){W(M({putSortable:lt,cloneEl:tt,targetEl:q,rootEl:$,oldIndex:nt,oldDraggableIndex:it,newIndex:ot,newDraggableIndex:rt},t))}var q,V,Z,$,Q,J,tt,et,nt,ot,it,rt,at,lt,st,ct,ut,dt,ht,ft,pt,gt,mt,vt,bt,yt=!1,wt=!1,Et=[],Dt=!1,St=!1,_t=[],Ct=!1,Tt=[],xt="undefined"!=typeof document,Ot=n,At=w||y?"cssFloat":"float",Mt=xt&&!c&&!n&&"draggable"in document.createElement("div"),Nt=function(){if(xt){if(y)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto","auto"===t.style.pointerEvents}}(),It=function(t,e){var n=P(t),o=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),i=X(t,0,e),r=X(t,1,e),a=i&&P(i),l=r&&P(r),s=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+k(i).width,t=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+k(r).width;if("flex"===n.display)return"column"===n.flexDirection||"column-reverse"===n.flexDirection?"vertical":"horizontal";if("grid"===n.display)return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(i&&a.float&&"none"!==a.float){e="left"===a.float?"left":"right";return!r||"both"!==l.clear&&l.clear!==e?"horizontal":"vertical"}return i&&("block"===a.display||"flex"===a.display||"table"===a.display||"grid"===a.display||o<=s&&"none"===n[At]||r&&"none"===n[At]&&o<s+t)?"vertical":"horizontal"},Pt=function(t){function l(r,a){return function(t,e,n,o){var i=t.options.group.name&&e.options.group.name&&t.options.group.name===e.options.group.name;if(null==r&&(a||i))return!0;if(null==r||!1===r)return!1;if(a&&"clone"===r)return r;if("function"==typeof r)return l(r(t,e,n,o),a)(t,e,n,o);e=(a?t:e).options.group.name;return!0===r||"string"==typeof r&&r===e||r.join&&-1<r.indexOf(e)}}var e={},n=t.group;n&&"object"==o(n)||(n={name:n}),e.name=n.name,e.checkPull=l(n.pull,!0),e.checkPut=l(n.put),e.revertClone=n.revertClone,t.group=e},kt=function(){!Nt&&Z&&P(Z,"display","none")},Rt=function(){!Nt&&Z&&P(Z,"display","")};xt&&!c&&document.addEventListener("click",function(t){if(wt)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),wt=!1},!0);function Xt(t){if(q){t=t.touches?t.touches[0]:t;var e=(i=t.clientX,r=t.clientY,Et.some(function(t){var e=t[j].options.emptyInsertThreshold;if(e&&!Y(t)){var n=k(t),o=i>=n.left-e&&i<=n.right+e,e=r>=n.top-e&&r<=n.bottom+e;return o&&e?a=t:void 0}}),a);if(e){var n,o={};for(n in t)t.hasOwnProperty(n)&&(o[n]=t[n]);o.target=o.rootEl=e,o.preventDefault=void 0,o.stopPropagation=void 0,e[j]._onDragOver(o)}}var i,r,a}function Yt(t){q&&q.parentNode[j]._isOutsideThisEl(t.target)}function Bt(t,e){if(!t||!t.nodeType||1!==t.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=e=a({},e),t[j]=this;var n,o,i={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return It(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(t,e){t.setData("Text",e.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==Bt.supportPointer&&"PointerEvent"in window&&!u,emptyInsertThreshold:5};for(n in K.initializePlugins(this,t,i),i)n in e||(e[n]=i[n]);for(o in Pt(e),this)"_"===o.charAt(0)&&"function"==typeof this[o]&&(this[o]=this[o].bind(this));this.nativeDraggable=!e.forceFallback&&Mt,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?h(t,"pointerdown",this._onTapStart):(h(t,"mousedown",this._onTapStart),h(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(h(t,"dragover",this),h(t,"dragenter",this)),Et.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),a(this,x())}function Ft(t,e,n,o,i,r,a,l){var s,c,u=t[j],d=u.options.onMove;return!window.CustomEvent||y||w?(s=document.createEvent("Event")).initEvent("move",!0,!0):s=new CustomEvent("move",{bubbles:!0,cancelable:!0}),s.to=e,s.from=t,s.dragged=n,s.draggedRect=o,s.related=i||e,s.relatedRect=r||k(e),s.willInsertAfter=l,s.originalEvent=a,t.dispatchEvent(s),c=d?d.call(u,s,a):c}function jt(t){t.draggable=!1}function Ht(){Ct=!1}function Lt(t){return setTimeout(t,0)}function Kt(t){return clearTimeout(t)}Bt.prototype={constructor:Bt,_isOutsideThisEl:function(t){this.el.contains(t)||t===this.el||(gt=null)},_getDirection:function(t,e){return"function"==typeof this.options.direction?this.options.direction.call(this,t,e,q):this.options.direction},_onTapStart:function(e){if(e.cancelable){var n=this,o=this.el,t=this.options,i=t.preventOnFilter,r=e.type,a=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,l=(a||e).target,s=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||l,c=t.filter;if(!function(t){Tt.length=0;var e=t.getElementsByTagName("input"),n=e.length;for(;n--;){var o=e[n];o.checked&&Tt.push(o)}}(o),!q&&!(/mousedown|pointerdown/.test(r)&&0!==e.button||t.disabled)&&!s.isContentEditable&&(this.nativeDraggable||!u||!l||"SELECT"!==l.tagName.toUpperCase())&&!((l=N(l,t.draggable,o,!1))&&l.animated||J===l)){if(nt=B(l),it=B(l,t.draggable),"function"==typeof c){if(c.call(this,e,l,this))return U({sortable:n,rootEl:s,name:"filter",targetEl:l,toEl:o,fromEl:o}),z("filter",n,{evt:e}),void(i&&e.cancelable&&e.preventDefault())}else if(c=c&&c.split(",").some(function(t){if(t=N(s,t.trim(),o,!1))return U({sortable:n,rootEl:t,name:"filter",targetEl:l,fromEl:o,toEl:o}),z("filter",n,{evt:e}),!0}))return void(i&&e.cancelable&&e.preventDefault());t.handle&&!N(s,t.handle,o,!1)||this._prepareDragStart(e,a,l)}}},_prepareDragStart:function(t,e,n){var o,i=this,r=i.el,a=i.options,l=r.ownerDocument;n&&!q&&n.parentNode===r&&(o=k(n),$=r,V=(q=n).parentNode,Q=q.nextSibling,J=n,at=a.group,st={target:Bt.dragged=q,clientX:(e||t).clientX,clientY:(e||t).clientY},ht=st.clientX-o.left,ft=st.clientY-o.top,this._lastX=(e||t).clientX,this._lastY=(e||t).clientY,q.style["will-change"]="all",o=function(){z("delayEnded",i,{evt:t}),Bt.eventCanceled?i._onDrop():(i._disableDelayedDragEvents(),!s&&i.nativeDraggable&&(q.draggable=!0),i._triggerDragStart(t,e),U({sortable:i,name:"choose",originalEvent:t}),I(q,a.chosenClass,!0))},a.ignore.split(",").forEach(function(t){b(q,t.trim(),jt)}),h(l,"dragover",Xt),h(l,"mousemove",Xt),h(l,"touchmove",Xt),h(l,"mouseup",i._onDrop),h(l,"touchend",i._onDrop),h(l,"touchcancel",i._onDrop),s&&this.nativeDraggable&&(this.options.touchStartThreshold=4,q.draggable=!0),z("delayStart",this,{evt:t}),!a.delay||a.delayOnTouchOnly&&!e||this.nativeDraggable&&(w||y)?o():Bt.eventCanceled?this._onDrop():(h(l,"mouseup",i._disableDelayedDrag),h(l,"touchend",i._disableDelayedDrag),h(l,"touchcancel",i._disableDelayedDrag),h(l,"mousemove",i._delayedDragTouchMoveHandler),h(l,"touchmove",i._delayedDragTouchMoveHandler),a.supportPointer&&h(l,"pointermove",i._delayedDragTouchMoveHandler),i._dragStartTimer=setTimeout(o,a.delay)))},_delayedDragTouchMoveHandler:function(t){t=t.touches?t.touches[0]:t;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){q&&jt(q),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var t=this.el.ownerDocument;f(t,"mouseup",this._disableDelayedDrag),f(t,"touchend",this._disableDelayedDrag),f(t,"touchcancel",this._disableDelayedDrag),f(t,"mousemove",this._delayedDragTouchMoveHandler),f(t,"touchmove",this._delayedDragTouchMoveHandler),f(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,e){e=e||"touch"==t.pointerType&&t,!this.nativeDraggable||e?this.options.supportPointer?h(document,"pointermove",this._onTouchMove):h(document,e?"touchmove":"mousemove",this._onTouchMove):(h(q,"dragend",this),h($,"dragstart",this._onDragStart));try{document.selection?Lt(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch(t){}},_dragStarted:function(t,e){var n;yt=!1,$&&q?(z("dragStarted",this,{evt:e}),this.nativeDraggable&&h(document,"dragover",Yt),n=this.options,t||I(q,n.dragClass,!1),I(q,n.ghostClass,!0),Bt.active=this,t&&this._appendGhost(),U({sortable:this,name:"start",originalEvent:e})):this._nulling()},_emulateDragOver:function(){if(ct){this._lastX=ct.clientX,this._lastY=ct.clientY,kt();for(var t=document.elementFromPoint(ct.clientX,ct.clientY),e=t;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint(ct.clientX,ct.clientY))!==e;)e=t;if(q.parentNode[j]._isOutsideThisEl(t),e)do{if(e[j])if(e[j]._onDragOver({clientX:ct.clientX,clientY:ct.clientY,target:t,rootEl:e})&&!this.options.dragoverBubble)break}while(e=(t=e).parentNode);Rt()}},_onTouchMove:function(t){if(st){var e=this.options,n=e.fallbackTolerance,o=e.fallbackOffset,i=t.touches?t.touches[0]:t,r=Z&&v(Z,!0),a=Z&&r&&r.a,l=Z&&r&&r.d,e=Ot&&bt&&E(bt),a=(i.clientX-st.clientX+o.x)/(a||1)+(e?e[0]-_t[0]:0)/(a||1),l=(i.clientY-st.clientY+o.y)/(l||1)+(e?e[1]-_t[1]:0)/(l||1);if(!Bt.active&&!yt){if(n&&Math.max(Math.abs(i.clientX-this._lastX),Math.abs(i.clientY-this._lastY))<n)return;this._onDragStart(t,!0)}Z&&(r?(r.e+=a-(ut||0),r.f+=l-(dt||0)):r={a:1,b:0,c:0,d:1,e:a,f:l},r="matrix(".concat(r.a,",").concat(r.b,",").concat(r.c,",").concat(r.d,",").concat(r.e,",").concat(r.f,")"),P(Z,"webkitTransform",r),P(Z,"mozTransform",r),P(Z,"msTransform",r),P(Z,"transform",r),ut=a,dt=l,ct=i),t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!Z){var t=this.options.fallbackOnBody?document.body:$,e=k(q,!0,Ot,!0,t),n=this.options;if(Ot){for(bt=t;"static"===P(bt,"position")&&"none"===P(bt,"transform")&&bt!==document;)bt=bt.parentNode;bt!==document.body&&bt!==document.documentElement?(bt===document&&(bt=O()),e.top+=bt.scrollTop,e.left+=bt.scrollLeft):bt=O(),_t=E(bt)}I(Z=q.cloneNode(!0),n.ghostClass,!1),I(Z,n.fallbackClass,!0),I(Z,n.dragClass,!0),P(Z,"transition",""),P(Z,"transform",""),P(Z,"box-sizing","border-box"),P(Z,"margin",0),P(Z,"top",e.top),P(Z,"left",e.left),P(Z,"width",e.width),P(Z,"height",e.height),P(Z,"opacity","0.8"),P(Z,"position",Ot?"absolute":"fixed"),P(Z,"zIndex","100000"),P(Z,"pointerEvents","none"),Bt.ghost=Z,t.appendChild(Z),P(Z,"transform-origin",ht/parseInt(Z.style.width)*100+"% "+ft/parseInt(Z.style.height)*100+"%")}},_onDragStart:function(t,e){var n=this,o=t.dataTransfer,i=n.options;z("dragStart",this,{evt:t}),Bt.eventCanceled?this._onDrop():(z("setupClone",this),Bt.eventCanceled||((tt=_(q)).removeAttribute("id"),tt.draggable=!1,tt.style["will-change"]="",this._hideClone(),I(tt,this.options.chosenClass,!1),Bt.clone=tt),n.cloneId=Lt(function(){z("clone",n),Bt.eventCanceled||(n.options.removeCloneOnHide||$.insertBefore(tt,q),n._hideClone(),U({sortable:n,name:"clone"}))}),e||I(q,i.dragClass,!0),e?(wt=!0,n._loopId=setInterval(n._emulateDragOver,50)):(f(document,"mouseup",n._onDrop),f(document,"touchend",n._onDrop),f(document,"touchcancel",n._onDrop),o&&(o.effectAllowed="move",i.setData&&i.setData.call(n,o,q)),h(document,"drop",n),P(q,"transform","translateZ(0)")),yt=!0,n._dragStartId=Lt(n._dragStarted.bind(n,e,t)),h(document,"selectstart",n),pt=!0,u&&P(document.body,"user-select","none"))},_onDragOver:function(n){var o,i,r,t,a=this.el,l=n.target,e=this.options,s=e.group,c=Bt.active,u=at===s,d=e.sort,h=lt||c,f=this,p=!1;if(!Ct){if(void 0!==n.preventDefault&&n.cancelable&&n.preventDefault(),l=N(l,e.draggable,a,!0),T("dragOver"),Bt.eventCanceled)return p;if(q.contains(n.target)||l.animated&&l.animatingX&&l.animatingY||f._ignoreWhileAnimating===l)return O(!1);if(wt=!1,c&&!e.disabled&&(u?d||(i=V!==$):lt===this||(this.lastPutMode=at.checkPull(this,c,q,n))&&s.checkPut(this,c,q,n))){if(r="vertical"===this._getDirection(n,l),o=k(q),T("dragOverValid"),Bt.eventCanceled)return p;if(i)return V=$,x(),this._hideClone(),T("revert"),Bt.eventCanceled||(Q?$.insertBefore(q,Q):$.appendChild(q)),O(!0);var g=Y(a,e.draggable);if(!g||function(t,e,n){n=k(Y(n.el,n.options.draggable));return e?t.clientX>n.right+10||t.clientX<=n.right&&t.clientY>n.bottom&&t.clientX>=n.left:t.clientX>n.right&&t.clientY>n.top||t.clientX<=n.right&&t.clientY>n.bottom+10}(n,r,this)&&!g.animated){if(g===q)return O(!1);if((l=g&&a===n.target?g:l)&&(w=k(l)),!1!==Ft($,a,q,o,l,w,n,!!l))return x(),g&&g.nextSibling?a.insertBefore(q,g.nextSibling):a.appendChild(q),V=a,A(),O(!0)}else if(g&&function(t,e,n){n=k(X(n.el,0,n.options,!0));return e?t.clientX<n.left-10||t.clientY<n.top&&t.clientX<n.right:t.clientY<n.top-10||t.clientY<n.bottom&&t.clientX<n.left}(n,r,this)){var m=X(a,0,e,!0);if(m===q)return O(!1);if(w=k(l=m),!1!==Ft($,a,q,o,l,w,n,!1))return x(),a.insertBefore(q,m),V=a,A(),O(!0)}else if(l.parentNode===a){var v,b,y,w=k(l),E=q.parentNode!==a,D=(D=q.animated&&q.toRect||o,C=l.animated&&l.toRect||w,S=(t=r)?D.left:D.top,s=t?D.right:D.bottom,g=t?D.width:D.height,m=t?C.left:C.top,D=t?C.right:C.bottom,C=t?C.width:C.height,!(S===m||s===D||S+g/2===m+C/2)),S=r?"top":"left",g=R(l,"top","top")||R(q,"top","top"),m=g?g.scrollTop:void 0;if(gt!==l&&(b=w[S],Dt=!1,St=!D&&e.invertSwap||E),0!==(v=function(t,e,n,o,i,r,a,l){var s=o?t.clientY:t.clientX,c=o?n.height:n.width,t=o?n.top:n.left,o=o?n.bottom:n.right,n=!1;if(!a)if(l&&vt<c*i){if(Dt=!Dt&&(1===mt?t+c*r/2<s:s<o-c*r/2)?!0:Dt)n=!0;else if(1===mt?s<t+vt:o-vt<s)return-mt}else if(t+c*(1-i)/2<s&&s<o-c*(1-i)/2)return function(t){return B(q)<B(t)?1:-1}(e);if((n=n||a)&&(s<t+c*r/2||o-c*r/2<s))return t+c/2<s?1:-1;return 0}(n,l,w,r,D?1:e.swapThreshold,null==e.invertedSwapThreshold?e.swapThreshold:e.invertedSwapThreshold,St,gt===l)))for(var _=B(q);(y=V.children[_-=v])&&("none"===P(y,"display")||y===Z););if(0===v||y===l)return O(!1);mt=v;var C=(gt=l).nextElementSibling,E=!1,D=Ft($,a,q,o,l,w,n,E=1===v);if(!1!==D)return 1!==D&&-1!==D||(E=1===D),Ct=!0,setTimeout(Ht,30),x(),E&&!C?a.appendChild(q):l.parentNode.insertBefore(q,E?C:l),g&&F(g,0,m-g.scrollTop),V=q.parentNode,void 0===b||St||(vt=Math.abs(b-k(l)[S])),A(),O(!0)}if(a.contains(q))return O(!1)}return!1}function T(t,e){z(t,f,M({evt:n,isOwner:u,axis:r?"vertical":"horizontal",revert:i,dragRect:o,targetRect:w,canSort:d,fromSortable:h,target:l,completed:O,onMove:function(t,e){return Ft($,a,q,o,t,k(t),n,e)},changed:A},e))}function x(){T("dragOverAnimationCapture"),f.captureAnimationState(),f!==h&&h.captureAnimationState()}function O(t){return T("dragOverCompleted",{insertion:t}),t&&(u?c._hideClone():c._showClone(f),f!==h&&(I(q,(lt||c).options.ghostClass,!1),I(q,e.ghostClass,!0)),lt!==f&&f!==Bt.active?lt=f:f===Bt.active&&lt&&(lt=null),h===f&&(f._ignoreWhileAnimating=l),f.animateAll(function(){T("dragOverAnimationComplete"),f._ignoreWhileAnimating=null}),f!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(l===q&&!q.animated||l===a&&!l.animated)&&(gt=null),e.dragoverBubble||n.rootEl||l===document||(q.parentNode[j]._isOutsideThisEl(n.target),t||Xt(n)),!e.dragoverBubble&&n.stopPropagation&&n.stopPropagation(),p=!0}function A(){ot=B(q),rt=B(q,e.draggable),U({sortable:f,name:"change",toEl:a,newIndex:ot,newDraggableIndex:rt,originalEvent:n})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){f(document,"mousemove",this._onTouchMove),f(document,"touchmove",this._onTouchMove),f(document,"pointermove",this._onTouchMove),f(document,"dragover",Xt),f(document,"mousemove",Xt),f(document,"touchmove",Xt)},_offUpEvents:function(){var t=this.el.ownerDocument;f(t,"mouseup",this._onDrop),f(t,"touchend",this._onDrop),f(t,"pointerup",this._onDrop),f(t,"touchcancel",this._onDrop),f(document,"selectstart",this)},_onDrop:function(t){var e=this.el,n=this.options;ot=B(q),rt=B(q,n.draggable),z("drop",this,{evt:t}),V=q&&q.parentNode,ot=B(q),rt=B(q,n.draggable),Bt.eventCanceled||(Dt=St=yt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Kt(this.cloneId),Kt(this._dragStartId),this.nativeDraggable&&(f(document,"drop",this),f(e,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),u&&P(document.body,"user-select",""),P(q,"transform",""),t&&(pt&&(t.cancelable&&t.preventDefault(),n.dropBubble||t.stopPropagation()),Z&&Z.parentNode&&Z.parentNode.removeChild(Z),($===V||lt&&"clone"!==lt.lastPutMode)&&tt&&tt.parentNode&&tt.parentNode.removeChild(tt),q&&(this.nativeDraggable&&f(q,"dragend",this),jt(q),q.style["will-change"]="",pt&&!yt&&I(q,(lt||this).options.ghostClass,!1),I(q,this.options.chosenClass,!1),U({sortable:this,name:"unchoose",toEl:V,newIndex:null,newDraggableIndex:null,originalEvent:t}),$!==V?(0<=ot&&(U({rootEl:V,name:"add",toEl:V,fromEl:$,originalEvent:t}),U({sortable:this,name:"remove",toEl:V,originalEvent:t}),U({rootEl:V,name:"sort",toEl:V,fromEl:$,originalEvent:t}),U({sortable:this,name:"sort",toEl:V,originalEvent:t})),lt&&lt.save()):ot!==nt&&0<=ot&&(U({sortable:this,name:"update",toEl:V,originalEvent:t}),U({sortable:this,name:"sort",toEl:V,originalEvent:t})),Bt.active&&(null!=ot&&-1!==ot||(ot=nt,rt=it),U({sortable:this,name:"end",toEl:V,originalEvent:t}),this.save())))),this._nulling()},_nulling:function(){z("nulling",this),$=q=V=Z=Q=tt=J=et=st=ct=pt=ot=rt=nt=it=gt=mt=lt=at=Bt.dragged=Bt.ghost=Bt.clone=Bt.active=null,Tt.forEach(function(t){t.checked=!0}),Tt.length=ut=dt=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":q&&(this._onDragOver(t),function(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move");t.cancelable&&t.preventDefault()}(t));break;case"selectstart":t.preventDefault()}},toArray:function(){for(var t,e=[],n=this.el.children,o=0,i=n.length,r=this.options;o<i;o++)N(t=n[o],r.draggable,this.el,!1)&&e.push(t.getAttribute(r.dataIdAttr)||function(t){var e=t.tagName+t.className+t.src+t.href+t.textContent,n=e.length,o=0;for(;n--;)o+=e.charCodeAt(n);return o.toString(36)}(t));return e},sort:function(t,e){var n={},o=this.el;this.toArray().forEach(function(t,e){e=o.children[e];N(e,this.options.draggable,o,!1)&&(n[t]=e)},this),e&&this.captureAnimationState(),t.forEach(function(t){n[t]&&(o.removeChild(n[t]),o.appendChild(n[t]))}),e&&this.animateAll()},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,e){return N(t,e||this.options.draggable,this.el,!1)},option:function(t,e){var n=this.options;if(void 0===e)return n[t];var o=K.modifyOption(this,t,e);n[t]=void 0!==o?o:e,"group"===t&&Pt(n)},destroy:function(){z("destroy",this);var t=this.el;t[j]=null,f(t,"mousedown",this._onTapStart),f(t,"touchstart",this._onTapStart),f(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(f(t,"dragover",this),f(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),Et.splice(Et.indexOf(this.el),1),this.el=t=null},_hideClone:function(){et||(z("hideClone",this),Bt.eventCanceled||(P(tt,"display","none"),this.options.removeCloneOnHide&&tt.parentNode&&tt.parentNode.removeChild(tt),et=!0))},_showClone:function(t){"clone"===t.lastPutMode?et&&(z("showClone",this),Bt.eventCanceled||(q.parentNode!=$||this.options.group.revertClone?Q?$.insertBefore(tt,Q):$.appendChild(tt):$.insertBefore(tt,q),this.options.group.revertClone&&this.animate(q,tt),P(tt,"display",""),et=!1)):this._hideClone()}},xt&&h(document,"touchmove",function(t){(Bt.active||yt)&&t.cancelable&&t.preventDefault()}),Bt.utils={on:h,off:f,css:P,find:b,is:function(t,e){return!!N(t,e,t,!1)},extend:function(t,e){if(t&&e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},throttle:S,closest:N,toggleClass:I,clone:_,index:B,nextTick:Lt,cancelNextTick:Kt,detectDirection:It,getChild:X},Bt.get=function(t){return t[j]},Bt.mount=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];(e=e[0].constructor===Array?e[0]:e).forEach(function(t){if(!t.prototype||!t.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(t));t.utils&&(Bt.utils=M(M({},Bt.utils),t.utils)),K.mount(t)})},Bt.create=function(t,e){return new Bt(t,e)};var Wt,zt,Gt,Ut,qt,Vt,Zt=[],$t=!(Bt.version="1.15.0");function Qt(){Zt.forEach(function(t){clearInterval(t.pid)}),Zt=[]}function Jt(){clearInterval(Vt)}var te,ee=S(function(n,t,e,o){if(t.scroll){var i,r=(n.touches?n.touches[0]:n).clientX,a=(n.touches?n.touches[0]:n).clientY,l=t.scrollSensitivity,s=t.scrollSpeed,c=O(),u=!1;zt!==e&&(zt=e,Qt(),Wt=t.scroll,i=t.scrollFn,!0===Wt&&(Wt=A(e,!0)));var d=0,h=Wt;do{var f=h,p=k(f),g=p.top,m=p.bottom,v=p.left,b=p.right,y=p.width,w=p.height,E=void 0,D=void 0,S=f.scrollWidth,_=f.scrollHeight,C=P(f),T=f.scrollLeft,p=f.scrollTop,D=f===c?(E=y<S&&("auto"===C.overflowX||"scroll"===C.overflowX||"visible"===C.overflowX),w<_&&("auto"===C.overflowY||"scroll"===C.overflowY||"visible"===C.overflowY)):(E=y<S&&("auto"===C.overflowX||"scroll"===C.overflowX),w<_&&("auto"===C.overflowY||"scroll"===C.overflowY)),T=E&&(Math.abs(b-r)<=l&&T+y<S)-(Math.abs(v-r)<=l&&!!T),p=D&&(Math.abs(m-a)<=l&&p+w<_)-(Math.abs(g-a)<=l&&!!p);if(!Zt[d])for(var x=0;x<=d;x++)Zt[x]||(Zt[x]={});Zt[d].vx==T&&Zt[d].vy==p&&Zt[d].el===f||(Zt[d].el=f,Zt[d].vx=T,Zt[d].vy=p,clearInterval(Zt[d].pid),0==T&&0==p||(u=!0,Zt[d].pid=setInterval(function(){o&&0===this.layer&&Bt.active._onTouchMove(qt);var t=Zt[this.layer].vy?Zt[this.layer].vy*s:0,e=Zt[this.layer].vx?Zt[this.layer].vx*s:0;"function"==typeof i&&"continue"!==i.call(Bt.dragged.parentNode[j],e,t,n,qt,Zt[this.layer].el)||F(Zt[this.layer].el,e,t)}.bind({layer:d}),24))),d++}while(t.bubbleScroll&&h!==c&&(h=A(h,!1)));$t=u}},30),c=function(t){var e=t.originalEvent,n=t.putSortable,o=t.dragEl,i=t.activeSortable,r=t.dispatchSortableEvent,a=t.hideGhostForTarget,t=t.unhideGhostForTarget;e&&(i=n||i,a(),e=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e,e=document.elementFromPoint(e.clientX,e.clientY),t(),i&&!i.el.contains(e)&&(r("spill"),this.onSpill({dragEl:o,putSortable:n})))};function ne(){}function oe(){}ne.prototype={startIndex:null,dragStart:function(t){t=t.oldDraggableIndex;this.startIndex=t},onSpill:function(t){var e=t.dragEl,n=t.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();t=X(this.sortable.el,this.startIndex,this.options);t?this.sortable.el.insertBefore(e,t):this.sortable.el.appendChild(e),this.sortable.animateAll(),n&&n.animateAll()},drop:c},a(ne,{pluginName:"revertOnSpill"}),oe.prototype={onSpill:function(t){var e=t.dragEl,t=t.putSortable||this.sortable;t.captureAnimationState(),e.parentNode&&e.parentNode.removeChild(e),t.animateAll()},drop:c},a(oe,{pluginName:"removeOnSpill"});var ie,re,ae,le,se,ce=[],ue=[],de=!1,he=!1,fe=!1;function pe(n,o){ue.forEach(function(t,e){e=o.children[t.sortableIndex+(n?Number(e):0)];e?o.insertBefore(t,e):o.appendChild(t)})}function ge(){ce.forEach(function(t){t!==ae&&t.parentNode&&t.parentNode.removeChild(t)})}return Bt.mount(new function(){function t(){for(var t in this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===t.charAt(0)&&"function"==typeof this[t]&&(this[t]=this[t].bind(this))}return t.prototype={dragStarted:function(t){t=t.originalEvent;this.sortable.nativeDraggable?h(document,"dragover",this._handleAutoScroll):this.options.supportPointer?h(document,"pointermove",this._handleFallbackAutoScroll):t.touches?h(document,"touchmove",this._handleFallbackAutoScroll):h(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){t=t.originalEvent;this.options.dragOverBubble||t.rootEl||this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?f(document,"dragover",this._handleAutoScroll):(f(document,"pointermove",this._handleFallbackAutoScroll),f(document,"touchmove",this._handleFallbackAutoScroll),f(document,"mousemove",this._handleFallbackAutoScroll)),Jt(),Qt(),clearTimeout(g),g=void 0},nulling:function(){qt=zt=Wt=$t=Vt=Gt=Ut=null,Zt.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(e,n){var o,i=this,r=(e.touches?e.touches[0]:e).clientX,a=(e.touches?e.touches[0]:e).clientY,t=document.elementFromPoint(r,a);qt=e,n||this.options.forceAutoScrollFallback||w||y||u?(ee(e,this.options,t,n),o=A(t,!0),!$t||Vt&&r===Gt&&a===Ut||(Vt&&Jt(),Vt=setInterval(function(){var t=A(document.elementFromPoint(r,a),!0);t!==o&&(o=t,Qt()),ee(e,i.options,t,n)},10),Gt=r,Ut=a)):this.options.bubbleScroll&&A(t,!0)!==O()?ee(e,this.options,A(t,!1),!1):Qt()}},a(t,{pluginName:"scroll",initializeByDefault:!0})}),Bt.mount(oe,ne),Bt.mount(new function(){function t(){this.defaults={swapClass:"sortable-swap-highlight"}}return t.prototype={dragStart:function(t){t=t.dragEl;te=t},dragOverValid:function(t){var e=t.completed,n=t.target,o=t.onMove,i=t.activeSortable,r=t.changed,a=t.cancel;i.options.swap&&(t=this.sortable.el,i=this.options,n&&n!==t&&(t=te,te=!1!==o(n)?(I(n,i.swapClass,!0),n):null,t&&t!==te&&I(t,i.swapClass,!1)),r(),e(!0),a())},drop:function(t){var e,n,o=t.activeSortable,i=t.putSortable,r=t.dragEl,a=i||this.sortable,l=this.options;te&&I(te,l.swapClass,!1),te&&(l.swap||i&&i.options.swap)&&r!==te&&(a.captureAnimationState(),a!==o&&o.captureAnimationState(),n=te,t=(e=r).parentNode,l=n.parentNode,t&&l&&!t.isEqualNode(n)&&!l.isEqualNode(e)&&(i=B(e),r=B(n),t.isEqualNode(l)&&i<r&&r++,t.insertBefore(n,t.children[i]),l.insertBefore(e,l.children[r])),a.animateAll(),a!==o&&o.animateAll())},nulling:function(){te=null}},a(t,{pluginName:"swap",eventProperties:function(){return{swapItem:te}}})}),Bt.mount(new function(){function t(o){for(var t in this)"_"===t.charAt(0)&&"function"==typeof this[t]&&(this[t]=this[t].bind(this));o.options.avoidImplicitDeselect||(o.options.supportPointer?h(document,"pointerup",this._deselectMultiDrag):(h(document,"mouseup",this._deselectMultiDrag),h(document,"touchend",this._deselectMultiDrag))),h(document,"keydown",this._checkKeyDown),h(document,"keyup",this._checkKeyUp),this.defaults={selectedClass:"sortable-selected",multiDragKey:null,avoidImplicitDeselect:!1,setData:function(t,e){var n="";ce.length&&re===o?ce.forEach(function(t,e){n+=(e?", ":"")+t.textContent}):n=e.textContent,t.setData("Text",n)}}}return t.prototype={multiDragKeyDown:!1,isMultiDrag:!1,delayStartGlobal:function(t){t=t.dragEl;ae=t},delayEnded:function(){this.isMultiDrag=~ce.indexOf(ae)},setupClone:function(t){var e=t.sortable,t=t.cancel;if(this.isMultiDrag){for(var n=0;n<ce.length;n++)ue.push(_(ce[n])),ue[n].sortableIndex=ce[n].sortableIndex,ue[n].draggable=!1,ue[n].style["will-change"]="",I(ue[n],this.options.selectedClass,!1),ce[n]===ae&&I(ue[n],this.options.chosenClass,!1);e._hideClone(),t()}},clone:function(t){var e=t.sortable,n=t.rootEl,o=t.dispatchSortableEvent,t=t.cancel;this.isMultiDrag&&(this.options.removeCloneOnHide||ce.length&&re===e&&(pe(!0,n),o("clone"),t()))},showClone:function(t){var e=t.cloneNowShown,n=t.rootEl,t=t.cancel;this.isMultiDrag&&(pe(!1,n),ue.forEach(function(t){P(t,"display","")}),e(),se=!1,t())},hideClone:function(t){var e=this,n=(t.sortable,t.cloneNowHidden),t=t.cancel;this.isMultiDrag&&(ue.forEach(function(t){P(t,"display","none"),e.options.removeCloneOnHide&&t.parentNode&&t.parentNode.removeChild(t)}),n(),se=!0,t())},dragStartGlobal:function(t){t.sortable;!this.isMultiDrag&&re&&re.multiDrag._deselectMultiDrag(),ce.forEach(function(t){t.sortableIndex=B(t)}),ce=ce.sort(function(t,e){return t.sortableIndex-e.sortableIndex}),fe=!0},dragStarted:function(t){var e,n=this,t=t.sortable;this.isMultiDrag&&(this.options.sort&&(t.captureAnimationState(),this.options.animation&&(ce.forEach(function(t){t!==ae&&P(t,"position","absolute")}),e=k(ae,!1,!0,!0),ce.forEach(function(t){t!==ae&&C(t,e)}),de=he=!0)),t.animateAll(function(){de=he=!1,n.options.animation&&ce.forEach(function(t){T(t)}),n.options.sort&&ge()}))},dragOver:function(t){var e=t.target,n=t.completed,t=t.cancel;he&&~ce.indexOf(e)&&(n(!1),t())},revert:function(t){var n,o,e=t.fromSortable,i=t.rootEl,r=t.sortable,a=t.dragRect;1<ce.length&&(ce.forEach(function(t){r.addAnimationState({target:t,rect:he?k(t):a}),T(t),t.fromRect=a,e.removeAnimationState(t)}),he=!1,n=!this.options.removeCloneOnHide,o=i,ce.forEach(function(t,e){e=o.children[t.sortableIndex+(n?Number(e):0)];e?o.insertBefore(t,e):o.appendChild(t)}))},dragOverCompleted:function(t){var e,n=t.sortable,o=t.isOwner,i=t.insertion,r=t.activeSortable,a=t.parentEl,l=t.putSortable,t=this.options;i&&(o&&r._hideClone(),de=!1,t.animation&&1<ce.length&&(he||!o&&!r.options.sort&&!l)&&(e=k(ae,!1,!0,!0),ce.forEach(function(t){t!==ae&&(C(t,e),a.appendChild(t))}),he=!0),o||(he||ge(),1<ce.length?(o=se,r._showClone(n),r.options.animation&&!se&&o&&ue.forEach(function(t){r.addAnimationState({target:t,rect:le}),t.fromRect=le,t.thisAnimationDuration=null})):r._showClone(n)))},dragOverAnimationCapture:function(t){var e=t.dragRect,n=t.isOwner,t=t.activeSortable;ce.forEach(function(t){t.thisAnimationDuration=null}),t.options.animation&&!n&&t.multiDrag.isMultiDrag&&(le=a({},e),e=v(ae,!0),le.top-=e.f,le.left-=e.e)},dragOverAnimationComplete:function(){he&&(he=!1,ge())},drop:function(t){var e=t.originalEvent,n=t.rootEl,o=t.parentEl,i=t.sortable,r=t.dispatchSortableEvent,a=t.oldIndex,l=t.putSortable,s=l||this.sortable;if(e){var c,u,d,h=this.options,f=o.children;if(!fe)if(h.multiDragKey&&!this.multiDragKeyDown&&this._deselectMultiDrag(),I(ae,h.selectedClass,!~ce.indexOf(ae)),~ce.indexOf(ae))ce.splice(ce.indexOf(ae),1),ie=null,W({sortable:i,rootEl:n,name:"deselect",targetEl:ae,originalEvent:e});else{if(ce.push(ae),W({sortable:i,rootEl:n,name:"select",targetEl:ae,originalEvent:e}),e.shiftKey&&ie&&i.el.contains(ie)){var p=B(ie),t=B(ae);if(~p&&~t&&p!==t)for(var g,m=p<t?(g=p,t):(g=t,p+1);g<m;g++)~ce.indexOf(f[g])||(I(f[g],h.selectedClass,!0),ce.push(f[g]),W({sortable:i,rootEl:n,name:"select",targetEl:f[g],originalEvent:e}))}else ie=ae;re=s}fe&&this.isMultiDrag&&(he=!1,(o[j].options.sort||o!==n)&&1<ce.length&&(c=k(ae),u=B(ae,":not(."+this.options.selectedClass+")"),!de&&h.animation&&(ae.thisAnimationDuration=null),s.captureAnimationState(),de||(h.animation&&(ae.fromRect=c,ce.forEach(function(t){var e;t.thisAnimationDuration=null,t!==ae&&(e=he?k(t):c,t.fromRect=e,s.addAnimationState({target:t,rect:e}))})),ge(),ce.forEach(function(t){f[u]?o.insertBefore(t,f[u]):o.appendChild(t),u++}),a===B(ae)&&(d=!1,ce.forEach(function(t){t.sortableIndex!==B(t)&&(d=!0)}),d&&r("update"))),ce.forEach(function(t){T(t)}),s.animateAll()),re=s),(n===o||l&&"clone"!==l.lastPutMode)&&ue.forEach(function(t){t.parentNode&&t.parentNode.removeChild(t)})}},nullingGlobal:function(){this.isMultiDrag=fe=!1,ue.length=0},destroyGlobal:function(){this._deselectMultiDrag(),f(document,"pointerup",this._deselectMultiDrag),f(document,"mouseup",this._deselectMultiDrag),f(document,"touchend",this._deselectMultiDrag),f(document,"keydown",this._checkKeyDown),f(document,"keyup",this._checkKeyUp)},_deselectMultiDrag:function(t){if(!(void 0!==fe&&fe||re!==this.sortable||t&&N(t.target,this.options.draggable,this.sortable.el,!1)||t&&0!==t.button))for(;ce.length;){var e=ce[0];I(e,this.options.selectedClass,!1),ce.shift(),W({sortable:this.sortable,rootEl:this.sortable.el,name:"deselect",targetEl:e,originalEvent:t})}},_checkKeyDown:function(t){t.key===this.options.multiDragKey&&(this.multiDragKeyDown=!0)},_checkKeyUp:function(t){t.key===this.options.multiDragKey&&(this.multiDragKeyDown=!1)}},a(t,{pluginName:"multiDrag",utils:{select:function(t){var e=t.parentNode[j];e&&e.options.multiDrag&&!~ce.indexOf(t)&&(re&&re!==e&&(re.multiDrag._deselectMultiDrag(),re=e),I(t,e.options.selectedClass,!0),ce.push(t))},deselect:function(t){var e=t.parentNode[j],n=ce.indexOf(t);e&&e.options.multiDrag&&~n&&(I(t,e.options.selectedClass,!1),ce.splice(n,1))}},eventProperties:function(){var n=this,o=[],i=[];return ce.forEach(function(t){var e;o.push({multiDragElement:t,index:t.sortableIndex}),e=he&&t!==ae?-1:he?B(t,":not(."+n.options.selectedClass+")"):B(t),i.push({multiDragElement:t,index:e})}),{items:r(ce),clones:[].concat(ue),oldIndicies:o,newIndicies:i}},optionListeners:{multiDragKey:function(t){return"ctrl"===(t=t.toLowerCase())?t="Control":1<t.length&&(t=t.charAt(0).toUpperCase()+t.substr(1)),t}}})}),Bt});
const HtmlSanitizer=new(function(){const _tagWhitelist={'A':true,'ABBR':true,'B':true,'BLOCKQUOTE':true,'BODY':true,'BR':true,'CENTER':true,'CODE':true,'DD':true,'DIV':true,'DL':true,'DT':true,'EM':true,'FONT':true,'H1':true,'H2':true,'H3':true,'H4':true,'H5':true,'H6':true,'HR':true,'I':true,'IMG':true,'LABEL':true,'LI':true,'OL':true,'P':true,'PRE':true,'SMALL':true,'SOURCE':true,'SPAN':true,'STRONG':true,'SUB':true,'SUP':true,'TABLE':true,'TBODY':true,'TR':true,'TD':true,'TH':true,'THEAD':true,'UL':true,'U':true,'VIDEO':true};const _contentTagWhiteList={'FORM':true,'GOOGLE-SHEETS-HTML-ORIGIN':true};const _attributeWhitelist={'align':true,'color':true,'controls':true,'height':true,'href':true,'id':true,'src':true,'style':true,'target':true,'title':true,'type':true,'width':true};const _cssWhitelist={'background-color':true,'color':true,'font-size':true,'font-weight':true,'text-align':true,'text-decoration':true,'width':true};const _schemaWhiteList=['http:','https:','data:','m-files:','file:','ftp:','mailto:','pw:'];const _uriAttributes={'href':true,'action':true};const _parser=new DOMParser();this.SanitizeHtml=function(input,extraSelector){input=input.trim();if(input=="")return"";if(input=="<br>")return"";if(input.indexOf("<body")==-1)input="<body>"+input+"</body>";let doc=_parser.parseFromString(input,"text/html");if(doc.body.tagName!=='BODY')
doc.body.remove();if(typeof doc.createElement!=='function')
doc.createElement.remove();function makeSanitizedCopy(node){let newNode;if(node.nodeType==Node.TEXT_NODE){newNode=node.cloneNode(true);}else if(node.nodeType==Node.ELEMENT_NODE&&(_tagWhitelist[node.tagName]||_contentTagWhiteList[node.tagName]||(extraSelector&&node.matches(extraSelector)))){if(_contentTagWhiteList[node.tagName])
newNode=doc.createElement('DIV');else
newNode=doc.createElement(node.tagName);for(let i=0;i<node.attributes.length;i++){let attr=node.attributes[i];if(_attributeWhitelist[attr.name]){if(attr.name=="style"){for(let s=0;s<node.style.length;s++){let styleName=node.style[s];if(_cssWhitelist[styleName])
newNode.style.setProperty(styleName,node.style.getPropertyValue(styleName));}}
else{if(_uriAttributes[attr.name]){if(attr.value.indexOf(":")>-1&&!startsWithAny(attr.value,_schemaWhiteList))
continue;}
newNode.setAttribute(attr.name,attr.value);}}}
for(let i=0;i<node.childNodes.length;i++){let subCopy=makeSanitizedCopy(node.childNodes[i]);newNode.appendChild(subCopy,false);}
if((newNode.tagName=="SPAN"||newNode.tagName=="B"||newNode.tagName=="I"||newNode.tagName=="U")&&newNode.innerHTML.trim()==""){return doc.createDocumentFragment();}}else{newNode=doc.createDocumentFragment();}
return newNode;};let resultElement=makeSanitizedCopy(doc.body);return resultElement.innerHTML.replace(/<br[^>]*>(\S)/g,"<br>\n$1").replace(/div><div/g,"div>\n<div");}
function startsWithAny(str,substrings){for(let i=0;i<substrings.length;i++){if(str.indexOf(substrings[i])==0){return true;}}
return false;}
this.AllowedTags=_tagWhitelist;this.AllowedAttributes=_attributeWhitelist;this.AllowedCssStyles=_cssWhitelist;this.AllowedSchemas=_schemaWhiteList;});
//HtmlSanitizer.SanitizeHtml=function(a){return a;}
//panzoom
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Panzoom=e()}(this,function(){"use strict";var Y=function(){return(Y=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function C(t,e){for(var n=t.length;n--;)if(t[n].pointerId===e.pointerId)return n;return-1}function T(t,e){if(e.touches)for(var n=0,o=0,r=e.touches;o<r.length;o++){var a=r[o];a.pointerId=n++,T(t,a)}else-1<(n=C(t,e))&&t.splice(n,1),t.push(e)}function N(t){for(var e,n=(t=t.slice(0)).pop();e=t.pop();)n={clientX:(e.clientX-n.clientX)/2+n.clientX,clientY:(e.clientY-n.clientY)/2+n.clientY};return n}function L(t){var e;return t.length<2?0:(e=t[0],t=t[1],Math.sqrt(Math.pow(Math.abs(t.clientX-e.clientX),2)+Math.pow(Math.abs(t.clientY-e.clientY),2)))}"undefined"!=typeof window&&(window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),"function"!=typeof window.CustomEvent&&(window.CustomEvent=function(t,e){e=e||{bubbles:!1,cancelable:!1,detail:null};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n}));var V={down:"mousedown",move:"mousemove",up:"mouseup mouseleave"};function D(t,e,n,o){V[t].split(" ").forEach(function(t){e.addEventListener(t,n,o)})}function G(t,e,n){V[t].split(" ").forEach(function(t){e.removeEventListener(t,n)})}"undefined"!=typeof window&&("function"==typeof window.PointerEvent?V={down:"pointerdown",move:"pointermove",up:"pointerup pointerleave pointercancel"}:"function"==typeof window.TouchEvent&&(V={down:"touchstart",move:"touchmove",up:"touchend touchcancel"}));var a,i="undefined"!=typeof document&&!!document.documentMode;var c=["webkit","moz","ms"],l={};function I(t){if(l[t])return l[t];var e=a=a||document.createElement("div").style;if(t in e)return l[t]=t;for(var n=t[0].toUpperCase()+t.slice(1),o=c.length;o--;){var r="".concat(c[o]).concat(n);if(r in e)return l[t]=r}}function o(t,e){return parseFloat(e[I(t)])||0}function s(t,e,n){void 0===n&&(n=window.getComputedStyle(t));t="border"===e?"Width":"";return{left:o("".concat(e,"Left").concat(t),n),right:o("".concat(e,"Right").concat(t),n),top:o("".concat(e,"Top").concat(t),n),bottom:o("".concat(e,"Bottom").concat(t),n)}}function W(t,e,n){t.style[I(e)]=n}function Z(t){var e=t.parentNode,n=window.getComputedStyle(t),o=window.getComputedStyle(e),r=t.getBoundingClientRect(),a=e.getBoundingClientRect();return{elem:{style:n,width:r.width,height:r.height,top:r.top,bottom:r.bottom,left:r.left,right:r.right,margin:s(t,"margin",n),border:s(t,"border",n)},parent:{style:o,width:a.width,height:a.height,top:a.top,bottom:a.bottom,left:a.left,right:a.right,padding:s(e,"padding",o),border:s(e,"border",o)}}}var q=/^http:[\w\.\/]+svg$/;var B={animate:!1,canvas:!1,cursor:"move",disablePan:!1,disableZoom:!1,disableXAxis:!1,disableYAxis:!1,duration:200,easing:"ease-in-out",exclude:[],excludeClass:"panzoom-exclude",handleStartEvent:function(t){t.preventDefault(),t.stopPropagation()},maxScale:4,minScale:.125,overflow:"hidden",panOnlyWhenZoomed:!1,pinchAndPan:!1,relative:!1,setTransform:function(t,e,n){var o=e.x,r=e.y,a=e.scale,e=e.isSVG;W(t,"transform","scale(".concat(a,") translate(").concat(o,"px, ").concat(r,"px)")),e&&i&&(a=window.getComputedStyle(t).getPropertyValue("transform"),t.setAttribute("transform",a))},startX:0,startY:0,startScale:1,step:.3,touchAction:"none"};function t(u,f){if(!u)throw new Error("Panzoom requires an element as an argument");if(1!==u.nodeType)throw new Error("Panzoom requires an element with a nodeType of 1");if(e=(t=u).ownerDocument,t=t.parentNode,!(e&&t&&9===e.nodeType&&1===t.nodeType&&e.documentElement.contains(t)))throw new Error("Panzoom should be called on elements that have been attached to the DOM");f=Y(Y({},B),f),e=u;var t,e,l=q.test(e.namespaceURI)&&"svg"!==e.nodeName.toLowerCase(),n=u.parentNode;n.style.overflow=f.overflow,n.style.userSelect="none",n.style.touchAction=f.touchAction,(f.canvas?n:u).style.cursor=f.cursor,u.style.userSelect="none",u.style.touchAction=f.touchAction,W(u,"transformOrigin","string"==typeof f.origin?f.origin:l?"0 0":"50% 50%");var r,a,i,c,s,d,m=0,h=0,v=1,p=!1;function g(t,e,n){n.silent||(n=new CustomEvent(t,{detail:e}),u.dispatchEvent(n))}function y(o,r,t){var a={x:m,y:h,scale:v,isSVG:l,originalEvent:t};return requestAnimationFrame(function(){var t,e,n;"boolean"==typeof r.animate&&(r.animate?(t=u,e=r,n=I("transform"),W(t,"transition","".concat(n," ").concat(e.duration,"ms ").concat(e.easing))):W(u,"transition","none")),r.setTransform(u,a,r),g(o,a,r),g("panzoomchange",a,r)}),a}function w(t,e,n,o){var r,a,i,c,l,s,d,o=Y(Y({},f),o),p={x:m,y:h,opts:o};return!o.force&&(o.disablePan||o.panOnlyWhenZoomed&&v===o.startScale)||(t=parseFloat(t),e=parseFloat(e),o.disableXAxis||(p.x=(o.relative?m:0)+t),o.disableYAxis||(p.y=(o.relative?h:0)+e),o.contain&&(e=((r=(e=(t=Z(u)).elem.width/v)*n)-e)/2,i=((a=(i=t.elem.height/v)*n)-i)/2,"inside"===o.contain?(c=(-t.elem.margin.left-t.parent.padding.left+e)/n,l=(t.parent.width-r-t.parent.padding.left-t.elem.margin.left-t.parent.border.left-t.parent.border.right+e)/n,p.x=Math.max(Math.min(p.x,l),c),s=(-t.elem.margin.top-t.parent.padding.top+i)/n,d=(t.parent.height-a-t.parent.padding.top-t.elem.margin.top-t.parent.border.top-t.parent.border.bottom+i)/n,p.y=Math.max(Math.min(p.y,d),s)):"outside"===o.contain&&(c=(-(r-t.parent.width)-t.parent.padding.left-t.parent.border.left-t.parent.border.right+e)/n,l=(e-t.parent.padding.left)/n,p.x=Math.max(Math.min(p.x,l),c),s=(-(a-t.parent.height)-t.parent.padding.top-t.parent.border.top-t.parent.border.bottom+i)/n,d=(i-t.parent.padding.top)/n,p.y=Math.max(Math.min(p.y,d),s))),o.roundPixels&&(p.x=Math.round(p.x),p.y=Math.round(p.y))),p}function b(t,e){var n,o,r,a,e=Y(Y({},f),e),i={scale:v,opts:e};return!e.force&&e.disableZoom||(n=f.minScale,o=f.maxScale,e.contain&&(a=(e=Z(u)).elem.width/v,r=e.elem.height/v,1<a&&1<r&&(a=(e.parent.width-e.parent.border.left-e.parent.border.right)/a,e=(e.parent.height-e.parent.border.top-e.parent.border.bottom)/r,"inside"===f.contain?o=Math.min(o,a,e):"outside"===f.contain&&(n=Math.max(n,a,e)))),i.scale=Math.min(Math.max(t,n),o)),i}function x(t,e,n,o){t=w(t,e,v,n);return m!==t.x||h!==t.y?(m=t.x,h=t.y,y("panzoompan",t.opts,o)):{x:m,y:h,scale:v,isSVG:l,originalEvent:o}}function E(t,e,n){var o,r,e=b(t,e),a=e.opts;if(a.force||!a.disableZoom)return t=e.scale,e=m,o=h,a.focal&&(e=((r=a.focal).x/t-r.x/v+m*t)/t,o=(r.y/t-r.y/v+h*t)/t),r=w(e,o,t,{relative:!1,force:!0}),m=r.x,h=r.y,v=t,y("panzoomzoom",a,n)}function o(t,e){e=Y(Y(Y({},f),{animate:!0}),e);return E(v*Math.exp((t?1:-1)*e.step),e)}function S(t,e,n,o){var r=Z(u),a=r.parent.width-r.parent.padding.left-r.parent.padding.right-r.parent.border.left-r.parent.border.right,i=r.parent.height-r.parent.padding.top-r.parent.padding.bottom-r.parent.border.top-r.parent.border.bottom,c=e.clientX-r.parent.left-r.parent.padding.left-r.parent.border.left-r.elem.margin.left,e=e.clientY-r.parent.top-r.parent.padding.top-r.parent.border.top-r.elem.margin.top,r=(l||(c-=r.elem.width/v/2,e-=r.elem.height/v/2),{x:c/a*(a*t),y:e/i*(i*t)});return E(t,Y(Y({},n),{animate:!1,focal:r}),o)}E(f.startScale,{animate:!1,force:!0}),setTimeout(function(){x(f.startX,f.startY,{animate:!1,force:!0})});var M=[];function A(t){!function(t,e){for(var n,o,r=t;null!=r;r=r.parentNode)if(n=r,o=e.excludeClass,1===n.nodeType&&-1<" ".concat((n.getAttribute("class")||"").trim()," ").indexOf(" ".concat(o," "))||-1<e.exclude.indexOf(r))return 1}(t.target,f)&&(T(M,t),p=!0,f.handleStartEvent(t),g("panzoomstart",{x:r=m,y:a=h,scale:v,isSVG:l,originalEvent:t},f),t=N(M),i=t.clientX,c=t.clientY,s=v,d=L(M))}function P(t){var e,n,o;p&&void 0!==r&&void 0!==a&&void 0!==i&&void 0!==c&&(T(M,t),e=N(M),n=1<M.length,o=v,n&&(0===d&&(d=L(M)),S(o=b((L(M)-d)*f.step/80+s).scale,e,{animate:!1},t)),n&&!f.pinchAndPan||x(r+(e.clientX-i)/o,a+(e.clientY-c)/o,{animate:!1},t))}function O(t){1===M.length&&g("panzoomend",{x:m,y:h,scale:v,isSVG:l,originalEvent:t},f);var e=M;if(t.touches)for(;e.length;)e.pop();else{t=C(e,t);-1<t&&e.splice(t,1)}p&&(p=!1,r=a=i=c=void 0)}var z=!1;function X(){z||(z=!0,D("down",f.canvas?n:u,A),D("move",document,P,{passive:!0}),D("up",document,O,{passive:!0}))}return f.noBind||X(),{bind:X,destroy:function(){z=!1,G("down",f.canvas?n:u,A),G("move",document,P),G("up",document,O)},eventNames:V,getPan:function(){return{x:m,y:h}},getScale:function(){return v},getOptions:function(){var t,e=f,n={};for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n},handleDown:A,handleMove:P,handleUp:O,pan:x,reset:function(t){var t=Y(Y(Y({},f),{animate:!0,force:!0}),t),e=(v=b(t.startScale,t).scale,w(t.startX,t.startY,v,t));return m=e.x,h=e.y,y("panzoomreset",t)},resetStyle:function(){n.style.overflow="",n.style.userSelect="",n.style.touchAction="",n.style.cursor="",u.style.cursor="",u.style.userSelect="",u.style.touchAction="",W(u,"transformOrigin","")},setOptions:function(t){for(var e in t=void 0===t?{}:t)t.hasOwnProperty(e)&&(f[e]=t[e]);(t.hasOwnProperty("cursor")||t.hasOwnProperty("canvas"))&&(n.style.cursor=u.style.cursor="",(f.canvas?n:u).style.cursor=f.cursor),t.hasOwnProperty("overflow")&&(n.style.overflow=t.overflow),t.hasOwnProperty("touchAction")&&(n.style.touchAction=t.touchAction,u.style.touchAction=t.touchAction)},setStyle:function(t,e){return W(u,t,e)},zoom:E,zoomIn:function(t){return o(!0,t)},zoomOut:function(t){return o(!1,t)},zoomToPoint:S,zoomWithWheel:function(t,e){t.preventDefault();var e=Y(Y(Y({},f),e),{animate:!1}),n=0===t.deltaY&&t.deltaX?t.deltaX:t.deltaY;return S(b(v*Math.exp((n<0?1:-1)*e.step/3),e).scale,t,e,t)}}}return t.defaultOptions=B,t});
/*!
 * clipboard.js v2.0.11
 * https://clipboardjs.com/
 *
 * Licensed MIT © Zeno Rocha
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ClipboardJS=e():t.ClipboardJS=e()}(this,function(){return n={686:function(t,e,n){"use strict";n.d(e,{default:function(){return b}});var e=n(279),i=n.n(e),e=n(370),u=n.n(e),e=n(817),r=n.n(e);function c(t){try{return document.execCommand(t)}catch(t){return}}var a=function(t){t=r()(t);return c("cut"),t};function o(t,e){var n,o,t=(n=t,o="rtl"===document.documentElement.getAttribute("dir"),(t=document.createElement("textarea")).style.fontSize="12pt",t.style.border="0",t.style.padding="0",t.style.margin="0",t.style.position="absolute",t.style[o?"right":"left"]="-9999px",o=window.pageYOffset||document.documentElement.scrollTop,t.style.top="".concat(o,"px"),t.setAttribute("readonly",""),t.value=n,t);return e.container.appendChild(t),e=r()(t),c("copy"),t.remove(),e}var f=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{container:document.body},n="";return"string"==typeof t?n=o(t,e):t instanceof HTMLInputElement&&!["text","search","url","tel","password"].includes(null==t?void 0:t.type)?n=o(t.value,e):(n=r()(t),c("copy")),n};function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var s=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.action,n=void 0===e?"copy":e,o=t.container,e=t.target,t=t.text;if("copy"!==n&&"cut"!==n)throw new Error('Invalid "action" value, use either "copy" or "cut"');if(void 0!==e){if(!e||"object"!==l(e)||1!==e.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===n&&e.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===n&&(e.hasAttribute("readonly")||e.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes')}return t?f(t,{container:o}):e?"cut"===n?a(e):f(e,{container:o}):void 0};function p(t){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function d(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function y(t,e){return(y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(n){var o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=v(n);return t=o?(t=v(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),e=this,!(t=t)||"object"!==p(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}}function v(t){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function m(t,e){t="data-clipboard-".concat(t);if(e.hasAttribute(t))return e.getAttribute(t)}var b=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&y(t,e)}(r,i());var t,e,n,o=h(r);function r(t,e){var n;return function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),(n=o.call(this)).resolveOptions(e),n.listenClick(t),n}return t=r,n=[{key:"copy",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{container:document.body};return f(t,e)}},{key:"cut",value:function(t){return a(t)}},{key:"isSupported",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:["copy","cut"],t="string"==typeof t?[t]:t,e=!!document.queryCommandSupported;return t.forEach(function(t){e=e&&!!document.queryCommandSupported(t)}),e}}],(e=[{key:"resolveOptions",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.action="function"==typeof t.action?t.action:this.defaultAction,this.target="function"==typeof t.target?t.target:this.defaultTarget,this.text="function"==typeof t.text?t.text:this.defaultText,this.container="object"===p(t.container)?t.container:document.body}},{key:"listenClick",value:function(t){var e=this;this.listener=u()(t,"click",function(t){return e.onClick(t)})}},{key:"onClick",value:function(t){var e=t.delegateTarget||t.currentTarget,n=this.action(e)||"copy",t=s({action:n,container:this.container,target:this.target(e),text:this.text(e)});this.emit(t?"success":"error",{action:n,text:t,trigger:e,clearSelection:function(){e&&e.focus(),window.getSelection().removeAllRanges()}})}},{key:"defaultAction",value:function(t){return m("action",t)}},{key:"defaultTarget",value:function(t){t=m("target",t);if(t)return document.querySelector(t)}},{key:"defaultText",value:function(t){return m("text",t)}},{key:"destroy",value:function(){this.listener.destroy()}}])&&d(t.prototype,e),n&&d(t,n),r}()},828:function(t){var e;"undefined"==typeof Element||Element.prototype.matches||((e=Element.prototype).matches=e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector),t.exports=function(t,e){for(;t&&9!==t.nodeType;){if("function"==typeof t.matches&&t.matches(e))return t;t=t.parentNode}}},438:function(t,e,n){var u=n(828);function i(t,e,n,o,r){var i=function(e,n,t,o){return function(t){t.delegateTarget=u(t.target,n),t.delegateTarget&&o.call(e,t)}}.apply(this,arguments);return t.addEventListener(n,i,r),{destroy:function(){t.removeEventListener(n,i,r)}}}t.exports=function(t,e,n,o,r){return"function"==typeof t.addEventListener?i.apply(null,arguments):"function"==typeof n?i.bind(null,document).apply(null,arguments):("string"==typeof t&&(t=document.querySelectorAll(t)),Array.prototype.map.call(t,function(t){return i(t,e,n,o,r)}))}},879:function(t,n){n.node=function(t){return void 0!==t&&t instanceof HTMLElement&&1===t.nodeType},n.nodeList=function(t){var e=Object.prototype.toString.call(t);return void 0!==t&&("[object NodeList]"===e||"[object HTMLCollection]"===e)&&"length"in t&&(0===t.length||n.node(t[0]))},n.string=function(t){return"string"==typeof t||t instanceof String},n.fn=function(t){return"[object Function]"===Object.prototype.toString.call(t)}},370:function(t,e,n){var f=n(879),l=n(438);t.exports=function(t,e,n){if(!t&&!e&&!n)throw new Error("Missing required arguments");if(!f.string(e))throw new TypeError("Second argument must be a String");if(!f.fn(n))throw new TypeError("Third argument must be a Function");if(f.node(t))return c=e,a=n,(u=t).addEventListener(c,a),{destroy:function(){u.removeEventListener(c,a)}};if(f.nodeList(t))return o=t,r=e,i=n,Array.prototype.forEach.call(o,function(t){t.addEventListener(r,i)}),{destroy:function(){Array.prototype.forEach.call(o,function(t){t.removeEventListener(r,i)})}};if(f.string(t))return t=t,e=e,n=n,l(document.body,t,e,n);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList");var o,r,i,u,c,a}},817:function(t){t.exports=function(t){var e,n="SELECT"===t.nodeName?(t.focus(),t.value):"INPUT"===t.nodeName||"TEXTAREA"===t.nodeName?((e=t.hasAttribute("readonly"))||t.setAttribute("readonly",""),t.select(),t.setSelectionRange(0,t.value.length),e||t.removeAttribute("readonly"),t.value):(t.hasAttribute("contenteditable")&&t.focus(),n=window.getSelection(),(e=document.createRange()).selectNodeContents(t),n.removeAllRanges(),n.addRange(e),n.toString());return n}},279:function(t){function e(){}e.prototype={on:function(t,e,n){var o=this.e||(this.e={});return(o[t]||(o[t]=[])).push({fn:e,ctx:n}),this},once:function(t,e,n){var o=this;function r(){o.off(t,r),e.apply(n,arguments)}return r._=e,this.on(t,r,n)},emit:function(t){for(var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),o=0,r=n.length;o<r;o++)n[o].fn.apply(n[o].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),o=n[t],r=[];if(o&&e)for(var i=0,u=o.length;i<u;i++)o[i].fn!==e&&o[i].fn._!==e&&r.push(o[i]);return r.length?n[t]=r:delete n[t],this}},t.exports=e,t.exports.TinyEmitter=e}},r={},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,{a:e}),e},o.d=function(t,e){for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o(686).default;function o(t){if(r[t])return r[t].exports;var e=r[t]={exports:{}};return n[t](e,e.exports,o),e.exports}var n,r});
//replaceall
function escapeRegExp(string) {
  return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); // $& means the whole matched string
}

function replaceAll(str, find, replace) {
  return str.replace(new RegExp(escapeRegExp(find), 'g'), replace);
}
if(!String.prototype.replaceAll){String.prototype.replaceAll=function(str,newStr){return replaceAll(this,str,newStr);}}

var md5 = function(d){var r = M(V(Y(X(d),8*d.length)));return r.toLowerCase()};function M(d){for(var _,m="0123456789ABCDEF",f="",r=0;r<d.length;r++)_=d.charCodeAt(r),f+=m.charAt(_>>>4&15)+m.charAt(15&_);return f}function X(d){for(var _=Array(d.length>>2),m=0;m<_.length;m++)_[m]=0;for(m=0;m<8*d.length;m+=8)_[m>>5]|=(255&d.charCodeAt(m/8))<<m%32;return _}function V(d){for(var _="",m=0;m<32*d.length;m+=8)_+=String.fromCharCode(d[m>>5]>>>m%32&255);return _}function Y(d,_){d[_>>5]|=128<<_%32,d[14+(_+64>>>9<<4)]=_;for(var m=1732584193,f=-271733879,r=-1732584194,i=271733878,n=0;n<d.length;n+=16){var h=m,t=f,g=r,e=i;f=md5_ii(f=md5_ii(f=md5_ii(f=md5_ii(f=md5_hh(f=md5_hh(f=md5_hh(f=md5_hh(f=md5_gg(f=md5_gg(f=md5_gg(f=md5_gg(f=md5_ff(f=md5_ff(f=md5_ff(f=md5_ff(f,r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+0],7,-680876936),f,r,d[n+1],12,-389564586),m,f,d[n+2],17,606105819),i,m,d[n+3],22,-1044525330),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+4],7,-176418897),f,r,d[n+5],12,1200080426),m,f,d[n+6],17,-1473231341),i,m,d[n+7],22,-45705983),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+8],7,1770035416),f,r,d[n+9],12,-1958414417),m,f,d[n+10],17,-42063),i,m,d[n+11],22,-1990404162),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+12],7,1804603682),f,r,d[n+13],12,-40341101),m,f,d[n+14],17,-1502002290),i,m,d[n+15],22,1236535329),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+1],5,-165796510),f,r,d[n+6],9,-1069501632),m,f,d[n+11],14,643717713),i,m,d[n+0],20,-373897302),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+5],5,-701558691),f,r,d[n+10],9,38016083),m,f,d[n+15],14,-660478335),i,m,d[n+4],20,-405537848),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+9],5,568446438),f,r,d[n+14],9,-1019803690),m,f,d[n+3],14,-187363961),i,m,d[n+8],20,1163531501),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+13],5,-1444681467),f,r,d[n+2],9,-51403784),m,f,d[n+7],14,1735328473),i,m,d[n+12],20,-1926607734),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+5],4,-378558),f,r,d[n+8],11,-2022574463),m,f,d[n+11],16,1839030562),i,m,d[n+14],23,-35309556),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+1],4,-1530992060),f,r,d[n+4],11,1272893353),m,f,d[n+7],16,-155497632),i,m,d[n+10],23,-1094730640),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+13],4,681279174),f,r,d[n+0],11,-358537222),m,f,d[n+3],16,-722521979),i,m,d[n+6],23,76029189),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+9],4,-640364487),f,r,d[n+12],11,-421815835),m,f,d[n+15],16,530742520),i,m,d[n+2],23,-995338651),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+0],6,-198630844),f,r,d[n+7],10,1126891415),m,f,d[n+14],15,-1416354905),i,m,d[n+5],21,-57434055),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+12],6,1700485571),f,r,d[n+3],10,-1894986606),m,f,d[n+10],15,-1051523),i,m,d[n+1],21,-2054922799),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+8],6,1873313359),f,r,d[n+15],10,-30611744),m,f,d[n+6],15,-1560198380),i,m,d[n+13],21,1309151649),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+4],6,-145523070),f,r,d[n+11],10,-1120210379),m,f,d[n+2],15,718787259),i,m,d[n+9],21,-343485551),m=safe_add(m,h),f=safe_add(f,t),r=safe_add(r,g),i=safe_add(i,e)}return Array(m,f,r,i)}function md5_cmn(d,_,m,f,r,i){return safe_add(bit_rol(safe_add(safe_add(_,d),safe_add(f,i)),r),m)}function md5_ff(d,_,m,f,r,i,n){return md5_cmn(_&m|~_&f,d,_,r,i,n)}function md5_gg(d,_,m,f,r,i,n){return md5_cmn(_&f|m&~f,d,_,r,i,n)}function md5_hh(d,_,m,f,r,i,n){return md5_cmn(_^m^f,d,_,r,i,n)}function md5_ii(d,_,m,f,r,i,n){return md5_cmn(m^(_|~f),d,_,r,i,n)}function safe_add(d,_){var m=(65535&d)+(65535&_);return(d>>16)+(_>>16)+(m>>16)<<16|65535&m}function bit_rol(d,_){return d<<_|d>>>32-_}
</script>
</body>
